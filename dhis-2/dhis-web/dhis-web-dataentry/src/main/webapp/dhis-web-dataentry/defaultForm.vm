<input type="hidden" value="$organisationUnit.id" id="organisationUnitId"/>

#set( $tabIndex = 1 )
#foreach( $categoryCombo in $orderedCategoryCombos )
<div style="border:1px solid #808080;width:98%">            
  <table class="mainPageTable" cellpadding="0">
  #set( $colCount = $numberOfTotalColumns.get( $categoryCombo.id )  ) 
  #set( $categories = $orderedCategories.get( $categoryCombo.id )  )
  #set( $optionsMap = $orderedOptionsMap.get( $categoryCombo.id )  )
  #set( $colRepeat = $catColRepeat.get( $categoryCombo.id )  )
    
  #foreach( $category in $categories )
  #set( $categoryOptions = $optionsMap.get( $category.id ) )
  #set( $colCount = $colCount / $categoryOptions.size() )
  <tr colspan="$colCount">
    <td></td>
    #set( $cols = $colRepeat.get( $category.id ) )
    #foreach( $col in $cols )
      #foreach( $categoryOption in $categoryOptions )
      #set( $optionName = $categoryOption.name )
      <th colspan="$colCount"><div align="center"> #if( $optionName != "default" ) $optionName #end </div></th>
      #end
    #end
  </tr>
  #end

  #set( $count = 0 )               
  #set( $dataElements = $orderedDataElements.get( $categoryCombo )  )
  #set( $optionCombos = $orderdCategoryOptionCombos.get( $categoryCombo.id )  )
  #set( $mark = 0 )
  #foreach( $optionCombo in $optionCombos )
  <span id="value[option${optionCombo.id}].name" class="hidden">${optionCombo.name}</span>
  #end
  #foreach( $dataElement in $dataElements )
  #if( $mark == 1 )
  #set( $mark = 0 )
  #else
  #set( $mark = 1 )
  #end
        				 
  #set( $count = $count + 1 )
  #set( $calculatedValue = false )
  #set( $calculatedValue = $calculatedValueMap.get( $dataElement ) )                        
  #set( $calculated = false )
  #set( $calculated = ($calculatedDataElementIds.contains($dataElement.id) ) )
  <tr>
    <td #if( $mark == 1 ) style="background-color:#dddddd" #end>
      <span id="value[$dataElement.id].name" title="$!encoder.htmlEncode( $dataElement.description )">$encoder.htmlEncode( $dataElement.name )</span><span id="value[$dataElement.id].type" class="hidden">$dataElement.getDetailedNumberType()</span>
    </td>
    #foreach( $optionCombo in $optionCombos )
    #set( $minMax = false )
    #set( $minMax = $minMaxMap.get( "$dataElement.id:$optionCombo.id" ) )
    #set( $dataValue = false )
    #set( $dataValue = $dataValueMap.get( "$dataElement.id:$optionCombo.id" ) )
    #set( $dataEntryId = "value[$dataElement.id].value:value[$optionCombo.id].value" )
    #set( $minMaxError = false )
    #if( $dataElement.type == "int" && $dataValue && $minMax )
      #if( $integer.parseInt( $dataValue.value ) < $minMax.min || $integer.parseInt( $dataValue.value ) > $minMax.max )
      #set( $minMaxError = true )
      #end
    #end
    <span id="value[${dataElement.id}:${optionCombo.id}].min" class="hidden">$!minMax.min</span><span id="value[${dataElement.id}:${optionCombo.id}].max" class="hidden">$!minMax.max</span>
    <td>
    #if( $dataElement.type == "bool" )
    <span id="value[option$optionCombo.id].name" style="display:none">$optionCombo.name</span>
    <select name="entryselect" id="$dataEntryId" #if( $auth.hasAccess( "dhis-web-dataentry", "saveMultiDimensionalValue" )) onchange="saveBoolean($dataElement.id,$optionCombo.id, this )"  #else disabled="disabled" #end style="width:100%" tabindex="$tabIndex" #if( $locked ) disabled="disabled"#end>
      <option value="">[$i18n.getString( "no_value" )]</option>
      <option value="true" #if( $dataValue.value == "true" ) selected="selected" #end>$i18n.getString( "yes" )</option>
      <option value="false" #if( $dataValue.value == "false" ) selected="selected" #end>$i18n.getString( "no" )</option>
    </select>
    #elseif( $dataElement.type == "string" )
    #set( $coun = 0 )
      #foreach($customValue in $customValues)
      #if($dataElement.id == $customValue.dataElement.id && $optionCombo.id == $customValue.optionCombo.id)                                    
      #set( $coun = $coun +1 )
      #end
      #end
      #if( $coun > 0 )
      <select name="entryselect" id="$dataEntryId" #if( $auth.hasAccess( "dhis-web-dataentry", "saveMultiDimensionalValue" )) onchange="saveBoolean($dataElement.id,$optionCombo.id, this )"  #else disabled="disabled" #end style="width:100%" tabindex="$tabIndex" #if( $locked ) disabled="disabled"#end>
      #foreach($customValue in $customValues)
        #if($dataElement.id == $customValue.dataElement.id && $optionCombo.id == $customValue.optionCombo.id)
        <option value="$customValue.customValue" #if( $dataValue.value == $customValue.customValue ) selected="selected" #end>$customValue.customValue</option>
        #end
      #end
      </select>
      #else
      <input name="entryfield" id="$dataEntryId" type="text" value="$!encoder.htmlEncode( $dataValue.value )" #if( $auth.hasAccess( "dhis-web-dataentry", "saveMultiDimensionalValue") ) onchange="saveValue(${dataElement.id},${optionCombo.id},'$encoder.jsEncode( ${dataElement.name} )',${zeroValueSaveMode})" ondblclick="viewHistory(${dataElement.id},${optionCombo.id},true)" #else disabled="disabled" #end onkeypress="return keyPress(event,this)" class="entryField" #if( $minMaxError )style="background-color:#ffcccc"#end tabindex="$tabIndex" #if( $locked ) disabled="disabled"#end>                                
      #end
    #else
    <input name="entryfield" id="$dataEntryId" type="text" value="$!encoder.htmlEncode( $dataValue.value )" #if( $auth.hasAccess( "dhis-web-dataentry", "saveMultiDimensionalValue") ) onchange="saveValue(${dataElement.id},${optionCombo.id},'$encoder.jsEncode( $dataElement.name )',${zeroValueSaveMode})" ondblclick="viewHistory(${dataElement.id},${optionCombo.id},true)" #else disabled="disabled" #end onkeypress="return keyPress(event,this)" class="entryField" #if( $minMaxError )style="background-color:#ffcccc"#end tabindex="$tabIndex" #if( $locked ) disabled="disabled"#end>
    #end
    </td>
    #set( $tabIndex = $tabIndex + 1 )
    #end
  </tr>
  #end
  </table>
</div>
<br>
<br>
#end

#parse( "/dhis-web-dataentry/completeRegistration.vm" )
