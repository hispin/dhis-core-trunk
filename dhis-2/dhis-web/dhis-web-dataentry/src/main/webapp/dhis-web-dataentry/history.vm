<script type="text/javascript">
var currentDataElementId = $!{dataElementHistory.dataElement.id};
var currentOptionComboId = $!{dataElementHistory.optionCombo.id};
</script>

#set( $width = 40 * $dataElementHistory.historyLength )
#set( $lastIndex = $dataElementHistory.historyLength - 1 )
#set( $average = $dataElementHistory.historyPoints.get( $lastIndex ).average )
#set( $dataValueAuditSize = $dataValueAudits.size() )
<table>
	<tr>		
		<!-- Comment -->
		<td valign="top">
			<h4>$i18n.getString( "dataelement_comment" )
			
			#if ( $dataValue && $dataValue.isFollowup() )
		        <img id="followup" src="../images/marked.png" alt="$i18n.getString( 'mark_value_for_followup' )" onclick="markValueForFollowup()" style="cursor:pointer"/>
			#elseif ( $dataValue )
		        <img id="followup" src="../images/unmarked.png" alt="$i18n.getString( 'unmark_value_for_followup' )" onclick="markValueForFollowup()" style="cursor:pointer"/>
			#else
			    <img id="followup" src="../images/unmarked.png"/>
			#end			
			</h4>
			<textarea id="commentTextArea" style="height:130px;width:240px">$!encoder.htmlEncode( $dataValue.comment )</textarea><br>
			<input type="button" value="$i18n.getString( 'save_comment' )" style="width:130px" onclick="saveComment()">
		</td>
		
		<!-- Min-max -->
        <td valign="top">       
            <h4>$encoder.htmlEncode( $i18n.getString( "min_max_limits" ) )</h4>
            <table>
                <tr>
                    <td style="background-color:#d54a4a; height:26px">&nbsp;</td>
                    <td>$encoder.htmlEncode( $i18n.getString( "min_limit" ) ) </td>
                    <td><input type="text" id="minLimit" style="width:10em" value="$!{dataElementHistory.minLimit}" class="{validate:{digits:true}}" 
                        #if( !$auth.hasAccess( "dhis-web-dataentry", "saveMinMaxLimits" ) ) disabled="disabled"#end />
						<i><span id="minSpan" style="color:red"></span></i>
					</td>
                </tr>
                <tr>
                    <td style="background-color:#2e4e83; height:26px">&nbsp;</td>
                    <td>$encoder.htmlEncode( $i18n.getString( "max_limit" ) ) </td>
                    <td><input type="text" id="maxLimit" style="width:10em" value="$!{dataElementHistory.maxLimit}" class="{validate:{digits:true}}" 
                    	#if( !$auth.hasAccess( "dhis-web-dataentry", "saveMinMaxLimits" ) ) disabled="disabled"#end />
						<i><span id="maxSpan" style="color:red"></span></i>
					</td>
                </tr>
                <tr>
                    <td style="background-color:#f4f256; height:26px">&nbsp;</td>
                    <td>$encoder.htmlEncode( $i18n.getString( "average" ) ) </td>
                    <td>${average}</td>
                </tr>
                <tr>
                    <td style="background-color:#75e077; height:26px">&nbsp;</td>
                    <td>$encoder.htmlEncode( $i18n.getString( "interpolation" ) ) </td>
                    <td></td>
                </tr>
                <tr>
                	<td colspan="3"><input type="button" value="$i18n.getString( 'save' )" onclick="saveMinMaxLimit()" style="width:100px">
                		<input type="button" value="$i18n.getString( 'remove' )" onclick="removeMinMaxLimit()" style="width:100px"></td>
                </tr>
            </table>
        </td>
	</tr>
	<tr>
		<!-- History chart -->
		<td colspan="2">
			<h4>$encoder.htmlEncode( $i18n.getString( "dataelement_history" ) )</h4>
			#if( !$isHistoryValid )			    
			    <h4>$encoder.htmlEncode( $i18n.getString( "history_not_valid" ) )</h4>  
			#end			
			<img id="historyChart" src="getHistoryChart.action?dataElementId=${dataElementHistory.dataElement.id}&categoryOptionComboId=${dataElementHistory.optionCombo.id}&organisationUnitId=${dataElementHistory.organisationUnit.id}&periodId=${periodId}"/>
        </td>
    </tr>
    #if( $dataValueAuditSize > 0 )
	<tr>
		<!-- Data Value History -->
		<td colspan="2">
			<h4>$encoder.htmlEncode( $i18n.getString( "datavalue_history" ) )</h4>
			#foreach( $eachDataValueAudit in $dataValueAudits )
				<p>
					$encoder.htmlEncode( $i18n.getString( "on" ) ) $eachDataValueAudit.timeStamp, 
					$eachDataValueAudit.storedBy 
					$encoder.htmlEncode( $i18n.getString( "change_from" ) ) $eachDataValueAudit.value
				</p>
			#end					
        </td>
    </tr>
    #end
</table>
