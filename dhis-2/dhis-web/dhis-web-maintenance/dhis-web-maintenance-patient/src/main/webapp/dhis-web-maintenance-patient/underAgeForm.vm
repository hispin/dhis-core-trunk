<script type="text/javascript">
	jQuery("#representativeDiv").ready(function() {
		
		jQuery("#tabs").tabs();
		hideById('addRepresentativeForm [id=underAgeDiv]');
		addEventForPatientForm('addRepresentativeForm');
		
		jQuery("#searchForm").validate({
			meta:"validate"
			,errorElement:"span"
			,submitHandler: function(form) { searchPerson(); }
			,rules : {
				relationshipTypeId  : { required: true },
				searchType			: { required: true },
				searchValue			: { required: true }
			}
		});

		jQuery("#addRepresentativeForm").validate({
			meta:"validate"
			,errorElement:"span"
			,submitHandler: function(form)
				{
					validateAddRepresentative('addRepresentativeForm');
				}
			,beforeValidateHandler: function(form)
				{
					var dobType = $('#addRepresentativeForm [id=dobType]').val();
					
					if( dobType=='V' || dobType=='D' ) 
					{
						var birthDate = $('#addRepresentativeForm [id=birthDate]').val();
						if( birthDate != '' ){
							$("#addRepresentativeForm [id=memberValidator]").val(birthDate);
						}
					}else{
						var age = $('#addRepresentativeForm [id=age]').val();
						$("#addRepresentativeForm [id=memberValidator]").val(age);
					}
				}
		});

		// Esc key for jQuery thickbox
		// jQuery thickbox already has this event
		// but somehow it's over written by jQuery tabs plugin
		document.onkeydown = function(e){ 	
			if (e == null) { // ie
				keycode = event.keyCode;
			} else { // mozilla
				keycode = e.which;
			}

			if(keycode == 27){ // close
				window.parent.tb_remove();
			}
		}
	}); 

	var i18n_patient_identifiers = '$encoder.jsEscape( $i18n.getString( "patient_identifiers" ) , "'")';
	var i18n_patient_attributes = '$encoder.jsEscape( $i18n.getString( "patient_attributes" ) , "'")';
	var i18n_patient_fullName = '$encoder.jsEscape( $i18n.getString( "full_name" ) , "'")';
	var i18n_patient_demographics = '$encoder.jsEscape( $i18n.getString( "demographics" ) , "'")';
	var i18n_patient_gender = '$encoder.jsEscape( $i18n.getString( "gender" ) , "'")';
	var i18n_patient_date_of_birth = '$encoder.jsEscape( $i18n.getString( "date_of_birth" ) , "'")';
	var i18n_patient_age = '$encoder.jsEscape( $i18n.getString( "age" ) , "'")';
	var i18n_patient_blood_group = '$encoder.jsEscape( $i18n.getString( "blood_group" ) , "'")';
	var i18n_choose_this_person = '$encoder.jsEscape( $i18n.getString( "choose_this_patient" ) , "'")';
	var i18n_no_duplicate_found = '$encoder.jsEscape( $i18n.getString( "no_duplicate_found" ) , "'")';
	var i18n_patient_system_id = '$encoder.jsEscape( $i18n.getString( "patient_system_id" ) , "'")';
	var i18n_child_representative = '$encoder.jsEscape( $i18n.getString( "child_representative" ) , "'")';
	var i18n_no_result = '$encoder.jsEscape( $i18n.getString( "no_result" ) , "'")';
	var i18n_error_connect_to_server = '$encoder.jsEscape( $i18n.getString( "error_connect_to_server" ) , "'")';
	var i18n_please_enter_value = '$encoder.jsEscape( $i18n.getString( "please_enter_value" ) , "'")';
	var i18n_please_select_search_type = '$encoder.jsEscape( $i18n.getString( "please_select_search_type" ) , "'")';
	var i18n_please_select_identifier_type = '$encoder.jsEscape( $i18n.getString( "please_select_identifier_type" ) , "'")';
	var i18n_please_select_attribute_type = '$encoder.jsEscape( $i18n.getString( "please_select_attribute_type" ) , "'")';
	var i18n_add_person_successfully = '$encoder.jsEscape( $i18n.getString( "add_person_successfully" ) , "'")';
	var i18n_please_select_relationshipType = '$encoder.jsEscape( $i18n.getString( "please_select_relationshipType" ) , "'")';
	var i18n_no_patients_found = '$encoder.jsEscape( $i18n.getString( "no_patients_found" ) , "'")';
	var i18n_search_result = '$encoder.jsEscape( $i18n.getString( "search_result" ) , "'")';
</script>

<!-- TAB Header -->
<div id="tabs">
	<ul>
		<li><a href="#tab-1">$i18n.getString("search_existing_person")</a></li>
		<li><a href="#tab-2">$i18n.getString("add_new_person")</a></li>
	</ul>

	<!-- Search Person TAB -->
	<div id="tab-1">
		<form id="searchForm" name="searchForm" action="searchPerson.action" action="post" >
			<table>
				<tr>
					<td >$i18n.getString("relationship_type")<em title="$i18n.getString( "required" )" class="required">*</em></td>
					<td >
						<select name="relationshipTypeId" id="relationshipTypeId" style='width:18em'>
							<option value="">[$i18n.getString( "please_select" )]</option>        
							#foreach ($relationship in $relationshipTypes)
								<option value="$relationship.id">$!relationship.aIsToB</option>
							#end
						</select>
					</td>
				</tr>
				<tr>
					<td>$i18n.getString("search_by")<em title="$i18n.getString( "required" )" class="required">*</em></td>
					<td>
						<select id="searchType" name="searchType" onclick="toggleSearchType(this)" style='width:18em'>
							<option value="">[$i18n.getString( "please_select" )]</option>        
							<option value="identifier">$i18n.getString("identifier")</option>
							<option value="attribute">$i18n.getString("attribute")</option>
							<option value="name">$i18n.getString("name")</option>		
						</select>
					</td>
				</tr>
				<tr id="rowIdentifier" style="display: none" >
					<td>$i18n.getString("identifier_type")</td>
					<td>
						<select name="identifierTypeId" id="identifierTypeId" style='width:18em' >
							<option value="">[$i18n.getString( "please_select" )]</option>       
							#foreach($identifierType in $identifierTypes)
								<option value="$identifierType.id">$identifierType.name</option>
							#end
						</select>
					</td>
				</tr>
				<tr><td colspan="2"></td></tr>
				<tr id="rowAttribute" style="display: none">
					<td>$i18n.getString("attribute")</td>
					<td>
						<select name="attributeId" id="attributeId" style='width:18em'>
							<option value="">[$i18n.getString( "please_select" )]</option>       
							#foreach($attribute in $attributes)
								<option value="$attribute.id">$attribute.name</option>
							#end
						</select>
					</td>
				</tr>
				<tr><td colspan="2"></td></tr>
				<tr>
					<td>$i18n.getString("search_value")<em title="$i18n.getString( "required" )" class="required">*</em></td>
					<td><input type="text" name="searchValue" id="searchValue" style='width:18em'/></td>
				</tr>
				<tr>
					<td colspan="2"><input type="submit" value="$i18n.getString('search')"/></td>
				</tr>
			</table>

			<div id="listPersons">
			</div>

		</form>
	</div>

		<!-- Add Person form TAB -->
		<div id="tab-2">
		<form id="addRepresentativeForm" name="addRepresentativeForm" action="addRepresentative.action" method="post">
			<table id="formContainer">
				<tr>
					<td style='width:12.2em'><label for="relationship_type">$i18n.getString("relationship_type")<em title="$i18n.getString( "required" )" class="required">*</em></label></td>
					<td >
						<select name="relationshipTypeId" id="relationshipTypeId" style="width:28.2em" class="{validate:{required:true}}">
							<option value="">[$i18n.getString( "please_select" )]</option>        
							#foreach ($relationship in $relationshipTypes)
								<option value="$relationship.id">$relationship.aIsToB</option>
							#end
						</select>
					</td>
				</tr>
			</table>
			
			#parse( "/dhis-web-maintenance-patient/patientForm.vm" )

			<p style="margin-top:10px">
				<input type="submit" value="$i18n.getString( 'add' )" style="width:10em"/>
			</p>
			</table>
		</form>

		<div id="listPersonsDuplicate">
		</div>
	</div>
</div>

