<div>
    <input type="button" value="$i18n.getString( "back_to_search" )" onclick="window.location.href='searchPatient.action'" style="width:10em">
</div>

<h3>$i18n.getString( "relationship_management" )</h3>

<div>
    <input type="hidden" id="id" name="id" value="$patient.id">    
</div>

<table class="mainPageTable"> 
    <tr>            
        <td>
            <strong>$i18n.getString( "full_name" ):</strong>$encoder.htmlEncode( $patient.getFullName() )<br>
            <strong>$i18n.getString( "gender" ):</strong>$encoder.htmlEncode( $patient.gender )<br>
            <strong>$i18n.getString( "date_of_birth" ):</strong>$format.formatDate( $patient.birthDate )<br>
            <strong>$i18n.getString( "age" ):</strong>$encoder.htmlEncode( $patient.getAge() )
        </td>   
        <td style="vertical-align:top">
            <div style="float:right">
                #foreach( $patientAttributeValue in $patientAttributeValues )
                    <strong>$encoder.htmlEncode( $patientAttributeValue.patientAttribute.name ):</strong>$encoder.htmlEncode( $patientAttributeValue.value )<br>
                #end                         
            </div>
        </td>    
    </tr>            
</table>

<table class="mainPageTable">
    <tr>
        <td style="vertical-align:top">
            <table class="listTable">
                <col>
                <col>
                <col width="20">
                <col width="20">
                
                <tr>
                    <td></td>
                    <td></td> 
                    <td colspan="2" style="text-align:right">
                        <input type="button" value="$i18n.getString( "add_new" )" onclick="javascript:showAddRelationship()">                                                              
                    </td>
                </tr>
          
                <tr>            
                    <th>$i18n.getString( "relationship" )</th>
                    <th>$i18n.getString( "full_name" )</th>
                    <th colspan="3">$i18n.getString( "operations" )</th>
                </tr>
                <tbody id="list">                
                    #set( $mark = false )
                    #foreach( $relationship in $relationships )
                        <tr>
                            #set( $partnerId = false )    
                            #if( $relationship.patientA.id == $patient.id )
                                #set( $partnerId = $relationship.patientB.id )
                                <td#alternate( $mark )>                                
                                    $encoder.htmlEncode( $relationship.relationshipType.BIsToA )
                                </td>
                                            
                                <td#alternate( $mark )>
                                    $encoder.htmlEncode( $relationship.patientB.getFullName() )
                                </td>
                            #elseif($relationship.patientB.id == $patient.id )
                                #set( $partnerId = $relationship.patientA.id )
                                <td#alternate( $mark )>                                
                                    $encoder.htmlEncode( $relationship.relationshipType.AIsToB )
                                </td>
                                            
                                <td#alternate( $mark )>
                                    $encoder.htmlEncode( $relationship.patientA.getFullName() )
                                </td>
                            #end                  
                            
                            <td style="text-align:center"#alternate( $mark )>
                                <a href="javascript:manageRepresentative( '$patient.id', $partnerId )" title="$i18n.getString( "manage_representative" )"><img src="../images/assign.png" alt="$i18n.getString( "manage_representative" )"></a>
                            </td>                                       
 
                            <td style="text-align:center"#alternate( $mark )>
                                <a href="javascript:removeRelationship( '$relationship.id', '$encoder.jsEncode( $relationship.patientA.getFullName() )', '$encoder.jsEncode( $relationship.relationshipType.aIsToB )', '$encoder.jsEncode( $relationship.patientB.getFullName() )' )" title="$i18n.getString( "remove" )"><img src="../images/delete.png" alt="$i18n.getString( "remove" )"></a>
                            </td>               
                        </tr>
                        #if( $mark )
                            #set( $mark = false )
                        #else
                            #set( $mark = true )
                        #end
                    #end
                </tbody>
            </table>
        </td>       
    </tr>         
</table>

<div id="relationshipPartnerContainer" style="border:1px solid #808080; padding:10px; display:none;">

    <table class="mainPageTable">
        <tr>        
            <td style="text-align:left">
                <strong>
                    <span id="labelField"></span>
                </strong>
            </td>
            <td style="text-align:right">            
                <a href="javascript:hideRelationshipPartnerContainer()" title="$i18n.getString( "hide_details" )"><img src="../images/close.png" alt="$i18n.getString( "hide_details" )"></a>
            </td>                    
        <tr>              
            <td>
                <span id="partnerIdField"></span>
                <strong>$i18n.getString( "full_name" ):</strong><span id="fullNameField"></span><br>
                <strong>$i18n.getString( "gender" ):</strong><span id="genderField"></span><br>
                <strong>$i18n.getString( "date_of_birth" ):</strong><span id="dateOfBirthField"></span><br>
                <strong>$i18n.getString( "age" ):</strong><span id="ageField"></span>
            </td>   
            <td style="vertical-align:top">
                <div style="float:right">                              
                    <p><strong>$i18n.getString( "attributes" ):</strong><br><span id="attributeField"></span></p>                                         
                </div>
            </td>    
        </tr>
        <tr>
            <td style="text-align:left">
                <span id="buttonFirstField"></span>
            </td>
            <td style="text-align:right">
                <span id="buttonSecondField"></span>
            </td>    
        </tr>                      
    </table>

</div>

<script type="text/javascript">
    var i18n_confirm_delete_relationship = '$encoder.jsEscape( $i18n.getString( "confirm_delete_relationship" ) , "'" )';
    var i18n_please_select_a_representative = '$encoder.jsEscape( $i18n.getString( "please_select_a_representative" ) , "'" )';
    var i18n_saving_representative_failed = '$encoder.jsEscape( $i18n.getString( "saving_representative_failed" ) , "'" )';
    var i18n_removing_representative_failed = '$encoder.jsEscape( $i18n.getString( "removing_representative_failed" ) , "'" )';
    var i18n_removing_relationship_failed = '$encoder.jsEscape( $i18n.getString( "removing_relationship_failed" ) , "'" )';        
    var i18n_adding_relationship_failed = '$encoder.jsEscape( $i18n.getString( "adding_relationship_failed" ) , "'" )';
    var i18n_yes = '$encoder.jsEscape( $i18n.getString( "yes" ) , "'" )';                
    var i18n_do_you_want_to_remove_this_one_from_being_representative = '$encoder.jsEscape( $i18n.getString( "do_you_want_to_remove_this_one_from_being_representative" ) , "'" )';
    var i18n_do_you_want_to_make_this_one_a_representative = '$encoder.jsEscape( $i18n.getString( "do_you_want_to_make_this_one_a_representative" ) , "'" )';
    var i18n_yes_and_attribute = '$encoder.jsEscape( $i18n.getString( "yes_and_attribute" ) , "'" )';                    
</script>

