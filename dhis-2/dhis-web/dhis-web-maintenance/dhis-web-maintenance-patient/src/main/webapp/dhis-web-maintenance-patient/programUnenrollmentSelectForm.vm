
<script>
	//-----------------------------------------------------------------------
	//init jQuery validation for programEnrollmentForm
	//-----------------------------------------------------------------------
	jQuery(document).ready(
			function()
			{
				jQuery("#programUnenrollmentForm").validate({
					 meta:"validate"
					,errorElement:"td"
					,submitHandler: function(form)
									{
										validateProgramEnrollment();
									}
				});

                datePickerValid( 'enrollmentDate' );
                datePickerValid( 'dateOfIncident' );
			}
	);

</script>

<div>
    <input type="button" value="$i18n.getString( "back_to_search" )" onclick="onClickBackBtn();" style="width:10em">
</div>

<h3>$i18n.getString( "program_unenrollment" )</h3>

<table>
    <tr>
        <td><strong>$i18n.getString( "full_name" ):</strong></td>
        <td>$encoder.htmlEncode( $patient.getFullName() )</td>
    </tr>
    <tr>
        <td><strong>$i18n.getString( "gender" ):</strong></td>
        <td>$encoder.htmlEncode( $patient.gender )</td>
    </tr>    
    <tr>
        <td><strong>$i18n.getString( "date_of_birth" ):</strong></td>
        <td>$format.formatDate( $patient.birthDate )</td>
    </tr>
    <tr>
        <td><strong>$i18n.getString( "age" ):</strong></td>
        <td>$encoder.htmlEncode( $patient.getAge() )</td>
    </tr>    
    <tr>
        <td>&nbsp;</td>
    </tr>
</table>

<hr style="clear:both">

<form id="programEnrollmentForm" name="programEnrollmentForm" method="post">

<input type="hidden" id="patientId" name="patientId" value="$patient.id">    

<table>    
    <tr>
        <td style="width:180px"><label for="programId">$i18n.getString( "program" )</label></td>
        <td>
            <select id="programInstanceId" name="programInstanceId" onchange="showUnenrollmentForm('$patient.id', jQuery('#programInstanceId :selected').attr('programId') )" style="min-width:200px" >
                <option value="0">[$i18n.getString( "select" )]</option>
                #foreach( $instance in $programInstances )
                    <option value="$instance.id" programId="$instance.program.id" >$encoder.htmlEncode( $instance.program.name )</option>
                #end
            </select>
        </td>
    </tr>   
        
</table>

<div id='unenrollmentFormDiv' style='display:none;'>
	
	<table width="100%">
		<tr>
			<td style="width:20px"><label for="enrollmentDate">$i18n.getString( "date_of_enrollment" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
			<td><input type="text" style="width:180px" id="enrollmentDate" name="enrollmentDate" value="$!format.formatDate( $programInstance.enrollmentDate )"> <i>( $!programInstance.program.dateOfEnrollmentDescription )</i></td>
		</tr>
		
		<tr>
			<td style="width:180px"><label for="dateOfIncident">$i18n.getString( "date_of_incident" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
			<td><input type="text" style="width:180px" id="dateOfIncident" name="dateOfIncident" value="$!format.formatDate( $programInstance.dateOfIncident )"><i>( $!programInstance.program.dateOfIncidentDescription )</i></td>
		</tr>
		<tr>
			<td></td>
			<td></td>                           
		</tr>

		<tr>
			<td colspan='2'><hr/></td>	
		<tr>
	
		<!-- ------------------------------------------------------------ -->
		<!--                   Show Program - Attributes                  -->
		<!-- ------------------------------------------------------------ -->
		
		#foreach($attribute in $programAttributes)
		<tr>
			<td style="width:180px">$attribute.name</td>
			<td class="input-column">
				#if( $attribute.valueType == "YES/NO" )
					<select id="attr$attribute.id" name="attr$attribute.id" style="width:200px"> 
						<option value="">[$i18n.getString( "please_select" )]</option>
						<option value="true">$i18n.getString( "yes" )</option>
						<option value="false">$i18n.getString( "no" )</option>
					</select>                     
				#elseif( $attribute.valueType == "DATE" )
					<input type="text" style="width:180px" id="attr$attribute.id" name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )'>
					<script type="text/javascript">
						datePickerValid( 'attr$attribute.id' );
					</script>                       
				#elseif( $attribute.valueType == "COMBO" )
					<select id="attr$attribute.id" name="attr$attribute.id" style="width:200px">
						<option value="">[$i18n.getString( "please_select" )]</option>
						#foreach ($option in $attribute.attributeOptions )
							<option value="$option.id" >$option.name</option>
						#end
					</select>
				#else 
					<input type="text" id="attr$attribute.id" name="attr$attribute.id" style="width:180px" >
				#end
				
				#if($!programAttribute.description) <i>($!programAttribute.description)</i> #end
			</td>		
		</tr>
		#end
		
		<tr>
			<td></td>
			<td></td>                            
		</tr>
	
	</table>


	<table>
		<tr>
			<td style="width:180px">
				<input type="button" value='$i18n.getString( "unenroll" )' onclick="javascript:unenrollmentForm( getFieldValue('programInstanceId') );" >
			</td>                                        
		</tr>
	</table>
</div>

</form>

<script type="text/javascript">    
    var i18n_program_enrollment_failed = '$encoder.jsEscape( $i18n.getString( "program_enrollment_failed" ) , "'")';
    var i18n_saving_value_failed_status_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_status_code" ) , "'")';
    var i18n_saving_value_failed_error_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_error_code" ) , "'")';
    var i18n_searching_patient_failed = '$encoder.jsEscape( $i18n.getString( "searching_patient_failed" ) , "'")'; 
	var i18n_date_invalid = '$encoder.jsEscape( $i18n.getString( "date_invalid" ) , "'")';
	var i18n_date_less_incident = '$encoder.jsEscape( $i18n.getString( "date_less_incident" ) , "'")';
</script>
