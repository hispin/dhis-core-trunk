## Macro for generating the jQuery validation rules 
#macro( validate $type $require )
  #if( $type == "NUMBER" )
  	{validate:{ number:true #if($require), required:true #end }}
  #elseif( $require )
  	{validate:{required:true}}
  #end
#end
<script>
	  //-----------------------------------------------------------------------
	  //init jQuery validation for addPatientForm
	  //-----------------------------------------------------------------------
		jQuery(document).ready(function(){
			jQuery("#addPatientForm").validate({
				 meta:"validate"
				,errorElement:"td"
				,submitHandler: function(form)
								{
									validateAddPatient();
								}
			});
			jQuery.validator.loadLocaled( jQuery("#curLocaleCode").val() );
			jQuery("#firstName").focus();
			jQuery("#birthDate").rules("add",{required:true,dateISO:true,datelessthanequaltoday:true});
		});
</script>
<h3>$i18n.getString( "add_new_patient" )</h3>
<input type="hidden" id="curLocaleCode" value="$locale.getLanguage()_$locale.getCountry()"/>	
																			
<form id="addPatientForm" action="addPatient.action" method="post">
<input type="hidden" id="representativeId" name="representativeId"/> 
<table>	
	<tr><td>&nbsp;</td></tr>
	<tr>
		<th colspan="2">$i18n.getString( "name" )<em title="$i18n.getString( "required" )" class="required">*</em></th>
	</tr>
	<tr>
		<td><label for="firstName">$i18n.getString( "first_name" )</label></td>
		<td><input type="text" id="firstName" name="firstName" style="width:30em"  maxlength="30" class="required_group {validate:{required_group:true,rangelength:[2,30],alphanumeric:true}}" ></td>
	</tr>
	<tr>
		<td><label for="middleName">$i18n.getString( "middle_name" ) </label></td>
		<td><input type="text" id="middleName" name="middleName" maxlength="30" style="width:30em"   class="required_group {validate:{required_group:true,rangelength:[2,30],alphanumeric:true}}"></td>
	</tr>
	<tr>
		<td><label for="lastName">$i18n.getString( "last_name" )</label></td>
		<td><input type="text" id="lastName" name="lastName" maxlength="30" style="width:30em"  class="required_group {validate:{required_group:true,rangelength:[2,30],alphanumeric:true}}"></td>
	</tr>	
	<tr><td>&nbsp;</td></tr>	
	<tr>
		<th colspan="2">$i18n.getString( "demographics" )</th>
	</tr>
		
	<tr>
		<td><label for="gender">$i18n.getString( "gender" )<em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td>
			<select id="gender" name="gender" style="min-width:20em" class="{validate:{required:true}}">
				<option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
				<option value="M" >$i18n.getString( "male" )</option>
				<option value="F">$i18n.getString( "female" )</option>
			</select>
		</td>		
	</tr>
	<tr>
		<td><label for="birthDate">$i18n.getString( "date_of_birth" )<em title="$i18n.getString( "required" )" class="required">*</em> </label></td>
		<td>
			<img src="../images/calendar_icon.gif" width="16" height="16" id="getBirthDate" style="cursor: pointer;" title="$i18n.getString("date_selector")" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''" alt="$i18n.getString( "date_of_birth" )">
			<input type="text" id="birthDate" name="birthDate" style="width:10em"  onchange="bdOnchange()" >
			&nbsp;
			<label for="age">$i18n.getString( "or" )  $i18n.getString( "age" ) </label>
			<input type="text" id="age" name="age" style="width:4em"  onchange="ageOnchange()" class="{validate:{number:true}}">
			&nbsp;&nbsp;&nbsp;
			<label for="estimated">$i18n.getString( "estimated" )</label>
            <input type="checkbox" id="birthDateEstimated" name="birthDateEstimated" value="true"> 
	   </td>
	   <td></td>
	</tr>
 	<tr>
		<td><label for="bloodGroup">$i18n.getString( "blood_group" )</label></td>
		<td>
			<select type="text" id="bloodGroup" name="bloodGroup" style="width:30em" >
				 <option value="">[$i18n.getString( "please_select" )]</option>
				<option value="A+">A+</option>
				<option value="A-">A-</option>
				<option value="AB+">AB+</option>
				<option value="AB-">AB-</option>
				<option value="B+">B+</option>
				<option value="B-">B-</option>
				<option value="O+">O+</option>
				<option value="O-">O-</option>
			</select>
		</td>		
	</tr>
	<tr><td colspan="2">&nbsp;</td></tr>	
	<tr><td colspan="2"><input type="button" value="$i18n.getString('check_duplicate')"  onclick="checkDuplicate();"/></td></tr>
	<tr><td colspan="2">&nbsp;</td></tr>	
	
	<!-- CHILD -->
	
	<tr>
		<td>$i18n.getString("is_underage")</td>
		<td>
			<input type="checkbox" name="underAge" onclick="toggleUnderAge(this);"/>
		</td>
	</tr>
	<!--IDENTIFIERS -->
	
	<tr><td colspan="2">&nbsp;</td></tr>	
	<tr><th colspan="2">$i18n.getString( "patient_identifiers" )</th></tr>
	#foreach ($identifierType in $identifierTypes)
	<tr>
		<td><label>$identifierType.name #if($identifierType.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
		<td><input type="text" id="iden$identifierType.id" name="iden$identifierType.id" style="width:30em" class='idfield #validate( "default"  $identifierType.mandatory )'/></td>	
	</tr>
	#end
	
	<!-- ATTRIBUTES IN GROUPS -->
	
	#foreach ($attributeGroup in $attributeGroups )
		<tr><td>&nbsp;</td></tr>
		<tr><th colspan="2">$attributeGroup.name</th></tr>
		#foreach($attribute in $attributeGroup.attributes )
			<tr>
				<td><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
				<td>
					#if( $attribute.valueType == "YES/NO" )
		                <select id="attr$attribute.id"  name="attr$attribute.id" style="width:100%"  style="width:30em"> 
		                	<option value="">[$i18n.getString( "please_select" )]</option>             
		                    <option value="true">$i18n.getString( "yes" )</option>
		                    <option value="false" selected="selected">$i18n.getString( "no" )</option>
		                </select>                
		            #elseif( $attribute.valueType == "DATE" )
		                <input type="text" id="attr$attribute.id"  name="attr$attribute.id" style="width:30em" class=' #validate( "default"  $attribute.mandatory )'>
		                    <img src="../images/calendar_icon.gif" width="16" height="16" id="getDateValue$attribute.id" style="cursor: pointer;" title="$i18n.getString("date_selector")" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''" alt="$i18n.getString( "date" )">
		                    <script type="text/javascript">
		                        Calendar.setup({
		                            inputField     :    "attr$attribute.id",      // id of the input field
		                            ifFormat       :    "$i18n.getString('format.date.label')",       // format of the input field
		                            button         :    "getDateValue$attribute.id"   // trigger for the calendar (button ID)
		                        });
		                    </script>                    
					#elseif( $attribute.valueType == "COMBO" )
						<select  id="attr$attribute.id"  name="attr$attribute.id" style="width:30em" class=' #validate( "default"  $attribute.mandatory )' >
							 <option value="">[$i18n.getString( "please_select" )]</option>
							#foreach ($option in $attribute.attributeOptions )
								<option value="$option.id" >$option.name</option>
							#end
						</select>
					#else 
						<input type="text"  id="attr$attribute.id" style="width:30em" name="attr$attribute.id"  class=' #validate( $attribute.valueType  $attribute.mandatory )'  style="width:30em" >
					#end
				</td>		
			</tr>
		#end
	#end
	
	<!-- ATTRIBUTES NOT IN GROUPS -->
	
	<tr><td>&nbsp;</td></tr>
	#if ( $noGroupAttributes.size() > 0) 	
		<tr><th colspan="2">$i18n.getString( "other_details" )</th></tr>
		#foreach($attribute in $noGroupAttributes )
			<tr>
				<td><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
				<td>
					#if( $attribute.valueType == "YES/NO" )
		                <select id="$attribute.id"  name="attr$attribute.id" style="width:30em" style="width:100%" > 
		                	 <option value="" >[$i18n.getString( "please_select" )]</option>             
		                    <option value="true">$i18n.getString( "yes" )</option>
		                    <option value="false" >$i18n.getString( "no" )</option>
		                </select>                
		            #elseif( $attribute.valueType == "DATE" )
		                <input type="text" id="$attribute.id"  style="width:30em" name="attr$attribute.id"  class=' #validate( "default"  $attribute.mandatory )' >
		                    <img src="../images/calendar_icon.gif" width="16" height="16" id="getDateValue$attribute.id" style="cursor: pointer;" title="$i18n.getString("date_selector")" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''" alt="$i18n.getString( "date" )">
		                    <script type="text/javascript">
		                        Calendar.setup({
		                            inputField     :    "attr$attribute.id",      // id of the input field
		                            ifFormat       :    "$i18n.getString("format.date.label")",       // format of the input field
		                            button         :    "getDateValue$attribute.id"   // trigger for the calendar (button ID)
		                        });
		                    </script>                    
					#elseif( $attribute.valueType == "COMBO" )
						<select  id="$attribute.id"  name="attr$attribute.id" style="width:30em"  class=' #validate( "default"  $attribute.mandatory )'>
							 <option value="">[$i18n.getString( "please_select" )]</option>
							#foreach ($option in $attribute.attributeOptions )
								<option value="$option.id" >$option.name</option>
							#end
						</select>
					#else 
						<input type="text"  id="$attribute.id" name="attr$attribute.id" style="width:30em"  class=' #validate( $attribute.valueType  $attribute.mandatory )'   style="width:30em" >
					#end
				</td>		
			</tr>
		#end
	#end
</table>

<p style="margin-top:10px">
	<input type="submit" value="$i18n.getString( "add" )" style="width:10em">
	<input type="button" value="$i18n.getString( "cancel" )" onclick="window.location.href='patient.action'" style="width:10em">
</p>
</form> 	

<span id="message"></span>

<script type="text/javascript">
    Calendar.setup({
        inputField     :    "birthDate"      // id of the input field
        ,ifFormat      :    "$i18n.getString("format.date.label")"       // format of the input field
        ,button        :    "getBirthDate"   // trigger for the calendar (button ID)
        ,onUpdate 	   :  function(){jQuery("#birthDate").focus();}
    });

</script>	
	
<div id="hiddenModalContent" style="display:none">
<style> 
div#hiddenModalContent label { font-weight: bold;}  
div#hiddenModalContent td {padding: 2px 5px}
</style>
<span>$i18n.getString( "duplicate_warning" )</span>
<input type="button" value="$i18n.getString( 'create_new_patient' )"  id="btnCreateNew"/>
<script>function edit(this_){window.parent.tb_remove(); window.parent.location.href="showUpdatePatientForm.action?id="+jQuery(this_).attr("id");}
</script>
<div id="thickboxContainer"></div>
</div>

<script>
	var i18n_patient_identifiers = '$encoder.jsEscape( $i18n.getString( "patient_identifiers" ) , "'")';
	var i18n_patient_attributes = '$encoder.jsEscape( $i18n.getString( "patient_attributes" ) , "'")';
	var i18n_patient_fullName = '$encoder.jsEscape( $i18n.getString( "full_name" ) , "'")';
	var i18n_patient_demographics = '$encoder.jsEscape( $i18n.getString( "demographics" ) , "'")';
	var i18n_patient_gender = '$encoder.jsEscape( $i18n.getString( "gender" ) , "'")';
	var i18n_patient_date_of_birth = '$encoder.jsEscape( $i18n.getString( "date_of_birth" ) , "'")';
	var i18n_patient_age = '$encoder.jsEscape( $i18n.getString( "age" ) , "'")';
	var i18n_patient_blood_group = '$encoder.jsEscape( $i18n.getString( "blood_group" ) , "'")';
	var i18n_edit_this_patient = '$encoder.jsEscape( $i18n.getString( "edit_this_patient" ) , "'")';
	var i18n_no_duplicate_found = '$encoder.jsEscape( $i18n.getString( "no_duplicate_found" ) , "'")';
	var i18n_patient_system_id = '$encoder.jsEscape( $i18n.getString( "patient_system_id" ) , "'")';
	var i18n_child_representative = '$encoder.jsEscape( $i18n.getString( "child_representative" ) , "'")';
	var checkedDuplicate = false;
</script>