<div>
    <input type="button" value="$i18n.getString( "back_to_search" )" onclick="window.location.href='patient.action'" style="width:10em">
</div>


<h3>$i18n.getString( "update_patient_attribute" )</h3>

<form id="updatePatientAttributeValueForm" name="updatePatientAttributeValueForm" action="updatePatientAttribute.action" method="post" onsubmit="return validateUpdatePatientAttribute()">

<div>
    <input type="hidden" id="patientId" name="patientId" value="$patient.id">
</div>

<table>
    <tr>
        <td><strong>$i18n.getString( "full_name" ):</strong></td>
        <td>           
            $encoder.htmlEncode( $patient.getFullName() )  
        </td>
    </tr>
    <tr>
        <td><strong>$i18n.getString( "gender" ):</strong></td>
        <td>            
            $encoder.htmlEncode( $patient.gender )
        </td>
    </tr>    
    <tr>
        <td><strong>$i18n.getString( "date_of_birth" ):</strong></td>
        <td>            
            $format.formatDate( $patient.birthDate )
        </td>
    </tr>
    <tr>
        <td><strong>$i18n.getString( "age" ):</strong></td>
        <td>            
            $encoder.htmlEncode( $patient.getAge() )
        </td>
    </tr>     
    <tr>
        <td>&nbsp;</td>
    </tr>
        
</table>

<br/><br/>
<table width="100%">
	<col width="10%">
    <col width="40%">    
    <col width="20%">
    <col width="30">
    <tr>
        <th style="text-align: center">$i18n.getString( "nr" )</th>
        <th>$i18n.getString( "attribute" )</th>  
        <th>$i18n.getString( "value_type" )</th>              
        <th>$i18n.getString( "entry" )</th>        
    </tr>
    
#set( $rowCount = 0 )
#set( $mark = 0 )
#set( $tabIndex = 1 )
#foreach( $attributeGroup in $patientAttributeGroups )
<tr style="background-color: #BFD0FF; "><td colspan="4">$attributeGroup.name</td></tr>
#set( $patientAttributes = $attributeGroup.getAttributes() )
#foreach( $patientAttribute in $patientAttributes )
    #set( $rowCount = $rowCount + 1 )    
    #if( $mark == 1 )
        #set( $mark = 0 )
    #else
        #set( $mark = 1 )
    #end    
    #set( $patientAttributeValue = false )
    #set( $patientAttributeValue = $patientAttributeValueMap.get( $patientAttribute.id ) )    
    <tr #if( $mark == 0 ) style="background-color:#dddddd" #end>
        ##rowCount
        <td style="text-align: center">$rowCount</td>
                
        ##attribute name
        <td>
            <span id="value[$patientAttribute.id].name" title="$!encoder.htmlEncode( $patientAttribute.description )">
                $encoder.htmlEncode( $patientAttribute.name )            
            </span>
        </td>        
        ##type        
        <td>            
            <span id="value[$patientAttribute.id].valueType">$encoder.htmlEncode( $patientAttribute.valueType )</span>
        </td>       
        ##entry        
        <td>        
            #if( $patientAttribute.valueType == "YES/NO" )
                <select name="entryselect" id="value[$patientAttribute.id].boolean" onchange="saveBoolean( $patient.id, $patientAttribute.id, this )" style="width:100%" tabindex="$tabIndex">              
                    <option value="">[$i18n.getString( "please_select" )]</option>
                    <option value="true" #if( $patientAttributeValue.value == "true" ) selected="selected" #end>$i18n.getString( "yes" )</option>
                    <option value="false" #if( $patientAttributeValue.value == "false" ) selected="selected" #end>$i18n.getString( "no" )</option>
                </select>                
            #elseif( $patientAttribute.valueType == "DATE" )
                <input type="text" id="value[$patientAttribute.id].date" name="entryfield" value="$!encoder.htmlEncode( $patientAttributeValue.value )" onchange="saveDate( $patient.id, $patientAttribute.id, '$encoder.jsEncode( $patientAttribute.name )' )" tabindex="$tabIndex" >
                    <img src="../images/calendar_icon.gif" width="16" height="16" id="getDateValue$patientAttribute.id" style="cursor: pointer;" title="$i18n.getString("date_selector")" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''" alt="$i18n.getString( "date" )">
                    <script type="text/javascript">
                        Calendar.setup({
                            inputField     :    "value[$patientAttribute.id].date",      // id of the input field
                            ifFormat       :    "$i18n.getString("format.date.label")",       // format of the input field
                            button         :    "getDateValue$patientAttribute.id"   // trigger for the calendar (button ID)
                        });
                    </script>     
            #elseif( $patientAttribute.valueType == "COMBO" )
					<select name="entryselect" id="value[$patientAttribute.id].combo"  name="entryfield" onchange="saveCombo( $patient.id, $patientAttribute.id, this)" tabindex="$tabIndex"  >
						 <option value="">[$i18n.getString( "please_select" )]</option>
						#foreach ($option in $patientAttribute.attributeOptions )
							<option value="$option.id" #if($patientAttributeValue.patientAttributeOption.id == $option.id ) selected="selected" #end>$option.name</option>
						#end
					</select>
            #else
                <input name="entryfield" id="value[$patientAttribute.id].value" type="text" value="$!encoder.htmlEncode( $patientAttributeValue.value )" onchange="saveAttributeValue( $patient.id, $patientAttribute.id, '$encoder.jsEncode( $dataElement.name )' )" onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
            #end
        </td>       
    </tr>
    #set( $tabIndex = $tabIndex + 1 )
#end
#end
<tr style="background-color: #BFD0FF;"><td colspan="4">$i18n.getString("other_attributes")</td></tr>
#foreach( $patientAttribute in $patientNoGroupAttributes )
    #set( $rowCount = $rowCount + 1 )    
    #if( $mark == 1 )
        #set( $mark = 0 )
    #else
        #set( $mark = 1 )
    #end    
    #set( $patientAttributeValue = false )
    #set( $patientAttributeValue = $patientAttributeValueMap.get( $patientAttribute.id ) )    
    <tr #if( $mark == 0 ) style="background-color:#dddddd" #end>
        ##rowCount
        <td style="text-align: center">$rowCount</td>
                
        ##attribute name
        <td>
            <span id="value[$patientAttribute.id].name" title="$!encoder.htmlEncode( $patientAttribute.description )">
                $encoder.htmlEncode( $patientAttribute.name )            
            </span>
        </td>        
        ##type        
        <td>            
            <span id="value[$patientAttribute.id].valueType">$encoder.htmlEncode( $patientAttribute.valueType )</span>
        </td>       
        ##entry        
        <td>        
            #if( $patientAttribute.valueType == "YES/NO" )
                <select name="entryselect" id="value[$patientAttribute.id].boolean" onchange="saveBoolean( $patient.id, $patientAttribute.id, this )" style="width:100%" tabindex="$tabIndex">              
                    <option value="">[$i18n.getString( "please_select" )]</option>
                    <option value="true" #if( $patientAttributeValue.value == "true" ) selected="selected" #end>$i18n.getString( "yes" )</option>
                    <option value="false" #if( $patientAttributeValue.value == "false" ) selected="selected" #end>$i18n.getString( "no" )</option>
                </select>                
            #elseif( $patientAttribute.valueType == "DATE" )
                <input type="text" id="value[$patientAttribute.id].date" name="entryfield" value="$!encoder.htmlEncode( $patientAttributeValue.value )" onchange="saveDate( $patient.id, $patientAttribute.id, '$encoder.jsEncode( $patientAttribute.name )' )" tabindex="$tabIndex" >
                    <img src="../images/calendar_icon.gif" width="16" height="16" id="getDateValue$patientAttribute.id" style="cursor: pointer;" title="$i18n.getString("date_selector")" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''" alt="$i18n.getString( "date" )">
                    <script type="text/javascript">
                        Calendar.setup({
                            inputField     :    "value[$patientAttribute.id].date",      // id of the input field
                            ifFormat       :    "$i18n.getString("format.date.label")",       // format of the input field
                            button         :    "getDateValue$patientAttribute.id"   // trigger for the calendar (button ID)
                        });
                    </script>     
            #elseif( $patientAttribute.valueType == "COMBO" )
					<select name="entryselect" id="value[$patientAttribute.id].combo"  name="entryfield" onchange="saveCombo( $patient.id, $patientAttribute.id, this )" tabindex="$tabIndex"  >
						 <option value="">[$i18n.getString( "please_select" )]</option>
						#foreach ($option in $patientAttribute.attributeOptions )
							<option value="$option.id" #if($patientAttributeValue.patientAttributeOption.id == $option.id ) selected="selected" #end>$option.name</option>
						#end
					</select>
            #else
                <input name="entryfield" id="value[$patientAttribute.id].value" type="text" value="$!encoder.htmlEncode( $patientAttributeValue.value )" onchange="saveAttributeValue( $patient.id, $patientAttribute.id, '$encoder.jsEncode( $dataElement.name )' )" onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
            #end
        </td>       
    </tr>
    #set( $tabIndex = $tabIndex + 1 )
#end
</table>

</form>     

<script type="text/javascript">    
    var i18n_value_must_integer = '$encoder.jsEscape( $i18n.getString( "value_must_integer" ) , "'")';
    var i18n_invalid_date = '$encoder.jsEscape( $i18n.getString( "invalid_date" ) , "'")'; 
    var i18n_saving_value_failed_status_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_status_code" ) , "'")';
    var i18n_saving_value_failed_error_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_error_code" ) , "'")';
    var i18n_searching_patient_failed = '$encoder.jsEscape( $i18n.getString( "searching_patient_failed" ) , "'")';
    var i18n_duplicate_identifier = 'Duplicate Identifier';
</script>
