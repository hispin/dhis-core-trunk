
<h3>$i18n.getString( "update_patient" )</h3>

<form id="updatePatientForm" action="updatePatient.action" method="post">
<div>
	<input type="hidden" id="id" name="id" value="$patient.id">
</div>

<table>
	<tr>
		<th colspan="2">$i18n.getString( "patient_identifier_s" )</th>
	</tr>
	<tr>
		<td><label for="identifier">$i18n.getString( "identifier" )</label></td>
		<td><input type="text" readonly="readonly" id="identifier" name="identifier" value="$encoder.htmlEncode( $patientIdentifier.identifier )" style="width:30em"></td>
	</tr>	
	<tr><td>&nbsp;</td></tr>	
	<tr>
		<th colspan="2">$i18n.getString( "name" )</th>
	</tr>
	<tr>
		<td><label for="firstName">$i18n.getString( "first_name" )</label></td>
		<td><input type="text" id="firstName" name="firstName" value="$encoder.htmlEncode( $patient.firstName )" style="width:30em"></td>
	</tr>
	<tr>
		<td><label for="middleName">$i18n.getString( "middle_name" ) </label></td>
		<td><input type="text" id="middleName" name="middleName" value="$encoder.htmlEncode( $patient.middleName )" style="width:30em"></td>
	</tr>
	<tr>
		<td><label for="lastName">$i18n.getString( "last_name" )</label></td>
		<td><input type="text" id="lastName" name="lastName" value="$encoder.htmlEncode( $patient.lastName )" style="width:30em"></td>
	</tr>
	<tr><td>&nbsp;</td></tr>	
	<tr>
		<th colspan="2">$i18n.getString( "demographics" )</th>
	</tr>
	<tr>
		<td><label for="gender">$i18n.getString( "gender" )</label></td>
		<td>
			<select id="gender" name="gender" style="min-width:20em">
				<option value="M" #if( $patient.gender == 'M' ) selected="selected" #end>$i18n.getString( "male" )</option>
				<option value="F" #if( $patient.gender == 'F' ) selected="selected" #end>$i18n.getString( "female" )</option>
			</select>
		</td>					
	</tr>	
	<tr>
		<td><label for="birthDate">$i18n.getString( "date_of_birth" ) </label></td>
		<td>
		    <input type="text" id="birthDate" name="birthDate" value="$format.formatDate( $patient.birthDate )" style="width:10em">
		    <img src="../images/calendar_icon.gif" width="16" height="16" id="getBirthDate" style="cursor: pointer;" title="$i18n.getString("date_selector")" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''" alt="$i18n.getString( "date_of_birth" )">		    
            &nbsp;&nbsp;&nbsp;
            <label for="estimated">$i18n.getString( "estimated" )</label>
            <input type="checkbox" id="birthDateEstimated" name="birthDateEstimated" value="true" #if( $patient.birthDateEstimated ) checked="checked" #end>
            &nbsp;
            <label for="age">$i18n.getString( "age" )</label>&nbsp;&nbsp;$encoder.htmlEncode( $patient.getAge() )            
        </td> 
	</tr>  
		<tr><td>&nbsp;</td></tr>	
	<tr>
		<th colspan="2">$i18n.getString( "mandatory_attribute" )</th>
	</tr>
    
#set( $rowCount = 0 )
#set( $mark = 0 )
#set( $tabIndex = 1 )

#foreach( $patientAttribute in $patientAttributes )
    #set( $rowCount = $rowCount + 1 )
    #set( $patientAttributeValue = false )
    #set( $patientAttributeValue = $patientAttributeValueMap.get( $patientAttribute.id ) )    
    <tr #if( $mark == 0 ) style="background-color:#dddddd" #end>
        <td>
            <span id="value[$patientAttribute.id].name" title="$!encoder.htmlEncode( $patientAttribute.description )">
                $rowCount. $encoder.htmlEncode( $patientAttribute.name )            
            </span>
        </td>        
        ##type        ##entry        
        <td>        
            #if( $patientAttribute.valueType == "bool" )
                <select name="$patientAttribute.id" id="$patientAttribute.id" style="width:100%" tabindex="$tabIndex">              
                    <option value="">[$i18n.getString( "please_select" )]</option>
                    <option value="true" #if( $patientAttributeValueMap.get($patientAttribute.id ) == "true" ) selected="selected" #end>$i18n.getString( "yes" )</option>
                    <option value="false" #if( $patientAttributeValueMap.get($patientAttribute.id ) == "false" ) selected="selected" #end>$i18n.getString( "no" )</option>
                </select>                
            #elseif( $patientAttribute.valueType == "date" )
                <input type="text" id="$patientAttribute.id" name="$patientAttribute.id" value="$!encoder.htmlEncode( $patientAttributeValueMap.get($patientAttribute.id ))" onchange="validateAttributeValue(  $patientAttribute.id, '$encoder.jsEncode( $patientAttribute.name )' , '$patientAttribute.valueType')" tabindex="$tabIndex" >
                    <img src="../images/calendar_icon.gif" width="16" height="16" id="getDateValue$patientAttribute.id" style="cursor: pointer;" title="$i18n.getString("date_selector")" onmouseover="this.style.background='orange';" onmouseout="this.style.background=''" alt="$i18n.getString( "date" )">
                    <script type="text/javascript">
                        Calendar.setup({
                            inputField     :    "$patientAttribute.id",      // id of the input field
                            ifFormat       :    "$i18n.getString("format.date.label")",       // format of the input field
                            button         :    "getDateValue$patientAttribute.id"   // trigger for the calendar (button ID)
                        });
                    </script>                    
            #else
                <input name="$patientAttribute.id" id="$patientAttribute.id" type="text" value="$!encoder.htmlEncode( $patientAttributeValueMap.get($patientAttribute.id ) )" onchange="validateAttributeValue( $patientAttribute.id, '$encoder.jsEncode( $patientAttribute.name )' , '$patientAttribute.valueType')" tabindex="$tabIndex" >
            #end
        </td>       
    </tr>
    #set( $tabIndex = $tabIndex + 1 )
#end

</table>

<p>
	<input type="button" value="$i18n.getString( "update" )" onclick="validateUpdatePatient()" style="width:10em">
	<input type="button" value="$i18n.getString( "cancel" )" onclick="window.location.href='searchPatient.action'" style="width:10em">
</p>

</form> 	

<span id="message"></span>

<script type="text/javascript">	
	
	var firstNameField = document.getElementById( 'firstName' );
	firstNameField.select();
	firstNameField.focus();

</script>

<script type="text/javascript">
        Calendar.setup({
            inputField     :    "birthDate",      // id of the input field
            ifFormat       :    "$i18n.getString("format.date.label")",       // format of the input field
            button         :    "getBirthDate"   // trigger for the calendar (button ID)
        });
		
	var i18n_value_must_integer = '$encoder.jsEscape( $i18n.getString( "value_must_integer" ) , "'")';
	var i18n_value_must_date = '$encoder.jsEscape( $i18n.getString( "value_must_date" ) , "'")';

</script>

				