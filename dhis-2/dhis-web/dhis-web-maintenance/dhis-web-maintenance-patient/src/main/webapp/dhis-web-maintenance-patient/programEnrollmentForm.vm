
<script>
	//-----------------------------------------------------------------------
	//init jQuery validation for programEnrollmentForm
	//-----------------------------------------------------------------------
	jQuery(document).ready(
			function()
			{
				jQuery("#programEnrollmentForm").validate({
					 meta:"validate"
					,errorElement:"td"
					,submitHandler: function(form)
									{
										validateProgramEnrollment();
									}
				});

                datePickerValid( 'enrollmentDate' );
                datePickerValid( 'dateOfIncident' );
			}
	);

</script>

#parse( "/dhis-web-maintenance-patient/programEnrollmentSelectForm.vm" )

<form id="programEnrollmentForm" name="programEnrollmentForm" method="post" action="saveProgramEnrollment.action" onsubmit="return validateProgramEnrollment()">

<table width="100%">
    <tr>
        <td style="width:180px"><label for="enrollmentDate" #if($selectedProgram) title="$!selectedProgram.dateOfEnrollmentDescription" #end>$i18n.getString( "date_of_enrollment" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
        <td><input type="text" id="enrollmentDate" name="enrollmentDate" #if( $programInstance ) value="$!format.formatDate( $programInstance.enrollmentDate )" #end> <i>( $!selectedProgram.dateOfEnrollmentDescription )</i></td>
    </tr>
    
    <tr>
        <td style="width:180px"><label for="dateOfIncident" #if($selectedProgram) title="$!selectedProgram.dateOfIncidentDescription" #end>$i18n.getString( "date_of_incident" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
        <td><input type="text" id="dateOfIncident" name="dateOfIncident" #if( $programInstance ) value="$!format.formatDate( $programInstance.dateOfIncident )" #end><i>( $!selectedProgram.dateOfIncidentDescription )</i></td>
    </tr>
#if($!programInstance.enrollmentDate) 
	<tr>
		<td colspan='3'><h2>$i18n.getString('patient_info')<br><hr/></h2></td>	
	<tr>
	#foreach($attribute in $attributes)
	<tr>
        <td>$attribute.name</td>
		<td class="input-column">
			#if( $attribute.valueType == "YES/NO" )
				<select id="attr$attribute.id"  name="attr$attribute.id" style="width:100"> 
					<option value="">[$i18n.getString( "please_select" )]</option>
					<option value="true">$i18n.getString( "yes" )</option>
					<option value="false" selected="selected">$i18n.getString( "no" )</option>
				</select>                
			#elseif( $attribute.valueType == "DATE" )
				<input type="text" id="attr$attribute.id"  name="attr$attribute.id">
				<script type="text/javascript">
					datePickerValid( 'attr$attribute.id' );
				</script>                    
			#elseif( $attribute.valueType == "COMBO" )
				<select  id="attr$attribute.id"  name="attr$attribute.id">
					<option value="">[$i18n.getString( "please_select" )]</option>
					#foreach ($option in $attribute.attributeOptions )
						<option value="$option.id" >$option.name</option>
					#end
				</select>
			#else 
				<input type="text"  id="attr$attribute.id"  name="attr$attribute.id">
			#end
			
			#if($!programAttribute.description) <i>($!programAttribute.description)</i> #end
		</td>		
    </tr>
	#end
	<tr>
        <td></td>
        <td></td>   
        <td></td>                             
    </tr>
	
</table>
<hr/>
#end

<table>
	<tr>
		<td style="width:180px">
			<input type="submit" #if( $programInstance ) value="$i18n.getString( "update" )#else value="$i18n.getString( "enroll" 	) #end">
			<input type="button" value="$i18n.getString( "unenroll" )" onclick="javascript: removeEnrollment();" #if( !$programInstance ) disabled="disabled" #end>
		</td>                                        
	</tr>
</table>

#if( $programInstance )
<table class="mainPageTable">
    <col id="noCol">
    <col id="stageCol">    
    <col id="entryCol">    
    <tr>
        <th>$i18n.getString( "nr" )</th>
        <th>$i18n.getString( "program_stage" )</th>                   
        <th>$i18n.getString( "due_date" )</th>        
    </tr>
    
#set( $rowCount = 0 )
#set( $mark = 0 )
#set( $tabIndex = 1 )

#foreach( $programStageInstance in $programStageInstances )
    #set( $rowCount = $rowCount + 1 )    
    #if( $mark == 1 )
        #set( $mark = 0 )
    #else
        #set( $mark = 1 )
    #end       
    <tr #if( $mark == 0 ) style="background-color:#dddddd" #end>
        ##rowCount
        <td style="text-align:right">$rowCount</td>        
        ##stage name
        <td>
            <span id="value[$programStageInstance.id].name" title="$!encoder.htmlEncode( $programStageInstance.programStage.description )">
                $encoder.htmlEncode( $programStageInstance.programStage.name )            
            </span>
        </td>        
               
        ##entry
		#set( $duedateId = "value_"+$programStageInstance.id+"_date" )        
        <td>        
            <input type="text" id="$duedateId" name="entryfield" value="$!format.formatDate( $programStageInstance.dueDate )" onchange="saveDueDate( $programStageInstance.id, '$encoder.jsEncode( $programStageInstance.programStage.name )' )" tabindex="$tabIndex" >
        </td>
		<script type="text/javascript">
			datePickerValid( '$duedateId' );
		</script>       
    </tr>
    #set( $tabIndex = $tabIndex + 1 )
#end
</table>

</form>
 
#end

<span id="message"></span>

<script type="text/javascript">    
    var i18n_program_enrollment_failed = '$encoder.jsEscape( $i18n.getString( "program_enrollment_failed" ) , "'")';
    var i18n_saving_value_failed_status_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_status_code" ) , "'")';
    var i18n_saving_value_failed_error_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_error_code" ) , "'")';
    var i18n_searching_patient_failed = '$encoder.jsEscape( $i18n.getString( "searching_patient_failed" ) , "'")'; 
	var i18n_due_date_invalid = '$encoder.jsEscape( $i18n.getString( "due_date_invalid" ) , "'")';
</script>
