
<script>
	//-----------------------------------------------------------------------
	//init jQuery validation for programEnrollmentForm
	//-----------------------------------------------------------------------
	jQuery(document).ready(
			function()
			{
				jQuery("#programEnrollmentForm").validate({
					 meta:"validate"
					,errorElement:"td"
					,submitHandler: function(form)
									{
										validateProgramEnrollment();
									}
				});

                datePickerValid( 'enrollmentDate' );
                datePickerValid( 'dateOfIncident' );
			}
	);

</script>

#parse( "/dhis-web-maintenance-patient/programEnrollmentSelectForm.vm" )

<form id="programEnrollmentForm" name="programEnrollmentForm" method="post" action="saveProgramEnrollment.action" onsubmit="return validateProgramEnrollment()">

<table width="100%">
    <tr>
        <td style="width:180px"><label for="enrollmentDate" #if($selectedProgram) title="$!selectedProgram.dateOfEnrollmentDescription" #end>$i18n.getString( "date_of_enrollment" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
        <td><input type="text" id="enrollmentDate" name="enrollmentDate" #if( $programInstance ) value="$!format.formatDate( $programInstance.enrollmentDate )" #end> <i>( $!selectedProgram.dateOfEnrollmentDescription )</i></td>
    </tr>
    
    <tr>
        <td style="width:180px"><label for="dateOfIncident" #if($selectedProgram) title="$!selectedProgram.dateOfIncidentDescription" #end>$i18n.getString( "date_of_incident" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
        <td><input type="text" id="dateOfIncident" name="dateOfIncident" #if( $programInstance ) value="$!format.formatDate( $programInstance.dateOfIncident )" #end><i>( $!selectedProgram.dateOfIncidentDescription )</i></td>
    </tr>
	<tr>
        <td></td>
        <td></td>   
        <td></td>                             
    </tr>
	
</table>

<table>
	<tr>
		<td style="width:180px">
			<input type="submit" #if( $programInstance ) value="$i18n.getString( "update" )#else value="$i18n.getString( "enroll" 	) #end">
		</td>                                        
	</tr>
</table>

#if( $programInstance )
<table class="mainPageTable">
    <col id="noCol">
    <col id="stageCol">    
    <col id="entryCol">    
    <tr>
        <th>$i18n.getString( "nr" )</th>
        <th>$i18n.getString( "program_stage" )</th>                   
        <th>$i18n.getString( "due_date" )</th>        
    </tr>
    
#set( $rowCount = 0 )
#set( $mark = 0 )
#set( $tabIndex = 1 )

#foreach( $programStageInstance in $programStageInstances )
    #set( $rowCount = $rowCount + 1 )    
    #if( $mark == 1 )
        #set( $mark = 0 )
    #else
        #set( $mark = 1 )
    #end       
    <tr #if( $mark == 0 ) style="background-color:#dddddd" #end>
        ##rowCount
        <td style="text-align:right">$rowCount</td>        
        ##stage name
        <td>
            <span id="value[$programStageInstance.id].name" title="$!encoder.htmlEncode( $programStageInstance.programStage.description )">
                $encoder.htmlEncode( $programStageInstance.programStage.name )            
            </span>
        </td>        
               
        ##entry
		#set( $duedateId = "value_"+$programStageInstance.id+"_date" )        
        <td>        
            <input type="text" id="$duedateId" name="entryfield" value="$!format.formatDate( $programStageInstance.dueDate )" onchange="saveDueDate( $programStageInstance.id, '$encoder.jsEncode( $programStageInstance.programStage.name )' )" tabindex="$tabIndex" >
        </td>
		<script type="text/javascript">
			datePickerValid( '$duedateId' );
		</script>       
    </tr>
    #set( $tabIndex = $tabIndex + 1 )
#end
</table>

</form>
 
#end

<span id="message"></span>

<script type="text/javascript">    
    var i18n_program_enrollment_failed = '$encoder.jsEscape( $i18n.getString( "program_enrollment_failed" ) , "'")';
    var i18n_saving_value_failed_status_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_status_code" ) , "'")';
    var i18n_saving_value_failed_error_code = '$encoder.jsEscape( $i18n.getString( "saving_value_failed_error_code" ) , "'")';
    var i18n_searching_patient_failed = '$encoder.jsEscape( $i18n.getString( "searching_patient_failed" ) , "'")'; 
	var i18n_date_invalid = '$encoder.jsEscape( $i18n.getString( "date_invalid" ) , "'")';
	var i18n_date_less_incident = '$encoder.jsEscape( $i18n.getString( "date_less_incident" ) , "'")';
</script>
