#parse( "/dhis-web-maintenance-patient/patient.vm" )

#if($searchText) 
	#set ($sText = $searchText )
#else 
	#set ($sText = "" )
#end

<style>
tr.relationship-row{background-color: #BFFFC2; display : none}
</style>

<table>
	<tr>
		<td>$i18n.getString( "search_result_matching_the_search_criteria" )</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>$i18n.getString( $sText )</td>
	</tr>	
	<tr>
		<td>$i18n.getString( "total_result" )</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>$total</td>
	</tr>
</table>

<table class="mainPageTable">
  	
  <tr>
    <td style="vertical-align:top">    
      <table class="listTable">                   
          <col>
            #if($mapPatientPatientAttr.size()!=0)
                <col>
            #end
          <col>
          <col>
          <col>
          <col>
          <col>
          <col>
          <col width="20">
          <col width="20">
          <col width="20">
          <!--<col width="20">-->
          <col width="20">
          <col width="20">   
          <col width="20">     
          
		  <tr>
		  	<td></td>
		  	<td></td>
		  	<td></td>
		  	<td></td>
		  	<td></td>
		  	<td></td>
		  	<td></td>
		  	<td colspan="7" style="text-align:right">			
				<input type="button" value="$i18n.getString( "cancel" )" onclick="window.location.href='patient.action'" style="width:10em">
			</td>
          <tr>
            <th>#</th>
            #if($mapPatientPatientAttr.size()!=0)
                <th>$patientAttribute.name</th>
            #end
            <th>$i18n.getString( "first_name" )</th>
            <th>$i18n.getString( "middle_name" )</th>
            <th>$i18n.getString( "last_name" )</th>            
            <th>$i18n.getString( "gender" )</th>
            <th>$i18n.getString( "date_of_birth" )</th> 
            <th>$i18n.getString( "age" )</th>
            <th colspan="7" style="text-align:center">$i18n.getString( "operations" )</th>
          </tr>
          
          <tbody id="list">	
		  
          #foreach( $patient in $patients )
          	<tr id="tr${patient.id}">
          	<td>
                    #set( $nr = ( ( $paging.getCurrentPage() - 1  ) * $paging.pageSize ) + $velocityCount )
                    $nr
		</td>
                #if($mapPatientPatientAttr.size()!=0)
                    <td>
                        $mapPatientPatientAttr.get($patient)
                    </td>
                #end
                
		<td>			
                    $!patient.firstName
		</td>
		<td>			
                    $!patient.middleName
		</td>
		<td>			
                    $!patient.lastName
		</td>				
		<td>			
                    $!patient.gender
		</td>
		<td>			
                    $format.formatDate( $!patient.birthDate)
		</td>
		<td>            
                    $!patient.getAge()
        </td>
				
		<td style="text-align:center"#alternate( $mark )>
                  <a href="showProgramEnrollmentForm.action?id=$patient.id" title="$i18n.getString( "manage_program_enrollment" )"><img src="../images/enroll.png" alt="$i18n.getString( "manage_program_enrollment" )"></a>                  
                </td>                
                
                <td style="text-align:center"#alternate( $mark )>                  
                  <a href="showUpdatePatientForm.action?id=$patient.id" title="$i18n.getString( "edit_profile" )"><img src="../images/edit.png" alt="$i18n.getString( "edit_profile" )"></a>
                </td>
				
                <td style="text-align:center"#alternate( $mark )>                  
                  <a href="showRelationshipList.action?id=$patient.id" title="$i18n.getString( "manage_relationship" )"><img src="../images/relationship.png" alt="$i18n.getString( "manage_relationship" )"></a>
                </td>        
                
                <td style="text-align:center"#alternate( $mark )>                  
                  <a href="showAddRelationshipPatient.action?id=$patient.id" title="$i18n.getString( "add_dependent" )"><img src="../images/add.png" alt="$i18n.getString( "add_dependent" )"></a>
                </td>                        
 
                <td style="text-align:center"#alternate( $mark )>
                  <a href="javascript:removePatient( '$patient.id', '$encoder.jsEncode( $patient.getFullName() )' )" title="$i18n.getString( "remove" )"><img src="../images/delete.png" alt="$i18n.getString( "remove" )"></a>
                </td>            
                
                <td style="text-align:center"#alternate( $mark )>
                  <a href="javascript:showPatientDetails( $patient.id )" title="$i18n.getString( "show_details" )"><img src="../images/information.png" alt="$i18n.getString( "show_details" )"></a>
                </td>
				
			</tr>
			#set( $relationships = $mapRelationShip.get($patient.id))
			 #foreach( $relationship in $relationships )
               <tr class="relationship-row listrow" >
                   #set( $partnerId = false )    
                   #if( $relationship.patientA.id == $patient.id )
                       #set( $partnerId = $relationship.patientB.id )
                       #set ( $partner = $relationship.patientB ) 
                       <td>                                
                           $encoder.htmlEncode( $relationship.relationshipType.BIsToA )
                       </td>
                   #elseif($relationship.patientB.id == $patient.id )
                       #set( $partnerId = $relationship.patientA.id )
                       #set ( $partner = $relationship.patientA )
                       <td>                                
                           $encoder.htmlEncode( $relationship.relationshipType.AIsToB )
                       </td>
                   #end                  
                    <td>			
						$encoder.htmlEncode( $partner.firstName )
					</td>
					<td>			
						$encoder.htmlEncode( $partner.middleName )
					</td>
					<td>			
						$encoder.htmlEncode( $partner.lastName )
					</td>
                   <td>
                   		$encoder.htmlEncode( $partner.gender )
                   </td>
                   
                   <td>			
						$format.formatDate( $partner.birthDate )
				   </td>
                   
                  <td >            
                    $encoder.htmlEncode( $partner.getAge() )
	                </td>
					
					<td style="text-align:center">
	                  <a href="showProgramEnrollmentForm.action?id=$partner.id" title="$i18n.getString( "manage_program_enrollment" )"><img src="../images/enroll.png" alt="$i18n.getString( "manage_program_enrollment" )"></a>                  
	                </td>                
	                
	                <td style="text-align:center">                  
	                  <a href="showUpdatePatientForm.action?id=$patient.id" title="$i18n.getString( "edit_profile" )"><img src="../images/edit.png" alt="$i18n.getString( "edit_profile" )"></a>
	                </td>
	                
	                <td style="text-align:center">
	                  <a href="showUpdatePatientAttributeValueForm.action?id=$patient.id" title="$i18n.getString( "edit_attribute_values" )"><img src="../images/attribute.png" alt="$i18n.getString( "edit_attribute_values" )"></a>
	                </td>
	                
	                <td style="text-align:center">                  
	                  <a href="showRelationshipList.action?id=$patient.id" title="$i18n.getString( "manage_relationship" )"><img src="../images/relationship.png" alt="$i18n.getString( "manage_relationship" )"></a>
	                </td>        
	                
	                <td style="text-align:center">                  
	                  <a href="showAddRelationshipPatient.action?id=$patient.id" title="$i18n.getString( "add_dependent" )"><img src="../images/add.png" alt="$i18n.getString( "add_dependent" )"></a>
	                </td>                        
	 
	                <td style="text-align:center">
	                  <a href="javascript:removePatient( '$partner.id', '$encoder.jsEncode( $partner.getFullName() )' )" title="$i18n.getString( "remove" )"><img src="../images/delete.png" alt="$i18n.getString( "remove" )"></a>
	                </td>            
	                
	                <td style="text-align:center">
	                  <a href="javascript:showPatientDetails( $partner.id )" title="$i18n.getString( "show_details" )"><img src="../images/information.png" alt="$i18n.getString( "show_details" )"></a>
	                </td>
               </tr>
			#end
    	#end
    	</tbody>
    
	 </table>
    </td>
  </tr>
  <tr>
  	<td colspan="6">
		<p></p>
  		<div class="paging-container">
				#parse( "/dhis-web-commons/paging/paging.vm" )
		</div>
	</td>
  	<td></td>
  </tr>
</table>
<script type="text/javascript">
	var i18n_confirm_delete = '$encoder.jsEscape( $i18n.getString( "confirm_delete_patient" ) , "'" )';
	var i18n_adding_patient_failed = '$encoder.jsEscape( $i18n.getString( "adding_patient_failed" ), "'")';
	var i18n_updating_patient_failed = '$encoder.jsEscape( $i18n.getString( "updating_patient_failed" ), "'")';	
	var i18n_none = '$encoder.jsEscape( $i18n.getString( "none" ), "'")';
	
	var i18n_id = '$encoder.jsEscape( $i18n.getString( "id" ), "'")';
	var i18n_full_name = '$encoder.jsEscape( $i18n.getString( "full_name" ), "'")';
	var i18n_gender = '$encoder.jsEscape( $i18n.getString( "gender" ), "'")';
	var i18n_dob_type = '$encoder.jsEscape( $i18n.getString( "dob_type" ), "'")';
	var i18n_date_of_birth = '$encoder.jsEscape( $i18n.getString( "date_of_birth" ), "'")';
	var i18n_blood_group = '$encoder.jsEscape( $i18n.getString( "blood_group" ), "'")';
</script>

<div id="detailsArea" style="display:none;overflow:auto;height:250px;width:250px">
	<div style="float:right">
		<a href="javascript:hideDetails()" title="$i18n.getString( "hide_details" )"><img src="../images/close.png" alt="$i18n.getString( "hide_details" )"></a>
	</div>
	<p><label>$i18n.getString( "common_info" ):</label><br><span id="commonInfoField"></span></p>	
	<p><label>$i18n.getString( "identifier" ):</label><br><span id="identifierField"></span></p>
	<p><label>$i18n.getString( "attributes" ):</label><br><span id="attributeField"></span></p>
	<p><label>$i18n.getString( "enrolled_in_program" ):</label><br><span id="programField"></span></p>
</div>
