<script type="text/javascript">
	
	jQuery(document).ready(function(){	
		tableSorter( 'patientList' );
	});
	
	var i18n_confirm_delete = '$encoder.jsEscape( $i18n.getString( "confirm_delete_patient" ) , "'" )';
	var i18n_adding_patient_failed = '$encoder.jsEscape( $i18n.getString( "adding_patient_failed" ), "'")';
	var i18n_updating_patient_failed = '$encoder.jsEscape( $i18n.getString( "updating_patient_failed" ), "'")';	
	var i18n_none = '$encoder.jsEscape( $i18n.getString( "none" ), "'")';
	
	var i18n_id = '$encoder.jsEscape( $i18n.getString( "id" ), "'")';
	var i18n_full_name = '$encoder.jsEscape( $i18n.getString( "full_name" ), "'")';
	var i18n_gender = '$encoder.jsEscape( $i18n.getString( "gender" ), "'")';
	var i18n_dob_type = '$encoder.jsEscape( $i18n.getString( "dob_type" ), "'")';
	var i18n_date_of_birth = '$encoder.jsEscape( $i18n.getString( "date_of_birth" ), "'")';
	var i18n_blood_group = '$encoder.jsEscape( $i18n.getString( "blood_group" ), "'")';
	
	
</script>

<table>
	<tr>
		<td>$i18n.getString( "search_result_matching_the_search_criteria" )</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>
		    #if($!program)
				$i18n.getString( "list_patients_by_program") '$program.name'
			#elseif($!searchText) 
				$searchText
			#else 
				$i18n.getString( "list_all_patients" )
			#end
		</td>
	</tr>	
	<tr>
		<td>$i18n.getString( "total_result" )</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>$!total</td>
	</tr>
</table>

<table class="mainPageTable">
	<tr>
		<td colspan="14" style="text-align:right">			
			<input type="button" value="$i18n.getString( 'cancel' )" onclick="window.location.href='patient.action'" style="width:10em; align:right;">
		</td>
	</tr>	
	
	<tr>
    <td>    
      <table class="listTable" id="patientList" width='100%'>               
          <col width="30"/>
            #if($mapPatientPatientAttr.size()!=0)
                <col/>
            #end
          <col/>
          <col/>
          <col/>
          <col/>
          <col/>
          <col/>
		  #if($mapPatientOrgunit.size()!=0)
          <col/>
		  #end
          <col width="200"/>    
		  
		  <thead>
			<tr>
				<th>#</th>
				#if($mapPatientPatientAttr.size()!=0)
					<th id="patientAttributeName"></th>
					<script>
						var selectedAttr = byId("sortPatientAttributeId");
						byId('patientAttributeName').innerHTML = selectedAttr.options[selectedAttr.selectedIndex].text;
					</script>
				#end
				<th>$i18n.getString( "first_name" )</th>
				<th>$i18n.getString( "middle_name" )</th>
				<th>$i18n.getString( "last_name" )</th>            
				<th>$i18n.getString( "gender" )</th>
				<th>$i18n.getString( "date_of_birth" )</th> 
				<th class="{sorter: false}">$i18n.getString( "age" )</th>
				#if($mapPatientOrgunit.size()!=0)
				<th>$i18n.getString( "hierachy_orgunit" )</th>
				#end
				<th style="text-align:center" class="{sorter: false}">$i18n.getString( "operations" )</th>
			  </tr>
          </thead>
		  
          <tbody id="list">	
		  #set( $mark = false )
          #foreach( $patient in $patients )
          	<tr id="tr${patient.id}" #alternate( $mark )>
				
				<td>
					#set( $nr = ( ( $paging.getCurrentPage() - 1  ) * $paging.pageSize ) + $velocityCount )
					$nr
				</td>
				
				#if($!mapPatientPatientAttr.size()!=0)
				<td>
					$!mapPatientPatientAttr.get( $patient.id )
				</td>
				#end
					
				<td>$!patient.firstName</td>
				
				<td>$!patient.middleName</td>
				
				<td>$!patient.lastName</td>	
				
				<td>$!patient.gender</td>
				
				<td>$format.formatDate( $!patient.birthDate)</td>
				
				<td>$!patient.getAge()</td>
				
				#if($mapPatientOrgunit.size()!=0)
				
					<td>$!mapPatientOrgunit.get($patient.id)</td>
				
				#end
				
				<td style="text-align:center">
				  <a href="showProgramEnrollmentForm.action?id=$patient.id" title='$i18n.getString( "manage_program_enrollment" )'><img src="../images/enroll.png" alt='$i18n.getString( "manage_program_enrollment" )'></a>                  
				  <a href="showProgramUnEnrollmentForm.action?patientId=$patient.id" title='$i18n.getString( "manage_program_unenrollment" )'><img src="../images/unenroll.png" alt='$i18n.getString( "manage_program_unenrollment" )'></a>
				  <a href="showUpdatePatientForm.action?id=$patient.id" title='$i18n.getString( "edit_profile" )'><img src="../images/edit.png" alt='$i18n.getString( "edit_profile" )'></a>
				  <a href="showRelationshipList.action?id=$patient.id" title='$i18n.getString( "manage_relationship" )'><img src="../images/relationship.png" alt='$i18n.getString( "manage_relationship" )'></a>
				  <a href="showAddRelationshipPatient.action?id=$patient.id" title='$i18n.getString( "add_dependent" )'><img src="../images/add.png" alt='$i18n.getString( "add_dependent" )'></a>
				  <a href="javascript:removePatient( '$patient.id', '$encoder.jsEncode( $patient.getFullName() )' )" title='$i18n.getString( "remove" )'><img src="../images/delete.png" alt='$i18n.getString( "remove" )'></a>
				  <a href="javascript:showPatientDetails( $patient.id )" title='$i18n.getString( "show_details" )'><img src="../images/information.png" alt='$i18n.getString( "show_details" )'></a>
				</td>
				
			</tr>
			#set( $mark = !$mark)
    	#end
    	</tbody>
    
	 </table>
    </td>
  </tr>
  <tr>
  	<td colspan="6">
		<p></p>
  		<div class="paging-container">
				#parse( "/dhis-web-commons/paging/paging.vm" )
		</div>
	</td>
  	<td></td>
  </tr>
</table>

<div id="detailsArea" style="display:none;overflow:auto;height:250px;width:250px">
	<div style="float:right">
		<a href="javascript:hideDetails()" title="$i18n.getString( "hide_details" )"><img src="../images/close.png" alt="$i18n.getString( "hide_details" )"></a>
	</div>
	<p><label>$i18n.getString( "common_info" ):</label><br><span id="commonInfoField"></span></p>	
	<p><label>$i18n.getString( "identifier" ):</label><br><span id="identifierField"></span></p>
	<p><label>$i18n.getString( "attributes" ):</label><br><span id="attributeField"></span></p>
	<p><label>$i18n.getString( "enrolled_in_program" ):</label><br><span id="programField"></span></p>
</div>
