<script>
	jQuery(document).ready(	function(){
		validation( 'addDataElementForm', function( form ){
			form.submit();
		},function(){
			getDataElementIdsForValidate();
			getFactors();
			setFieldValue( 'submitCategoryComboId', getFieldValue( 'selectedCategoryComboId' ) );
			setFieldValue( 'submitValueType', getFieldValue( 'valueType' ) );
		});				
		
		checkValueIsExist( "name", "validateDataElement.action");
		checkValueIsExist( "shortName", "validateDataElement.action");
		checkValueIsExist( "alternativeName", "validateDataElement.action");
		toggleCDEForm();
		}  
	);
</script>

<h3>$i18n.getString( "create_new_data_element" )</h3>

<form id="addDataElementForm" action="addDataElement.action" method="POST" >
<input type="hidden" id="defaultCategoryCombo" value="$defaultCategoryCombo.id"/>
<select name="factors" id="factorsSubmit" multiple="multiple" style="display:none"></select>
<table>
	<tr>
		<th colspan="2">$i18n.getString( "details" )</th>
	</tr>
	<tr>
		<td style="width:200px"><label for="name">$i18n.getString( "name" ) <em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td><input type="text" id="name" name="name" style="width:20em" maxlength="150" class="{validate:{required:true,minlength:3,alphanumericwithbasicpuncspaces:true,notOnlyDigits:true}}"/></td>
	</tr>
	<tr>
		<td><label for="shortName">$i18n.getString( "short_name" ) <em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td><input type="text" id="shortName" name="shortName" style="width:20em" maxlength="20" class="{validate:{required:true,minlength:2,alphanumericwithbasicpuncspaces:true,notOnlyDigits:true}}"/></td>
	</tr>
	<tr>
		<td><label for="alternativeName">$i18n.getString( "alternative_name" )</label></td>
		<td><input type="text" id="alternativeName" name="alternativeName" style="width:20em" maxlength="150" class="{validate:{minlength:3,alphanumericwithbasicpuncspaces:true,notOnlyDigits:true}}"/></td>
	</tr>
	<tr>
		<td><label for="code">$i18n.getString( "code" )</label></td>
		<td><input type="text" id="code" name="code" style="width:20em" maxlength="40" class="{validate:{minlength:3,alphanumericwithbasicpuncspaces:true,notOnlyDigits:true}}"/></td>
	</tr>
	<tr>
		<td><label for="description">$i18n.getString( "description" )</label></td>
		<td><textarea id="description" name="description" style="width:20em; height:8em" maxlength="150" class="{validate:{minlength:3,alphanumericwithbasicpuncspaces:true,notOnlyDigits:true}}"></textarea></td>
	</tr>
	<tr>
		<td><label for="domainType">$i18n.getString( "domain_type" ) <em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td>
			<select id="domainType" name="domainType" style="min-width:20em">
				<option value="aggregate" selected="selected">$i18n.getString( "aggregate" )</option>
				<option value="patient">$i18n.getString( "patient" )</option>				
			</select>
		</td>
	</tr>
	<tr>
		<td><label for="valueType">$i18n.getString( "value_type" ) <em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td>
			<select id="valueType" style="min-width:20em"  onchange="changeValueType( this.value )">
				<option value="int" selected="selected" onclick="enable('numberType');">$i18n.getString( "number" )</option>
				<option value="string"onclick="disable('numberType');">$i18n.getString( "text" )</option>
				<option value="bool"onclick="disable('numberType');">$i18n.getString( "yes_no" )</option>
				<option value="date"onclick="disable('numberType');">$i18n.getString( "date" )</option>
			</select>
			<input type="hidden" id="submitValueType" name="valueType"/>
		</td>
	</tr>
	<tr>
		<td><label for="numberValueType">$i18n.getString( "number_value_type" )</label></td>
		<td>
			<select id="numberType" name="numberType" style="min-width:20em">
				<option value="number">$i18n.getString( "number" )</option>
				<option value="int" >$i18n.getString( "int" )</option>
				<option value="positiveNumber">$i18n.getString( "positiveNumber" )</option>
				<option value="negativeNumber">$i18n.getString( "negativeNumber" )</option>
			</select>
 		</td>
 	</tr>
	<tr>
		<td><label for="zeroIsSignificant ">$i18n.getString( "store_zero_data_values" )</label></td>
		<td>
			<select id="zeroIsSignificant" name="zeroIsSignificant" style="min-width:20em">
				<option value="" selected=selected>$i18n.getString( "select" )</option>				
				<option value="true" >$i18n.getString( "yes" )</option>				
				<option value="false">$i18n.getString( "no" )</option>
			</select>
 		</td>
 	</tr>
	<tr id="aggregationOperator">
		<td><label for="aggregationOperator">$i18n.getString( "aggregation_operator" ) <em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td>
			<select name="aggregationOperator" style="min-width:20em">
				<option value="sum" selected="selected">$i18n.getString( "sum" )</option>
				<option value="average">$i18n.getString( "average" )</option>
			</select>
		</td>
	</tr>
    <tr>
        <td><label for="url">$i18n.getString( "url" )</label></td>
        <td><input type="text" id="url" name="url" style="width:20em" maxlength="255" class="{validate:{url:true}}"/></td>
    </tr>
	<tr>	
		<td><label for="selectedCategoryComboId">$i18n.getString( "category_combo" ) <em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td>
			<select id="selectedCategoryComboId" style="min-width:20em" onchange="changeCategory(this.value)">				
			#foreach( $dataElementCategoryCombo in $dataElementCategoryCombos )
				<option value="$dataElementCategoryCombo.id" #if( $dataElementCategoryCombo.id == $defaultCategoryCombo.id ) selected="selected" #end>$encoder.htmlEncode( $dataElementCategoryCombo.name )</option>
			#end
			</select>
			<input type="hidden" id="submitCategoryComboId" name="selectedCategoryComboId"/>
		</td>
	</tr>
    <tr>
        <td style="height:10px"></td>
    </tr>
	<tr>
		<td><label for="calculated" id="lblCalculated">$i18n.getString( "calculated" )</label></td>
		<td><input type="checkbox" id="calculated" name="calculated" onchange="toggleCDEForm()"/></td>
    </tr>
</table>

<div id="calculatedContainer" style="border:1px solid #808080; padding:10px; display:none;">

<table>
    <tr>
        <td><label for="saved">$i18n.getString( "saved" )</label>&nbsp;
            <input type="checkbox" id="saved" name="saved" #if( $calculatedDataElement.saved ) checked="checked" #end/>
        </td>
    </tr>
    <tr>
        <td style="height:10px"></td>
    </tr>
    <tr>
    	<th>$i18n.getString( "available_dataelements" )</td>
    </tr>
    <tr>
    	<td>
	    	<select id="dataElementGroupId" name="dataElementGroupId" onchange="getDataElements( this.options[this.selectedIndex].value, 'int', true )" style="width:450px">
				<option value="[select]" selected="selected">[ $i18n.getString( "select_dataelementgroup" ) ]</option>
				<option value="$ALL">[ $i18n.getString( "all_dataelements" ) ]</option>
				#foreach ( $group in $dataElementGroups )
					<option value="$group.id">$group.name</option>
				#end
			</select><br/>
			<select id="availableDataElements" size="5" multiple="multiple" style="width:450px">
	            #foreach( $operand in $operands )
					<option value="[$operand.operandId]">$encoder.htmlEncode( $operand.operandName )</option>
				#end             
	        </select>		
		</td>
    </tr>
    <tr>
		<td>
			<input id="selectOneButton" type="button" value="$i18n.getString('add_selected')" title="$i18n.getString('add_selected')" onclick="addCDEDataElements()" style="width:120px"/><input 
			       id="deselectAllButton" type="button" value="$i18n.getString('remove_all')" title="$i18n.getString('remove_all')" onclick="removeCDEDataElements()" style="width:120px"/>
		</td>
    </tr>    
    <tr>
        <th>$i18n.getString( "selected_dataelements" )</th>
		<td><select id="selectedDEValidator" multiple="multiple" name="selectedDEValidator" style="display:none"></select></td>
    </tr>
    <tr>
		<td>
			<table id="selectedDataElements" style="min-width:450px">
				<tr>
					<td style="font-weight:bold;">$i18n.getString( "data_element" )</td>
					<td style="font-weight:bold;">$i18n.getString( "factor" )</td>
					<td style="font-weight:bold;">$i18n.getString( "remove" )</td>					
				</tr>
				<tbody>
	          		<tr class="placeholder">
	          			<td colspan="2">None selected</td>
	          		</tr>
				</tbody>
        	</table>
		</td>
	</tr>
</table>

</div>

<table>
	<tr>
		<td style="height:10px" colspan="2"></td>
	</tr>
	<tr>
		<td style="width:200px">$i18n.getString( "aggregation_levels" )</td>
		<td><input type="checkbox" onclick="toggleById( 'aggregationLevelsContainer' )"/></td>
	</tr>
</table>

<div id="aggregationLevelsContainer" style="border:1px solid #808080; padding:10px; width:465px; display:none;">

<table>
	<tr>
		<th style="width:450px">$i18n.getString( "available_aggregation_levels" )</th>
	</tr>
	<tr>
		<td>
			<select multiple size="4" id="organisationUnitLevels" style="width:450px" ondblclick="moveSelectedById( 'organisationUnitLevels', 'aggregationLevels' )">
			#foreach( $level in $organisationUnitLevels )
				<option value="$level.level">$level.name</option>
			#end
			</select>
		</td>
    </tr>
    <tr>
    	<td>
		    <input type="button" value="$i18n.getString( 'add_selected' )" title="$i18n.getString( 'add' )" style="width:120px" onclick="moveSelectedById( 'organisationUnitLevels', 'aggregationLevels' )"/><input 
		           type="button" value="$i18n.getString( 'remove_selected' )" title="$i18n.getString( 'remove' )" style="width:120px" onclick="moveSelectedById( 'aggregationLevels', 'organisationUnitLevels' )"/>
        </td>
    </tr>
    <tr>
        <th style="width:450px">$i18n.getString( "selected_aggregation_levels" )</th>
    </tr>
    </tr>
        <td>
        	<select multiple size="4" id="aggregationLevels" name="aggregationLevels" style="width:450px" ondblclick="moveSelectedById( 'aggregationLevels', 'organisationUnitLevels' )">
            </select>
        </td>
	</tr>
</table>

</div>

<p>
	<input type="submit" value="$i18n.getString( 'add' )" style="width:10em"/>
	<input type="button" value="$i18n.getString( 'cancel' )" onclick="window.location.href='dataElement.action'" style="width:10em"/>
</p>

</form>

<script type="text/javascript">

	var previousName = '';

</script>
