
<h3>$i18n.getString( "edit_data_element" )</h3>

<form id="updateDataElementForm" action="updateDataElement.action" method="post" onsubmit="return validateUpdateDataElement()">

<div>
	<input type="hidden" id="id" name="id" value="$dataElement.id">
</div>

<table>
	<tr>
		<th colspan="2">$i18n.getString( "details" )</th>
	</tr>
	<tr>
		<td><label for="name">$i18n.getString( "name" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td><input type="text" id="name" name="name" value="$encoder.htmlEncode( $dataElement.name )" onchange="nameChanged()" style="width:20em"></td>
	</tr>
	<tr>
		<td><label for="shortName">$i18n.getString( "short_name" )</label></td>
		<td><input type="text" id="shortName" name="shortName" value="$encoder.htmlEncode( $dataElement.shortName )" maxlength="20" style="width:20em"></td>
	</tr>
	<tr>
		<td><label for="alternativeName">$i18n.getString( "alternative_name" )</label></td>
		<td><input type="text" id="alternativeName" name="alternativeName" value="$!encoder.htmlEncode( $dataElement.alternativeName )" style="width:20em"></td>
	</tr>
	<tr>
		<td><label for="code">$i18n.getString( "code" )</label></td>
		<td><input type="text" id="code" name="code" value="$!encoder.htmlEncode( $dataElement.code )" style="width:20em"></td>
	</tr>
	<tr>
		<td><label for="description">$i18n.getString( "description" )</label></td>
		<td><textarea id="description" name="description" style="width:20em; height:8em">$!encoder.htmlEncode( $dataElement.description )</textarea></td>
	</tr>
	<tr>
		<td><label for="active">$i18n.getString( "active" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td>
			<select id="active" name="active" style="min-width:20em">
				<option value="true" #if( $dataElement.active ) selected="selected" #end>$i18n.getString( "yes" )</option>
				<option value="false" #if( !$dataElement.active ) selected="selected" #end>$i18n.getString( "no" )</option>
			</select>
		</td>
	</tr>
	<tr>
		<td><label for="type">$i18n.getString( "type" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td>
			<select id="type" name="type" style="min-width:20em">
				<option value="aggregate" #if( $dataElement.type == 'aggregate' ) selected="selected" #end>$i18n.getString( "aggregate" )</option>
				<option value="patient" #if( $dataElement.type == 'patient' ) selected="selected" #end>$i18n.getString( "patient" )</option>				
			</select>
		</td>
	</tr>
	<tr>
		<td><label for="valueType">$i18n.getString( "value_type" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td>
			<select id="valueType" name="valueType" style="min-width:20em">
				<option value="int" #if( $dataElement.valueType == 'int' ) selected="selected" #end>$i18n.getString( "number" )</option>
				<option value="string" #if( $dataElement.valueType == 'string' ) selected="selected" #end>$i18n.getString( "text" )</option>
				<option value="bool" #if( $dataElement.valueType == 'bool' ) selected="selected" #end>$i18n.getString( "yes_no" )</option>
				<option value="date" #if( $dataElement.valueType == 'date' ) selected="selected" #end>$i18n.getString( "date" )</option>
			</select>
		</td>
	</tr>
	<tr>
		<td><label for="aggregationOperator">$i18n.getString( "aggregation_operator" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td>
			<select id="aggregationOperator" name="aggregationOperator" style="min-width:20em">
				<option value="sum" #if( $dataElement.aggregationOperator == 'sum' ) selected="selected" #end>$i18n.getString( "sum" )</option>
				<option value="average" #if( $dataElement.aggregationOperator == 'average' ) selected="selected" #end>$i18n.getString( "average" )</option>
			</select>
		</td>
	</tr>
    <tr>
        <td><label for="url">$i18n.getString( "url" )</label></td>
        <td><input type="text" id="url" name="url" value="$!encoder.htmlEncode( $dataElement.url )" style="width:20em"></td>
    </tr>
	<tr #if( $calculatedDataElement ) style="display:none" #end >	
		<td><label for="selectedCategoryComboId">$i18n.getString( "category_combo" ) <em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td>
			<select id="selectedCategoryComboId" name="selectedCategoryComboId" style="min-width:20em" >				
				<option value="null">[$i18n.getString( "select" )]</option>
			#foreach( $dataElementCategoryCombo in $dataElementCategoryCombos )
				<option value="$dataElementCategoryCombo.id" #if( $dataElement.categoryCombo.id == $dataElementCategoryCombo.id ) selected="selected" #end>$encoder.htmlEncode( $dataElementCategoryCombo.name )</option>
			#end
			</select>
		</td>	
	</tr>
	#if ( $calculatedDataElement )
    <tr>
        <td style="height:10px"></td>
    </tr>
	<tr>
		<td><label for="saved">$i18n.getString( "calculated" )</label></td>
 		<td><input type="checkbox" id="calculated" name="calculated" checked="checked" disabled="disabled"></td>
	</tr>
	#end
</table>

#if ( $calculatedDataElement )
<table>
	<tr>
		<td><label for="saved">$i18n.getString('saved')</label>&nbsp;
		    <input type="checkbox" id="saved" name="saved" value="true" #if( $calculatedDataElement.saved ) checked="checked" #end>
		</td>
	</tr>
    <tr>
        <td style="height:10px"></td>
    </tr>
    <tr>
        <th style="width:450px">$i18n.getString( "available_dataelements" )</td>
    </tr>
	<tr>
		<td>
			<select id="dataElementGroupId" name="dataElementGroupId" onchange="getDataElements( this.options[this.selectedIndex].value, 'int', true )" style="width:30em">
				<option value="[select]" selected="selected">[ $i18n.getString( "select_dataelementgroup" ) ]</option>
				<option value="$ALL">[ $i18n.getString( "all_dataelements" ) ]</option>
				#foreach ( $group in $dataElementGroups )
					<option value="$group.id">$group.name</option>
				#end
			</select><br>
			<select id="availableDataElements" size="5" multiple="multiple" style="width:30em">
				#foreach( $dataElement in $dataElements )
				<option value="$dataElement.id" title="$dataElement.name">$dataElement.name</option>
				#end
			</select>
		</td>
    </tr>    
    <tr>
        <td>
            <input id="selectOneButton" type="button" value="$i18n.getString('add_selected')" title="$i18n.getString('add_selected')" onclick="addCDEDataElements()" style="width:120px"><input 
                   id="deselectAllButton" type="button" value="$i18n.getString('remove_all')" title="$i18n.getString('remove_all')" onclick="removeCDEDataElements()" style="width:120px">
        </td>
    </tr>
    <tr>
        <th style="width:450px">$i18n.getString( "selected_dataelements" )</td>
    </tr>
    <tr>
		<td>
			<table id="selectedDataElements">
				<tr>
                    <td style="width:290px; font-weight:bold;">$i18n.getString( "data_element" )</td>
                    <td style="width:80px; font-weight:bold;">$i18n.getString( "factor" )</td>
                    <td style="width:80px; font-weight:bold;">$i18n.getString( "remove" )</td>                  
                </tr>
				#foreach ( $operand in $operands )
				<tr>
					<td>$operand.operandName<input type="hidden" name="dataElementIds" value="$operand.id"></td>
					<td><input type="text" name="factors" value="$factorMap.get($operand.id)"></td>
					<td><button type="button" title="$i18n.getString('remove_all')"><img src="../images/delete.png" alt="$i18n.getString('delete_icon')"></button></td>
				</tr>
				#end
			</table>
		</td>
	</tr>
</table>
#end

<table>
    <tr>
        <td style="height:10px" colspan="2"></td>
    </tr>
    <tr>
        <td style="width:200px">$i18n.getString( "data_element_group_sets" )</td>
        <td><input type="checkbox" onclick="toggleById( 'dataElementGroupSetContainer' )"></td>
    </tr>
</table>

<div id="dataElementGroupSetContainer" style="border:1px solid #808080; padding:10px; width:465px; display:none;">

<table>
    <tr>
        <th style="width:450px">$i18n.getString( "available_data_element_group_sets" )</th>
    </tr>
    <tr>
        <td>
            <select multiple size="4" id="availableDataElementGroupSets" style="width:450px" ondblclick="moveSelectedById( 'availableDataElementGroupSets', 'dataElementGroupSets' )">
            #foreach( $groupSet in $dataElementGroupSets )
                <option value="$groupSet.id">$encoder.htmlEncode( $groupSet.name )</option>
            #end
            </select>
        </td>
    </tr>
    <tr>
        <td>
            <input type="button" value="$i18n.getString( 'add_selected' )" title="$i18n.getString( 'add' )" style="width:120px" onclick="moveSelectedById( 'availableDataElementGroupSets', 'dataElementGroupSets' )"><input 
                   type="button" value="$i18n.getString( 'remove_selected' )" title="$i18n.getString( 'remove' )" style="width:120px" onclick="moveSelectedById( 'dataElementGroupSets', 'availableDataElementGroupSets' )">
        </td>
    </tr>
    <tr>
        <th style="width:450px">$i18n.getString( "selected_data_element_group_sets" )</th>
    </tr>
    </tr>
        <td>
            <select multiple size="4" id="dataElementGroupSets" name="dataElementGroupSets" style="width:450px" ondblclick="moveSelectedById( 'dataElementGroupSets', 'availableDataElementGroupSets' )">
            #foreach( $groupSet in $dataElement.groupSets )
            	<option value="$groupSet.id">$encoder.htmlEncode( $groupSet.name )</option>
            #end
            </select>
        </td>
    </tr>
</table>

</div>

<table>
    <tr>
        <td style="height:10px" colspan="2"></td>
    </tr>
    <tr>
        <td style="width:200px">$i18n.getString( "aggregation_levels" )</td>
        <td><input type="checkbox" #if ( $dataElement.hasAggregationLevels() )checked="checked"#end onclick="toggleById( 'aggregationLevelsContainer' )"></td>
    </tr>
</table>

<div id="aggregationLevelsContainer" style="border:1px solid #808080;padding:10px;width:465px;#if( !$dataElement.hasAggregationLevels() ) display:none;#else display:block;#end">

<table>
    <tr>
        <th style="width:450px">$i18n.getString( "available_aggregation_levels" )</th>
    </tr>
    <tr>
        <td>
            <select multiple size="4" id="organisationUnitLevels" style="width:450px" ondblclick="moveSelectedById( 'organisationUnitLevels', 'aggregationLevels' )">
            #foreach( $level in $organisationUnitLevels )
                <option value="$level.level">$level.name</option>
            #end
            </select>
        </td>
    </tr>
    <tr>
        <td>
            <input type="button" value="$i18n.getString( 'add_selected' )" title="$i18n.getString( 'add' )" style="width:120px" onclick="moveSelectedById( 'organisationUnitLevels', 'aggregationLevels' )"><input 
                   type="button" value="$i18n.getString( 'remove_selected' )" title="$i18n.getString( 'remove' )" style="width:120px" onclick="moveSelectedById( 'aggregationLevels', 'organisationUnitLevels' )">
        </td>
    </tr>
    <tr>
        <th style="width:450px">$i18n.getString( "selected_aggregation_levels" )</th>
    </tr>
    </tr>
        <td>
            <select multiple size="4" id="aggregationLevels" name="aggregationLevels" style="width:450px" ondblclick="moveSelectedById( 'aggregationLevels', 'organisationUnitLevels' )">
            #foreach( $level in $aggregationLevels )
            	<option value="$level.level">$level.name</option>
            #end
            </select>
        </td>
    </tr>
</table>

</div>

<p><input type="button" value="$i18n.getString( "save" )" style="width:10em" onclick="submitUpdateDataElement()"><input type="button" value="$i18n.getString( "cancel" )" onclick="window.location.href='dataElement.action'" style="width:10em"></p>

</form>

<span id="message"></span>

<script type="text/javascript">

	var previousName = '$encoder.jsEscape( $dataElement.name, "'" )';
	
	var nameField = document.getElementById( 'name' );
	nameField.select();
	nameField.focus();

</script>
