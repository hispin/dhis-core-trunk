<script src="../dhis-web-commons/ouwt/ouwt.js"></script>
<script src="scripts/tracker-capture.js"></script>

<div id="leftBar">   
    <div class="left-bar-menu" ng-controller="LeftBarMenuController">
        <ul class="nav nav-pills nav-stacked">
            <li><a href ng-click="showHome()">{{'registration_and_data_entry'| translate}}</a></li>
            <li><a href ng-click="showReportTypes()">{{'reports'| translate}}</a></li>            
        </ul>
    </div>  
    <div id="orgUnitTree" style="margin-top:20px">
        <ul>
        </ul>
    </div>
    <img id="ouwt_loader" src="../images/ajax-loader-bar.gif"/>
    <!--- selected org unit begins -->
    <input type="text" selected-org-unit ng-model="selectedOrgUnit.name" ng-hide=true>
    <!--- selected org unit ends  -->
</div>

<div id="mainPage" class="page">
    <!--<h2>{{'upcoming_events'| translate}}</h2>-->
    <!-- top bar begins -->
    <div class="row top-bar">        
        <div class="col-sm-12">            
            {{'upcoming_events'| translate}}
            <div class="pull-right">
                <div class="btn-group" dropdown is-open="status.isopen">
                    <button type="button" class="btn btn-default dropdown-toggle" ng-disabled="!teiList.length">
                        <i class="fa fa-cog" title="{{'settings'| translate}}"></i>
                    </button>
                    <ul class="dropdown-menu pull-right" role="menu">
                        <li ng-show="teiList.length > 0"><a href ng-click="showHideColumns()">{{'show_hide_columns'| translate}}</a></li>
                    </ul>
                </div>
            </div>            
        </div>        
    </div>
    <!-- top bar ends -->
    
    <form name="outerForm" novalidate>               
        <div ng-include="'components/report/reportForm.html'"></div>
    </form>    
    <img src="../images/ajax-loader-bar.gif" ng-if="!dataReady && reportFinished"/>
    <div ng-if="dataReady">
        <div ng-switch="teiList.length">                    
            <div ng-switch-when="undefined">
                <div class="alert alert-warning vertical-spacing">
                    {{'no_data_found'| translate}}
                </div>
            </div>
            <div ng-switch-when="0">  
                <div class="alert alert-warning vertical-spacing">
                    {{'no_data_found'| translate}}
                </div>
            </div>    
            <div ng-switch-default> 

                <!-- report begins -->
                <div class="vertical-spacing">   
                    <table class="listTable dhis2-table-striped-border dhis2-table-hover">               
                        <thead>                        
                            <tr>
                                <th ng-show="gridColumn.show" ng-repeat="gridColumn in gridColumns" ng-click="sortTEIGrid(gridColumn)">
                                    {{gridColumn.name}}
                                    <i ng-if="sortHeader == gridColumn.id && reverse" class="fa fa-sort-desc"></i>
                                    <i ng-if="sortHeader == gridColumn.id && !reverse" class="fa fa-sort-asc"></i>
                                </th>
                                <th>
                                    {{'upcoming_event' | translate}}
                                </th>                                
                            </tr>                        
                        </thead>
                        <tbody id="list">
                            <tr ng-repeat="tei in teiList | orderBy:sortHeader:reverse" 
                                ng-click="showDashboard(trackedEntity)"
                                title="{{'go_to_dashboard'| translate}}">
                                <td ng-show="gridColumn.show"                                            
                                    ng-repeat="gridColumn in gridColumns">                                                
                                    {{tei[gridColumn.id]}}                                                
                                </td>
                                <td>
                                    <span ng-repeat="ev in dhis2Events[tei.id] | orderBy: 'dueDate' | limitTo:1">                                    
                                        {{ev.name}} / {{ev.dueDate}}
                                    </span>                                    
                                </td>                                
                            </tr>
                        </tbody>        
                    </table>                    
                </div>
                <!-- report ends -->
            </div>
        </div> 
    </div>
</div>