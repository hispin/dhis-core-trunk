
#*
Displays a table which lists a set of objects and it's common operations: Filter, 
add, update, translate, remove and show details. The macro produces code against 
some specific conventions for the scripts and actions to call. Call it this way:

#objectList( [name of object, e.g. DataElement], [list of such objects, e.g. $dataElements] )

@param objectName The litteral name of the type of object to display, e.g. DataElement
@param objects A Velocity list of the objects to be formatted, typically prepared by an action.
*#
#macro( objectList $objectName $objects )
    <table class="objectListTable">
        <col>
        <col width="80">
        <tr>
            <td class="filter"><label for="filter">$i18n.getString( "filter_by_name" )</label>: <form action="none" onsubmit="filterValues(this.firstChild.firstChild.value);return false"><div><input id="filter" type="text"><input type="submit" value="Filter"></div></form></td>
            <td style="text-align:right"><input type="button" value="$i18n.getString( "add_new" )" onclick="window.location.href='showAdd${objectName}Form.action'"></td>
        </tr>
        <tr>
            <th>$i18n.getString( "name" )</th>
            <th>$i18n.getString( "operations" )</th>
        </tr>
        <tbody id="list">
        #set( $mark = false )
        #set( $info = false )
        #foreach( $object in $objects )
        <tr #if( $mark ) class="odd" #end>
            <td>$encoder.htmlEncode( $object.name )</td>
            <td>
              <a href="showUpdate${objectName}Form.action?id=${object.id}" title="$i18n.getString( "edit" )"><img src="../images/edit.png" alt="$i18n.getString( "edit" )"></a>
              <a href="$i18n.getString( "translation_translate" )" title="$i18n.getString( "translation_translate" )" onclick="this.href='javascript:location.href= \'../dhis-web-commons/i18n.action?className=${objectName}&amp;$objectId=${object.id}&amp;returnUrl=\' + location.href'"><img src="../images/i18n.png" alt="$i18n.getString( "translation_translate" )"></a>
              <a href="javascript:remove${objectName}( $object.id, '$encoder.jsEncode( $object.name )' )" title="$i18n.getString( "remove" )"><img src="../images/delete.png" alt="$i18n.getString( "remove" )"></a>
              <a href="javascript:show${objectName}Details( $object.id )" title="$i18n.getString( "show_details" )"><img src="../images/information.png" alt="$i18n.getString( "show_details" )"></a>
            </td>
        </tr>
            #if( $mark )
                #set( $mark = false )
            #else
                #set( $mark = true )
            #end
        #end
        </tbody>
    </table>
#end

#*
Supportive method for displaying rows with alternating colors in a table.

@param mark boolean alternating the color.
*#
#macro( alternate $mark )
#if ( $mark ) class="listAlternateRow"#else class="listRow"#end
#end

#*
Formats a boolean into a readable value

@param bool the boolean to format.
*#
#macro( formatBool $bool )
#if ( $bool )
  $i18n.getString( "yes" )
#else
  $i18n.getString( "no" )
#end
#end

#macro( formatAggregationOperator $operator )
#if ( $operator == "average" )
  $i18n.getString( "average" )
#elseif ( $operator == "count" )
  $i18n.getString( "count" )
#elseif ( $operator == "sum" )
  $i18n.getString( "sum" )
#else
  $i18n.getString( "unknown" )
#end
#end

#macro( formatType $type )
#if ( $type == "string" )
  $i18n.getString( "text" )
#elseif ( $type == "bool" )
  $i18n.getString( "yes_no" )
#elseif ( $type == "int" )
  $i18n.getString( "number" )
#else	   
  $i18n.getString( "unknown" )
#end
#end

#macro( openHelp $id )
<a href="javascript:getHelpContent('${id}')" title="$i18n.getString( 'help' )"><img src="../images/help.png" alt="$i18n.getString( 'help' )"></a>
#end

#macro( introListItem $action $objectKey )
<li class="introItem" onclick="window.location.href='${action}'">
  <span class="introItemHeader">$i18n.getString( "${objectKey}" )</span><br>$i18n.getString( "intro_${objectKey}" )
</li>
#end

#macro( introListImgItem $action $objectKey $image )
<li class="introItem" onclick="window.location.href='${action}'">
  <span class="introItemHeader"><img src="../icons/${image}.png" style="float:left; margin-right:15px">$i18n.getString( "${objectKey}" )</span><br>$i18n.getString( "intro_${objectKey}" )
</li>
#end

#macro( organisationUnitSelectionTree $cleanAll $multipleSelectionAllowed $required )
#if( $multipleSelectionAllowed )
	#parse( "/dhis-web-commons/oust/selectionTreeMultipleSelect.vm" )
#else
	#parse( "/dhis-web-commons/oust/selectionTreeSingleSelect.vm" )
#end	
#end

#macro( filterDiv $action )
$i18n.getString( "filter_by_name" ):
<form action="${action}.action" method="POST">
	<div style="inline">
		#set ($value = $encoder.htmlEncode( ${key} ))
		<input type="text" id="key" name="key" value="$!value"/>
		<input type="submit" value="$i18n.getString( 'filter' )"/>
		<input type="button" value="$i18n.getString( 'clear' )" 
		onclick="window.location.href='${action}.action'"/>
	</div>
</form>
#end




#*************************************************************************************************************#
#* Helpers for building attribute forms. Note that these will have dynamic validation rules applied to them. *#

#macro( trHeader $text )
<tr>
	<th colspan="2">$text</th>
</tr>
#end

#****************************************************
	Required args:
		id			
		text		
		mandatory	
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trTextInput $args )
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<tr>
	<td style="width: 200px;">$!args.text</td>
	<td>
		<input type="text" id="$!args.id" name="$!name" value="$!args.value" class="{validate:{required:$args.mandatory,rangelength:[2,230],alphanumeric:true}}" style="width: 240px;" />
	</td>
</tr>
#end

#****************************************************
	Required args:
		id			
		text		
		mandatory	
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trBooleanSelectInput $args )
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<tr>
	<td  style="width: 200px;">$!args.text</td>
	<td>
		<select style="width: 244px;" id="$!args.id" name="$!name" class="{validate:{required:$args.mandatory}}">
			<option value="" />
			<option value="true" #if( $!args.value=="true" )selected="selected"#end>Yes</option>
			<option value="false" #if( $!args.value=="true" )selected="selected"#end>No</option>
		</select>
	</td>
</tr>
#end

#****************************************************
	Required args:
		id			
		text		
		mandatory	
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trDateInput $args )
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<script type="text/javascript">
jQuery(function() {
	jQuery("#$!args.id").datepicker();
});
</script>

<tr>
	<td  style="width: 200px;">$!args.text</td>
	<td>
		<input type="text" id="$!args.id" name="$!name" value="$!args.value" class="{validate:{required:$args.mandatory}}" style="width: 240px;" />
	</td>
</tr>
#end

#****************************************************
	Required args:
		id			
		text		
		mandatory	
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trDecimalInput $args )
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<tr>
	<td style="width: 200px;">$!args.text</td>
	<td>
		<input type="text" id="$!args.id" name="$!name" value="$!args.value" class="{validate:{required:$args.mandatory,real_number:true}}" style="width: 240px;" />
	</td>
</tr>
#end

#****************************************************
	Required args:
		id			
		text		
		mandatory	
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trIntegerInput $args ) 
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<tr>
	<td style="width: 200px;">$!args.text</td>
	<td>
		<input type="text" id="$!args.id" name="$!name" value="$!args.value" class="{validate:{required:$args.mandatory,natural_number:true}}" style="width: 240px;" />
	</td>
</tr>
#end

#****************************************************
	Required args:
		id			
		text		
		mandatory	
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trPositiveIntegerInput $args )
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<tr>
	<td style="width: 200px;">$!args.text</td>
	<td>
		<input type="text" id="$!args.id" name="$!name" value="$!args.value" class="{validate:{required:$args.mandatory,positive_natural_number:true}}" style="width: 240px;" />
	</td>
</tr>
#end

#****************************************************
	Required args:
		id			
		text		
		mandatory	
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trNegativeIntegerInput $args )
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<tr>
	<td style="width: 200px;">$!args.text</td>
	<td>
		<input type="text" id="$!args.id" name="$!name" value="$!args.value" class="{validate:{required:$args.mandatory,negative_natural_number:true}}" style="width: 240px;" />
	</td>
</tr>
#end

#****************************************************
	Required args:
		id			
		text
		mandatory	
		choices		Array of choices.		
	Optional args:
		name		Will use id if omitted.
		value		
*****************************************************#
#macro( trMultipleChoiceInput $args )
#if( "$!args.name" == "" )
	#set( $name = $!args.id )
#else
	#set( $name = $!args.name )
#end

<tr>
	<td  style="width: 200px;">$!args.text</td>
	<td>
		<select style="width: 244px;" id="$!args.id" name="$name" class="{validate:{required:$args.mandatory}}">
		<option value="" />
		#foreach( $choice in $args.choices )
			<option value="$choice" #if( $choice == $args.value )selected="selected"#end>$choice</option>
		#end
		</select>
	</td>
</tr>
#end

#macro( tblDynamicAttributes $attributes )
<div id="dynamicAttributesContainer" style="margin-top: 20px;">
<table>
	#trHeader( "Dynamic Attributes" )

	#foreach( $attribute in $attributes )
		#if( $attribute.valueType == "string" )
			#trTextInput( { "text": $attribute.name, "id": "textAttribute$attribute.id", "mandatory": $attribute.mandatory } )
		#elseif(  $attribute.valueType == "bool" )
			#trBooleanSelectInput( { "text": $attribute.name, "id": "booleanAttribute$attribute.id", "mandatory": $attribute.mandatory } )	
		#elseif( $attribute.valueType == "date" )
			#trDateInput( { "text": $attribute.name, "id": "dateAttribute$attribute.id", "mandatory": $attribute.mandatory } )	
		#elseif( $attribute.valueType == "decimal" )
			#trDecimalInput( { "text": $attribute.name, "id": "decimalAttribute$attribute.id", "mandatory": $attribute.mandatory } )
		#elseif( $attribute.valueType == "integer" )
			#trIntegerInput( { "text": $attribute.name, "id": "integerAttribute$attribute.id", "mandatory": $attribute.mandatory } )
		#elseif( $attribute.valueType == "positive_integer" )
			#trPositiveIntegerInput( { "text": $attribute.name, "id": "positiveIntegerAttribute$attribute.id", "mandatory": $attribute.mandatory } )
		#elseif( $attribute.valueType == "negative_integer" )
			#trNegativeIntegerInput( { "text": $attribute.name, "id": "negativeIntegerAttribute$attribute.id", "mandatory": $attribute.mandatory } )
		#elseif( $attribute.valueType == "multiple_choice" )
			#set( $attributeOptions = [] )

			#foreach( $attributeOption in $attribute.attributeOptions )
				#set( $return = $attributeOptions.add( $attributeOption.name ) )
			#end

			#trMultipleChoiceInput( { "text": $attribute.name, "id": "multipleChoiceAttribute$attribute.id", "mandatory": $attribute.mandatory, "choices": $attributeOptions } )
		#end
	#end
</table>
</div>
#end
