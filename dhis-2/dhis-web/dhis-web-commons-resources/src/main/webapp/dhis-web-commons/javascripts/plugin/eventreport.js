Ext.onReady(function(){Ext.Ajax.method="GET";Ext.isIE=function(){return/trident/.test(Ext.userAgent)}();ER={};ER.instances=[];ER.i18n={};ER.isDebug=false;ER.isSessionStorage=("sessionStorage" in window&&window.sessionStorage!==null);ER.getCore=function(m){var i={},k={},j={},g={},h={},l;(function(){i.finals={dimension:{data:{value:"data",name:ER.i18n.data||"Data",dimensionName:"dx",objectName:"dx",warning:{filter:"..."}},category:{name:ER.i18n.categories||"Assigned categories",dimensionName:"co",objectName:"co"},indicator:{value:"indicators",name:ER.i18n.indicators||"Indicators",dimensionName:"dx",objectName:"in"},dataElement:{value:"dataElements",name:ER.i18n.data_elements||"Data elements",dimensionName:"dx",objectName:"de"},operand:{value:"operand",name:"Operand",dimensionName:"dx",objectName:"dc"},dataSet:{value:"dataSets",name:ER.i18n.data_sets||"Data sets",dimensionName:"dx",objectName:"ds"},period:{value:"period",name:ER.i18n.periods||"Periods",dimensionName:"pe",objectName:"pe"},fixedPeriod:{value:"periods"},relativePeriod:{value:"relativePeriods",name:ER.i18n.relative_periods},startEndDate:{value:"dates",name:ER.i18n.start_end_dates},organisationUnit:{value:"organisationUnits",name:ER.i18n.organisation_units||"Organisation units",dimensionName:"ou",objectName:"ou"},dimension:{value:"dimension"},value:{value:"value"}},root:{id:"root"}};l=i.finals.dimension;l.objectNameMap={};l.objectNameMap[l.data.objectName]=l.data;l.objectNameMap[l.indicator.objectName]=l.indicator;l.objectNameMap[l.dataElement.objectName]=l.dataElement;l.objectNameMap[l.operand.objectName]=l.operand;l.objectNameMap[l.dataSet.objectName]=l.dataSet;l.objectNameMap[l.category.objectName]=l.category;l.objectNameMap[l.period.objectName]=l.period;l.objectNameMap[l.organisationUnit.objectName]=l.organisationUnit;l.objectNameMap[l.dimension.objectName]=l.dimension;i.period={periodTypes:[{id:"Daily",name:ER.i18n.daily},{id:"Weekly",name:ER.i18n.weekly},{id:"Monthly",name:ER.i18n.monthly},{id:"BiMonthly",name:ER.i18n.bimonthly},{id:"Quarterly",name:ER.i18n.quarterly},{id:"SixMonthly",name:ER.i18n.sixmonthly},{id:"Yearly",name:ER.i18n.yearly},{id:"FinancialOct",name:ER.i18n.financial_oct},{id:"FinancialJuly",name:ER.i18n.financial_july},{id:"FinancialApril",name:ER.i18n.financial_april}]};i.layout={west_width:452,west_fill:2,west_fill_accordion_indicator:56,west_fill_accordion_dataelement:59,west_fill_accordion_dataset:31,west_fill_accordion_period:307,west_fill_accordion_organisationunit:58,west_maxheight_accordion_indicator:450,west_maxheight_accordion_dataset:350,west_maxheight_accordion_period:405,west_maxheight_accordion_organisationunit:500,west_scrollbarheight_accordion_indicator:300,west_scrollbarheight_accordion_dataset:250,west_scrollbarheight_accordion_period:405,west_scrollbarheight_accordion_organisationunit:350,east_tbar_height:31,east_gridcolumn_height:30,form_label_width:55,window_favorite_ypos:100,window_confirm_width:250,window_share_width:500,grid_favorite_width:420,grid_row_height:27,treepanel_minheight:135,treepanel_maxheight:400,treepanel_fill_default:310,treepanel_toolbar_menu_width_group:140,treepanel_toolbar_menu_width_level:120,multiselect_minheight:100,multiselect_maxheight:250,multiselect_fill_default:345,multiselect_fill_reportingrates:315};i.report={digitGroupSeparator:{comma:",",space:" "},displayDensity:{compact:"3px",normal:"5px",comfortable:"10px"},fontSize:{small:"10px",normal:"11px",large:"13px"}};i.url={analysisFields:["*","program[id,name]","programStage[id,name]","columns[dimension,filter,items[id,"+m.namePropertyUrl+"]]","rows[dimension,filter,items[id,"+m.namePropertyUrl+"]]","filters[dimension,filter,items[id,"+m.namePropertyUrl+"]]","!lastUpdated","!href","!created","!publicAccess","!rewindRelativePeriods","!userOrganisationUnit","!userOrganisationUnitChildren","!userOrganisationUnitGrandChildren","!externalAccess","!access","!relativePeriods","!columnDimensions","!rowDimensions","!filterDimensions","!user","!organisationUnitGroups","!itemOrganisationUnitGroups","!userGroupAccesses","!indicators","!dataElements","!dataElementOperands","!dataElementGroups","!dataSets","!periods","!organisationUnitLevels","!organisationUnits"]}}());(function(){k.layout={};k.layout.Record=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Record: config is not an object: "+n);return}if(!Ext.isString(n.id)){alert("Record: id is not text: "+n);return}return n}()};k.layout.Dimension=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Dimension: config is not an object: "+n);return}if(!Ext.isString(n.dimension)){console.log("Dimension: name is not a string: "+n);return}if(n.dimension!==i.finals.dimension.category.objectName){var o=[]}return n}()};k.layout.Layout=function(o){var o=Ext.clone(o),p={},n,q;n=function(s){var s=Ext.clone(s);if(!(s&&Ext.isArray(s)&&s.length)){return}for(var r=0;r<s.length;r++){s[r]=k.layout.Dimension(s[r])}s=Ext.Array.clean(s);return s.length?s:null};q=function(){var t=i.finals.dimension,s,u={};if(!p){return}s=Ext.Array.clean([].concat(p.columns||[],p.rows||[],p.filters||[]));for(var r=0;r<s.length;r++){u[s[r].dimension]=s[r]}if(p.filters&&p.filters.length){for(var r=0;r<p.filters.length;r++){if(p.filters[r].dimension===t.indicator.objectName){h.message.alert(ER.i18n.indicators_cannot_be_specified_as_filter||"Indicators cannot be specified as filter");return}if(p.filters[r].dimension===t.category.objectName){h.message.alert(ER.i18n.categories_cannot_be_specified_as_filter||"Categories cannot be specified as filter");return}if(p.filters[r].dimension===t.dataSet.objectName){h.message.alert(ER.i18n.data_sets_cannot_be_specified_as_filter||"Data sets cannot be specified as filter");return}}}if(u[t.operand.objectName]&&u[t.indicator.objectName]){h.message.alert("Indicators and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataElement.objectName]){h.message.alert("Detailed data elements and totals cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataSet.objectName]){h.message.alert("Data sets and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.category.objectName]){h.message.alert("Categories and detailed data elements cannot be specified together");return}return true};return function(){var r=[],t=i.finals.dimension;if(!(o&&Ext.isObject(o))){alert("Layout: config is not an object ("+m.el+")");return}o.columns=n(o.columns);o.rows=n(o.rows);o.filters=n(o.filters);if(!(o.columns||o.rows)){alert(ER.i18n.at_least_one_dimension_must_be_specified_as_row_or_column);return}for(var s=0,u=Ext.Array.clean([].concat(o.columns||[],o.rows||[],o.filters||[]));s<u.length;s++){if(k.layout.Dimension(u[s])){r.push(u[s].dimension)}}if(o.id){p.id=o.id}if(o.name){p.name=o.name}p.columns=o.columns;p.rows=o.rows;p.filters=o.filters;p.dataType=Ext.isString(o.dataType)?o.dataType:"aggregated_values";p.program=o.program;p.programStage=o.programStage;if(o.startDate&&o.endDate){p.startDate=o.startDate;p.endDate=o.endDate}p.showColTotals=Ext.isBoolean(o.colTotals)?o.colTotals:(Ext.isBoolean(o.showColTotals)?o.showColTotals:true);p.showRowTotals=Ext.isBoolean(o.rowTotals)?o.rowTotals:(Ext.isBoolean(o.showRowTotals)?o.showRowTotals:true);p.showColSubTotals=Ext.isBoolean(o.colSubTotals)?o.colSubTotals:(Ext.isBoolean(o.showColSubTotals)?o.showColSubTotals:true);p.showRowSubTotals=Ext.isBoolean(o.rowSubTotals)?o.rowSubTotals:(Ext.isBoolean(o.showRowSubTotals)?o.showRowSubTotals:true);p.showDimensionLabels=Ext.isBoolean(o.showDimensionLabels)?o.showDimensionLabels:(Ext.isBoolean(o.showDimensionLabels)?o.showDimensionLabels:true);p.hideEmptyRows=Ext.isBoolean(o.hideEmptyRows)?o.hideEmptyRows:false;p.countType=Ext.isString(o.countType)&&!Ext.isEmpty(o.countType)?o.countType:"events";p.aggregationType=Ext.isString(o.aggregationType)?o.aggregationType:"default";p.showHierarchy=Ext.isBoolean(o.showHierarchy)?o.showHierarchy:false;p.displayDensity=Ext.isString(o.displayDensity)&&!Ext.isEmpty(o.displayDensity)?o.displayDensity:"normal";p.fontSize=Ext.isString(o.fontSize)&&!Ext.isEmpty(o.fontSize)?o.fontSize:"normal";p.digitGroupSeparator=Ext.isString(o.digitGroupSeparator)&&!Ext.isEmpty(o.digitGroupSeparator)?o.digitGroupSeparator:"space";p.legendSet=Ext.isObject(o.legendSet)&&Ext.isString(o.legendSet.id)?o.legendSet:null;p.parentGraphMap=Ext.isObject(o.parentGraphMap)?o.parentGraphMap:null;p.sorting=Ext.isObject(o.sorting)&&Ext.isDefined(o.sorting.id)&&Ext.isString(o.sorting.direction)?o.sorting:null;p.reportingPeriod=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramReportingPeriod)?o.reportParams.paramReportingPeriod:(Ext.isBoolean(o.reportingPeriod)?o.reportingPeriod:false);p.organisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramOrganisationUnit)?o.reportParams.paramOrganisationUnit:(Ext.isBoolean(o.organisationUnit)?o.organisationUnit:false);p.parentOrganisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramParentOrganisationUnit)?o.reportParams.paramParentOrganisationUnit:(Ext.isBoolean(o.parentOrganisationUnit)?o.parentOrganisationUnit:false);p.regression=Ext.isBoolean(o.regression)?o.regression:false;p.cumulative=Ext.isBoolean(o.cumulative)?o.cumulative:false;p.sortOrder=Ext.isNumber(o.sortOrder)?o.sortOrder:0;p.topLimit=Ext.isNumber(o.topLimit)?o.topLimit:0;if(!q()){return}return p}()};k.response={};k.response.Header=function(n){var n=Ext.clone(n);return function(){if(!Ext.isObject(n)){console.log("Header: config is not an object: "+n);return}if(!Ext.isString(n.name)){console.log("Header: name is not a string: "+n);return}if(!Ext.isBoolean(n.meta)){console.log("Header: meta is not boolean: "+n);return}return n}()};k.response.Response=function(n){var n=Ext.clone(n);return function(){if(!(n&&Ext.isObject(n))){console.log("Response: config is not an object");return}if(!(n.headers&&Ext.isArray(n.headers))){console.log("Response: headers is not an array");return}for(var o=0,p;o<n.headers.length;o++){n.headers[o]=k.response.Header(n.headers[o])}n.headers=Ext.Array.clean(n.headers);if(!n.headers.length){console.log("Response: no valid headers");return}if(!(Ext.isArray(n.rows)&&n.rows.length>0)){alert("No values found");return}if(n.headers.length!==n.rows[0].length){console.log("Response: headers.length !== rows[0].length")}return n}()}}());(function(){j.prototype={};j.prototype.array={};j.prototype.array.getLength=function(o,n){if(!Ext.isArray(o)){if(!n){console.log("support.prototype.array.getLength: not an array")}return null}return o.length};j.prototype.array.sort=function(p,o,n){if(!j.prototype.array.getLength(p)){return}n=!!n||Ext.isNumber(n)?n:"name";p.sort(function(r,q){if(Ext.isObject(r)&&Ext.isObject(q)){r=r[n];q=q[n]}if(Ext.isArray(r)&&Ext.isArray(q)){r=r[n];q=q[n]}if(Ext.isString(r)&&Ext.isString(q)){r=r.toLowerCase();q=q.toLowerCase();if(o==="DESC"){return r<q?1:(r>q?-1:0)}else{return r<q?-1:(r>q?1:0)}}else{if(Ext.isNumber(r)&&Ext.isNumber(q)){return o==="DESC"?q-r:r-q}}return -1});return p};j.prototype.array.uniqueByProperty=function(s,q){var r=[],n=[];for(var o=0,p;o<s.length;o++){p=s[o];if(!Ext.Array.contains(r,p[q])){n.push(p);r.push(p[q])}}return n};j.prototype.array.getNameById=function(r,q,o,n){if(!(Ext.isArray(r)&&q)){return}o=o||"id";n=n||"name";for(var p=0;p<r.length;p++){if(r[p][o]===q){return r[p][n]}}return};j.prototype.array.cleanFalsy=function(p){if(!Ext.isArray(p)){return[]}if(!p.length){return p}for(var o=0;o<p.length;o++){p[o]=p[o]||null}var n=Ext.clean(p);p=null;return n};j.prototype.array.pluckIf=function(t,s,p,r,q){var n=[];if(!(Ext.isArray(t)&&t.length)){return n}s=s||"name";p=p||s;for(var o=0;o<t.length;o++){if(Ext.isDefined(q)&&typeof t[o][p]===q){n.push(t[o][s])}else{if(Ext.isDefined(r)&&t[o][p]===r){n.push(t[o][s])}}}return n};j.prototype.array.getObjectMap=function(u,p,n,t){if(!(Ext.isArray(u)&&u.length)){return{}}var s={};p=p||"id";n=n||"name";t=t||"";for(var q=0,r;q<u.length;q++){r=u[q];s[t+r[p]]=r[n]}return s};j.prototype.object={};j.prototype.object.getLength=function(n,q){if(!Ext.isObject(n)){if(!q){console.log("support.prototype.object.getLength: not an object")}return null}var p=0;for(var o in n){if(n.hasOwnProperty(o)){p++}}return p};j.prototype.object.hasObject=function(o,r,q){if(!j.prototype.object.getLength(o)){return null}for(var p in o){var n=o[p];if(o.hasOwnProperty(p)&&n[r]===q){return true}}return null};j.prototype.str={};j.prototype.str.replaceAll=function(p,o,n){return p.replace(new RegExp(o,"g"),n)};j.prototype.str.toggleDirection=function(n){return n==="DESC"?"ASC":"DESC"};j.prototype.number={};j.prototype.number.getNumberOfDecimals=function(n){var o=new String(n);return(o.indexOf(".")>-1)?(o.length-o.indexOf(".")-1):0};j.prototype.number.roundIf=function(p,n){p=parseFloat(p);n=parseFloat(n);if(Ext.isNumber(p)&&Ext.isNumber(n)){var o=j.prototype.number.getNumberOfDecimals(p);return o>n?Ext.Number.toFixed(p,n):p}return p};j.prototype.number.prettyPrint=function(n,o){o=o||"space";if(o==="none"){return n}return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,i.report.digitGroupSeparator[o])};j.color={};j.color.hexToRgb=function(p){var o=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n;p=p.replace(o,function(s,u,t,q){return u+u+t+t+q+q});n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}}());(function(){g.layout={};g.layout.cleanDimensionArray=function(o){if(!j.prototype.array.getLength(o)){return null}var p=[];for(var n=0;n<o.length;n++){p.push(k.layout.Dimension(o[n]))}p=Ext.Array.clean(p);return p.length?p:null};g.layout.sortDimensionArray=function(q,p){if(!j.prototype.array.getLength(q,true)){return null}q=g.layout.cleanDimensionArray(q);if(!q){console.log("service.layout.sortDimensionArray: no valid dimensions");return null}p=p||"dimensionName";Ext.Array.sort(q,function(s,r){if(s[p]<r[p]){return -1}if(s[p]>r[p]){return 1}return 0});for(var o=0,n;o<q.length;o++){j.prototype.array.sort(q[o].items,"ASC","id");if(j.prototype.array.getLength(q[o].ids)){j.prototype.array.sort(q[o].ids)}}return q};g.layout.getObjectNameDimensionMapFromDimensionArray=function(q){var p={};if(!j.prototype.array.getLength(q)){return null}for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o}}return j.prototype.object.getLength(p)?p:null};g.layout.getObjectNameDimensionItemsMapFromDimensionArray=function(q){var p={};if(!j.prototype.array.getLength(q)){return null}for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o.items}}return j.prototype.object.getLength(p)?p:null};g.layout.getItemName=function(u,r,q,n){var p=r.metaData,o="";if(g.layout.isHierarchy(u,r,q)){var v=p.names[q].split("/");if(v.length===1){return v[0]}v.shift();for(var t=0,s;t<v.length;t++){s=!!(t===v.length-1);o+=(n&&!s?'<span class="text-weak">':"")+v[t]+(n&&!s?"</span>":"")+(!s?" / ":"")}return o}o+=p.optionNames[q]||p.names[q];return o};g.layout.getExtendedLayout=function(s){var s=Ext.clone(s),u;u={columns:[],rows:[],filters:[],columnObjectNames:[],columnDimensionNames:[],rowObjectNames:[],rowDimensionNames:[],axisDimensions:[],axisObjectNames:[],axisDimensionNames:[],sortedAxisDimensionNames:[],filterDimensions:[],filterObjectNames:[],filterDimensionNames:[],sortedFilterDimensions:[],dimensions:[],objectNames:[],dimensionNames:[],objectNameDimensionsMap:{},objectNameItemsMap:{},objectNameIdsMap:{},dimensionNameDimensionsMap:{},dimensionNameItemsMap:{},dimensionNameIdsMap:{},dimensionNameSortedIdsMap:{}};Ext.applyIf(u,s);if(s.columns){for(var q=0,r,t,n;q<s.columns.length;q++){r=s.columns[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap.hasOwnProperty(r.dimension)?l.objectNameMap[r.dimension].dimensionName||r.dimension:r.dimension;n.items=[];n.ids=[];if(t){n.items=t;for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.columns.push(n);u.columnObjectNames.push(n.objectName);u.columnDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap.hasOwnProperty(n.objectName)?l.objectNameMap[n.objectName].dimensionName||n.objectName:n.objectName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}if(s.rows){for(var q=0,r,t,n;q<s.rows.length;q++){r=Ext.clone(s.rows[q]);t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap.hasOwnProperty(r.dimension)?l.objectNameMap[r.dimension].dimensionName||r.dimension:r.dimension;n.items=[];n.ids=[];if(t){n.items=t;for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.rows.push(n);u.rowObjectNames.push(n.objectName);u.rowDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap.hasOwnProperty(n.objectName)?l.objectNameMap[n.objectName].dimensionName||n.objectName:n.objectName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}if(s.filters){for(var q=0,r,t,n;q<s.filters.length;q++){r=s.filters[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap.hasOwnProperty(r.dimension)?l.objectNameMap[r.dimension].dimensionName||r.dimension:r.dimension;n.items=[];n.ids=[];if(t){n.items=t;for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.filters.push(n);u.filterDimensions.push(n);u.filterObjectNames.push(n.objectName);u.filterDimensionNames.push(l.objectNameMap.hasOwnProperty(n.objectName)?l.objectNameMap[n.objectName].dimensionName||n.objectName:n.objectName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}u.legendSet=s.legendSet?m.idLegendSetMap[s.legendSet.id]:null;if(s.legendSet&&s.legendSet.mapLegends){u.legendSet=m.idLegendSetMap[s.legendSet.id];j.prototype.array.sort(u.legendSet.mapLegends,"ASC","startValue")}u.axisDimensionNames=Ext.Array.unique(u.axisDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.columnDimensionNames=Ext.Array.unique(u.columnDimensionNames);u.rowDimensionNames=Ext.Array.unique(u.rowDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.sortedAxisDimensionNames=Ext.clone(u.axisDimensionNames).sort();u.sortedFilterDimensions=g.layout.sortDimensionArray(Ext.clone(u.filterDimensions));u.dimensions=[].concat(u.axisDimensions,u.filterDimensions);u.objectNames=[].concat(u.axisObjectNames,u.filterObjectNames);u.dimensionNames=[].concat(u.axisDimensionNames,u.filterDimensionNames);for(var q=0,o;q<u.dimensionNames.length;q++){o=u.dimensionNames[q];u.dimensionNameDimensionsMap[o]=[];u.dimensionNameItemsMap[o]=[];u.dimensionNameIdsMap[o]=[]}for(var q=0,n;q<u.dimensions.length;q++){n=u.dimensions[q];u.dimensionNameDimensionsMap[n.dimensionName].push(n);u.dimensionNameItemsMap[n.dimensionName]=u.dimensionNameItemsMap[n.dimensionName].concat(n.items);u.dimensionNameIdsMap[n.dimensionName]=u.dimensionNameIdsMap[n.dimensionName].concat(n.ids)}for(var v in u.dimensionNameIdsMap){if(u.dimensionNameIdsMap.hasOwnProperty(v)){u.dimensionNameSortedIdsMap[v]=Ext.clone(u.dimensionNameIdsMap[v]).sort()}}u.tableUuid=m.el+"_"+Ext.data.IdGenerator.get("uuid").generate();return u};g.layout.getSyncronizedXLayout=function(F,u,p){var y,s,q=Ext.Array.clean([].concat(u.columns||[],u.rows||[],u.filters||[])),n=Ext.Array.clean([].concat(F.columns||[],F.rows||[],F.filters||[]));y=function(I){var H;H=function(K){var L;K=Ext.clone(K);for(var J=0;J<K.length;J++){if(K[J].dimension===I){L=K[J]}}if(L){Ext.Array.remove(K,L)}return K};if(u.columns){u.columns=H(u.columns)}if(u.rows){u.rows=H(u.rows)}if(u.filters){u.filters=H(u.filters)}};s=function(){var I=[];for(var H=0;H<p.headers.length;H++){I.push(p.headers[H].name)}return I};for(var D=0,A,C;D<q.length;D++){A=q[D];A.items=[];C=p.nameHeaderMap[A.dimension];optionMap={};if(C){for(var B=0,w;B<C.ids.length;B++){w=C.ids[B];A.items.push({id:w,name:p.metaData.optionNames[w]||p.metaData.names[w]||w})}}}for(var D=0,r;D<n.length;D++){r=n[D];if(F.sorting&&Ext.Array.contains(u.rowDimensionNames,r.dimension)){continue}if(Ext.isString(r.filter)){var G=r.filter.split(":");if(G[0]==="IN"&&G.length>1&&Ext.isString(G[1])){var o=G[1].split(";");for(var B=0,A,v;B<q.length;B++){A=q[B];if(A.dimension===r.dimension&&A.items&&A.items.length){v=[];for(var z=0,t;z<o.length;z++){t=o[z];for(var x=0,E;x<A.items.length;x++){E=A.items[x];if(E.id===t||E.id===(A.dimension+t)){v.push(E)}}}A.items=v}}}}}F=k.layout.Layout(u);if(F){return g.layout.getExtendedLayout(F)}};g.layout.getExtendedAxis=function(B,ad){var t,r,D=[],z=1,N,q,H=[],ac=[],s=[],G=[],x=[],y=[],Q=[],u={};if(ad==="col"){t=Ext.clone(B.columnDimensionNames);r="colSpan"}else{if(ad==="row"){t=Ext.clone(B.rowDimensionNames);r="rowSpan"}}if(!(Ext.isArray(t)&&t.length)){return}for(var X=0;X<t.length;X++){D.push({dimensionName:t[X]})}q=function(){var n=[];for(var ae=0;ae<D.length;ae++){n.push(B.dimensionNameIdsMap[D[ae].dimensionName])}return n}();N=q.length;for(var X=0,O;X<N;X++){O=q[X].length;H.push(O);z=z*O;ac.push(z)}for(var X=0;X<N;X++){if(H[X]===1){if(X===0){s.push(z)}else{if(B.hideEmptyRows&&ad==="row"){s.push(z/ac[X])}else{s.push(s[0])}}}else{s.push(z/ac[X])}}G.push(q[0]);if(N.length>1){for(var X=1,aa,R;X<N;X++){aa=[];R=H[X]===1?H[0]:ac[X-1];for(var V=0;V<R;V++){aa=aa.concat(q[X])}G.push(aa)}}for(var X=0,w,S,E,W;X<N;X++){w=[];S=q[X];E=s[X];W=z/(E*S.length);for(var V=0;V<W;V++){for(var U=0;U<S.length;U++){for(var T=0;T<E;T++){w.push(S[U])}}}x.push(w)}for(var X=0,M;X<z;X++){M="";for(var V=0;V<N;V++){M+=x[V][X]}if(M){y.push(M)}}for(var X=0,J;X<x.length;X++){J=[];for(var V=0,p;V<x[X].length;V++){p={id:x[X][V],uuid:Ext.data.IdGenerator.get("uuid").generate(),dim:X,axis:ad};if(X===x.length-1){p.leaf=true}J.push(p)}Q.push(J)}for(var X=0,I,L,Z;X<Q.length;X++){L=[];for(var V=0,p,ab=0,o;V<Q[X].length;V++){p=Q[X][V];L.push(p.id);if(ab===0){p[r]=s[X];if(p.leaf){p.children=0}p.oldest=true;if(X===0){p.root=true}o=p}p.oldestSibling=o;if(++ab===s[X]){ab=0}}if(X>0){I=Q[X-1];Z=Ext.Array.unique(L);for(var V=0;V<I.length;V++){I[V].children=Z.length}}}if(N>1){for(var X=1,A;X<N;X++){A=Q[X];for(var V=0,ab=0,E=s[X-1];V<A.length;V++){A[V].parent=Q[X-1][V]}}}if(Q.length){var v=N>1?j.prototype.array.sort(Ext.clone(s))[1]:z,C=Q[Q.length-1];for(var X=0,Y,F,p,K=[];X<C.length;X++){Y=C[X];K.push(Y.uuid);F=[];p=Y;while(p.parent){p=p.parent;F.push(p.oldestSibling.uuid)}Y.uuids=Ext.clone(F);if(K.length===v){for(var V=(X-v)+1,Y;V<=X;V++){Y=C[V];Y.uuids=Y.uuids.concat(Ext.clone(K))}K=[]}}}for(var X=0;X<Q.length;X++){for(var V=0,P;V<Q[X].length;V++){P=Q[X][V];u[P.uuid]=P}}return{type:ad,items:D,xItems:{unique:q,gui:G,all:x},objects:{all:Q},ids:y,span:s,dims:N,size:z,uuidObjectMap:u}};g.layout.isHierarchy=function(o,n,p){return o.showHierarchy&&Ext.isObject(n.metaData.ouHierarchy)&&n.metaData.ouHierarchy.hasOwnProperty(p)};g.layout.getHierarchyName=function(r,s,t){var q=r[t],p=Ext.Array.clean(q.split("/")),n="";if(p.length<2){return s[t]}for(var o=0;o<p.length;o++){n+=s[p[o]]+" / "}n+=s[t];return n};g.layout.layout2plugin=function(s,p){var s=Ext.clone(s),r=Ext.Array.clean([].concat(s.columns||[],s.rows||[],s.filters||[]));s.url=m.contextPath;if(p){s.el=p}if(Ext.isString(s.id)){return{id:s.id}}for(var o=0,t,q;o<r.length;o++){t=r[o];delete t.id;delete t.ids;delete t.type;delete t.dimensionName;delete t.objectName;for(var n=0,q;n<t.items.length;n++){q=t.items[n];delete q.name;delete q.code;delete q.created;delete q.lastUpdated;delete q.value}}if(s.showTotals){delete s.showTotals}if(s.showSubTotals){delete s.showSubTotals}if(!s.hideEmptyRows){delete s.hideEmptyRows}if(!s.showHierarchy){delete s.showHierarchy}if(s.displayDensity==="normal"){delete s.displayDensity}if(s.fontSize==="normal"){delete s.fontSize}if(s.digitGroupSeparator==="space"){delete s.digitGroupSeparator}if(!s.legendSet){delete s.legendSet}if(!s.sorting){delete s.sorting}delete s.parentGraphMap;delete s.reportingPeriod;delete s.organisationUnit;delete s.parentOrganisationUnit;delete s.regression;delete s.cumulative;delete s.sortOrder;delete s.topLimit;return s};g.layout.getDataDimensionsFromLayout=function(r){var q=Ext.Array.clean([].concat(r.columns||[],r.rows||[],r.filters||[])),p=["pe","ou"],n=[];for(var o=0;o<q.length;o++){if(!Ext.Array.contains(p,q[o].dimension)){n.push(q[o])}}return n};g.response={};g.response.aggregate={};g.response.aggregate.getExtendedResponse=function(y,o){var I="[N/A]",w=["ou","pe"],C,x,p;o=Ext.clone(o);p=o.headers;C=o.metaData.ouHierarchy,x=o.metaData.names;x[I]=I;o.metaData.optionNames={};o.nameHeaderMap={};o.idValueMap={};for(var G=0,F,z;G<p.length;G++){F=p[G];F.ids=[];z=Ext.Array.contains(w,F.name);if(F.meta){if(F.type==="java.lang.Double"){var n=[];for(var E=0,B,r,s,A;E<o.rows.length;E++){B=o.rows[E][G]||I;r=F.name+B;s=parseFloat(B);A=Ext.isNumber(s)?s:(x[B]||B);x[r]=(z?"":F.column+" ")+A;o.rows[E][G]=r;n.push({id:r,sortingId:Ext.isNumber(s)?s:Number.MAX_VALUE})}j.prototype.array.sort(n,"ASC","sortingId");F.ids=Ext.Array.pluck(n,"id")}else{var n=[];for(var E=0,B,r,J,q;E<o.rows.length;E++){B=o.rows[E][G]||I;r=F.name+B;q=g.layout.isHierarchy(y,o,B);J=z?"":F.column+" ";J=q?g.layout.getHierarchyName(C,x,B):(x[B]||B);x[r]=J;o.rows[E][G]=r;if(q){C[r]=C[B]}n.push({id:r,sortingId:F.name==="pe"?r:J})}j.prototype.array.sort(n,"ASC","sortingId");F.ids=Ext.Array.pluck(n,"id")}}F.ids=Ext.Array.unique(F.ids);F.size=F.ids.length;F.index=G;o.nameHeaderMap[F.name]=F}var D=o.nameHeaderMap[i.finals.dimension.value.value].index,v=l.data.dimensionName,u=y.axisDimensionNames,H=[];for(var G=0;G<u.length;G++){H.push(o.nameHeaderMap[u[G]].index)}for(var G=0,t,B;G<o.rows.length;G++){t=o.rows[G];B="";for(var E=0;E<H.length;E++){B+=t[H[E]]}o.idValueMap[B]=t[D]}return o};g.response.query={};g.response.query.getExtendedResponse=function(x,s){var B=Ext.clone(s),p=B.metaData,o=Ext.Array.unique(Ext.Array.pluck(x.columns,"dimension")),r=[],q=B.headers,y={},z={},w;z.pe="eventdate";z.ou="ouname";for(var u=0,v;u<q.length;u++){if(q[u].name==="ou"){w=u;break}}for(var u=0,v;u<q.length;u++){v=q[u];v.index=u;y[v.name]=v;if(v.type==="java.lang.Double"){for(var t=0,A;t<B.rows.length;t++){A=B.rows[t][u];B.rows[t][u]=A?parseFloat(A):A}}if(v.name==="eventdate"){for(var t=0;t<B.rows.length;t++){B.rows[t][u]=B.rows[t][u].substr(0,10)}}}for(var u=0,n;u<o.length;u++){n=z[o[u]]||o[u];r.push(y[n])}B.dimensionHeaders=r;B.nameHeaderMap=y;return B}}());(function(){h.mask={};h.mask.show=function(n,o){if(!Ext.isObject(n)){console.log("support.gui.mask.show: component not an object");return null}o=o||"Loading..";if(n.mask&&n.mask.destroy){n.mask.destroy();n.mask=null}n.mask=new Ext.create("Ext.LoadMask",n,{shadow:false,msg:o,style:"box-shadow:0",bodyStyle:"box-shadow:0"});n.mask.show()};h.mask.hide=function(n){if(!Ext.isObject(n)){console.log("support.gui.mask.hide: component not an object");return null}if(n.mask){n.mask.destroy();n.mask=null}};h.message={};h.message.alert=function(n){console.log(n)};h.analytics={};h.analytics.getParamString=function(v,w,x){var q,n=Ext.Array.clean([].concat(v.columns||[],v.rows||[])),u=["longitude","latitude"],p={aggregated_values:"aggregate",individual_cases:"query"},o;w=w||"json";q="/api/analytics/events/"+p[v.dataType]+"/"+v.program.id+"."+w+"?";q+="stage="+v.programStage.id;if(n){for(var s=0,t;s<n.length;s++){t=n[s];if(Ext.Array.contains(u,t.dimension)||(t.dimension==="pe"&&!t.items&&!t.filter)){continue}q+="&dimension="+t.dimension;if(t.items&&t.items.length){q+=":";for(var r=0,y;r<t.items.length;r++){y=t.items[r];q+=encodeURIComponent(y.id)+((r<(t.items.length-1))?";":"")}}else{q+=t.filter?":"+encodeURIComponent(t.filter):""}}}if(v.filters){for(var s=0,t;s<v.filters.length;s++){t=v.filters[s];q+="&filter="+t.dimension;if(Ext.isArray(t.items)&&t.items.length){q+=":";for(var r=0;r<t.items.length;r++){q+=encodeURIComponent(t.items[r].id);q+=r<t.items.length-1?";":""}}else{q+=t.filter?":"+encodeURIComponent(t.filter):""}}}if(v.startDate&&v.endDate){q+="&startDate="+v.startDate+"&endDate="+v.endDate}q+=v.showHierarchy?"&hierarchyMeta=true":"";if(v.dataType==="aggregated_values"&&(v.sortOrder&&v.topLimit)){q+="&limit="+v.topLimit+"&sortOrder="+(v.sortOrder<0?"ASC":"DESC")}if(v.dataType==="aggregated_values"&&v.countType){if(v.countType==="tracked_entity_instances"){q+="&uniqueInstances=true"}}if(v.dataType==="individual_cases"&&v.sorting){if(v.sorting.id&&v.sorting.direction){q+="&"+v.sorting.direction.toLowerCase()+"="+v.sorting.id}}if(v.dataType==="individual_cases"&&v.paging&&!x){q+=v.paging.pageSize?"&pageSize="+v.paging.pageSize:"";q+=v.paging.page?"&page="+v.paging.page:""}q+="&displayProperty="+m.userAccount.settings.keyAnalysisDisplayProperty.toUpperCase();return q};h.analytics.validateUrl=function(o){var p;if(Ext.isIE){p="Too many items selected (url has "+o.length+" characters). Internet Explorer accepts maximum 2048 characters."}else{var n=o.length>8000?"8000":(o.length>4000?"4000":"2000");p="Too many items selected (url has "+o.length+" characters). Please reduce to less than "+n+" characters."}p+="\n\nHint: A good way to reduce the number of items is to use relative periods and level/group organisation unit selection modes.";alert(p)};h.report={};h.report.aggregate={};h.report.aggregate.sort=function(u,z,o){var t=u.sorting.id,p=u.rows[0].dimension,n=z.nameHeaderMap[p].ids,q=z.idValueMap,v=u.sorting?u.sorting.direction:"DESC",y=[],s;if(Ext.isString(t)){t=t.toLowerCase()==="total"?"total_":t}else{if(Ext.isNumber(t)){if(t===0){t="total_"}else{t=o.ids[parseInt(t)-1]}}else{return z}}for(var r=0,x,w;r<n.length;r++){x=t+n[r];w=parseFloat(q[x]);y.push({id:n[r],value:Ext.isNumber(w)?w:(Number.MAX_VALUE*-1)})}j.prototype.array.sort(y,v,"value");z.nameHeaderMap[p].ids=Ext.Array.pluck(y,"id");return z};h.report.aggregate.getHtml=function(F,o,L,E){var y,G,n,r,s,w,I,u,q,x,C,H,N,v=function(O){if(!O){return null}var P=O.xItems.unique;if(P){return P.length<2?1:(O.size/P[0].length)}return null},K=v(L),D=v(E),B=[],M=[],t=[],A={},z=Ext.isObject(F.legendSet)&&Ext.isArray(F.legendSet.mapLegends)&&F.legendSet.mapLegends.length,p=0,J;o.sortableIdObjects=[];y=function(O,P){P=P||2;return parseFloat(j.prototype.number.roundIf(O,2)).toString()};G=function(R,aa){var X,Y,U,V,P,Q,ac,O=Ext.isObject(R)&&Ext.isString(R.type)&&R.type.substr(0,5)==="value"&&!R.empty,W=Ext.isObject(R)&&Ext.isString(R.type)&&R.type==="value"&&!R.empty,ab="",T="";if(!Ext.isObject(R)){return""}if(R.hidden||R.collapsed){return""}p=p+1;if(O&&F.legendSet){var Z=parseFloat(R.value);Y=F.legendSet.mapLegends;for(var S=0;S<Y.length;S++){if(Ext.Number.constrain(Z,Y[S].startValue,Y[S].endValue)===Z){X=Y[S].color}}}U=R.colSpan?'colspan="'+R.colSpan+'" ':"";V=R.rowSpan?'rowspan="'+R.rowSpan+'" ':"";P=R.collapsed?"":R.htmlValue||R.value||"";P=R.type!=="dimension"?j.prototype.number.prettyPrint(P,F.digitGroupSeparator):P;Q=i.report.displayDensity[R.displayDensity]||i.report.displayDensity[F.displayDensity];ac=i.report.fontSize[R.fontSize]||i.report.fontSize[F.fontSize];ab+=R.hidden?" td-hidden":"";ab+=R.collapsed?" td-collapsed":"";ab+=X?" legend":(R.cls?" "+R.cls:"");if(Ext.isString(aa)){ab+=" td-sortable";o.sortableIdObjects.push({id:aa,uuid:R.uuid})}T+="<td "+(R.uuid?('id="'+R.uuid+'" '):"");T+=' class="'+ab+'" '+U+V;T+='style="'+(X&&W?"color:"+X+"; ":"")+"padding:"+Q+"; font-size:"+ac+';">'+P+"</td>";return T};r=function(){return !!F.showRowTotals};s=function(){return !!F.showColTotals};doColSubTotals=function(){return !!F.showColSubTotals&&E&&E.dims>1};doRowSubTotals=function(){return !!F.showRowSubTotals&&L&&L.dims>1};w=function(){return(E&&E.dims===1)};I=function(){var W=[],O;getEmptyNameTdConfig=function(X){X=X||{};return G({cls:X.cls?" "+X.cls:"pivot-empty",colSpan:X.colSpan?X.colSpan:1,rowSpan:X.rowSpan?X.rowSpan:1,htmlValue:X.htmlValue?X.htmlValue:"&nbsp;"})};O=function(Z){var X=[];if(Z<L.dims-1){if(E&&E.dims){for(var Y=0;Y<E.dims-1;Y++){X.push(getEmptyNameTdConfig({cls:"pivot-dim-label"}))}}X.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:l.objectNameMap[F.columnObjectNames[Z]].name}))}else{if(E&&E.dims){for(var Y=0;Y<E.dims-1;Y++){X.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:l.objectNameMap[F.rowObjectNames[Y]].name}))}}X.push(getEmptyNameTdConfig({cls:"pivot-dim-label",htmlValue:l.objectNameMap[F.rowObjectNames[Y]].name+" / "+l.objectNameMap[F.columnObjectNames[Z]].name}))}return X};if(!(L&&Ext.isObject(L))){return W}for(var T=0,V;T<L.dims;T++){V=[];if(F.showDimensionLabels){V=V.concat(O(T))}else{if(T===0){V.push(L&&E?getEmptyNameTdConfig({colSpan:E.dims,rowSpan:L.dims}):"")}}for(var R=0,S,P=0,U,Q;R<L.size;R++){P++;U=null;Q=null;S=L.objects.all[T][R];S.type="dimension";S.cls="pivot-dim";S.noBreak=false;S.hidden=!(S.rowSpan||S.colSpan);S.htmlValue=g.layout.getItemName(F,o,S.id,true);if(T===L.dims-1&&w()){U=L.ids[R]}V.push(G(S,U));if(T===0&&P===L.span[T]&&doRowSubTotals()){V.push(G({type:"dimensionSubtotal",cls:"pivot-dim-subtotal cursor-default",rowSpan:L.dims,htmlValue:"&nbsp;"}));P=0}if(T===0&&(R===L.size-1)&&r()){Q=w()?"total_":null;V.push(G({uuid:Ext.data.IdGenerator.get("uuid").generate(),type:"dimensionTotal",cls:"pivot-dim-total",rowSpan:L.dims,htmlValue:"Total"},Q))}}W.push(V)}return W};u=function(){var aF=[],ab=[],aq,V=[],ak=[],af,ai=L?L.size:1,at=E?E.size:1,aj;aj=function(aG){if(!aG.children){aG.collapsed=true;if(aG.parent){aG.parent.oldestSibling.children--}}if(aG.parent){aj(aG.parent.oldestSibling)}};if(E){var ah=new Array(E.dims);for(var aB=0,ad;aB<E.size;aB++){ad=[];for(var aA=0,T,av;aA<E.dims;aA++){T=E.objects.all[aA][aB];T.type="dimension";T.cls="pivot-dim "+(g.layout.isHierarchy(F,o,T.id)?" align-left":"");T.noBreak=true;T.hidden=!(T.rowSpan||T.colSpan);T.htmlValue=g.layout.getItemName(F,o,T.id,true);ad.push(T);if(T.htmlValue.length>50){ah[aA]=true}}ab.push(ad)}for(var aB=0,O;aB<ah.length;aB++){O=ah[aB];if(!O){for(var aA=0,T;aA<E.size;aA++){T=ab[aA][aB];T.cls+=" td-nobreak";T.noBreak=true}}}}for(var aB=0,R,U,ay=o.idValueMap;aB<at;aB++){R=[];U=[];for(var aA=0,ap,aw,aD,P,W,Q;aA<ai;aA++){P=false;Q=[];ap=(L?L.ids[aA]:"")+(E?E.ids[aB]:"");W=Ext.data.IdGenerator.get("uuid").generate();if(L){Q=Q.concat(L.objects.all[L.dims-1][aA].uuids)}if(E){Q=Q.concat(E.objects.all[E.dims-1][aB].uuids)}if(ay[ap]){aw=parseFloat(ay[ap]);aD=aw.toString()}else{aw=0;aD="&nbsp;";P=true}R.push(aw);U.push({uuid:W,type:"value",cls:"pivot-value"+(P?" cursor-default":""),value:aw,htmlValue:aD,empty:P,uuids:Q});A[W]=Q}B.push(R);M.push(U)}if(L&&r()){for(var aB=0,P=[],an=0;aB<M.length;aB++){for(aA=0,T;aA<M[aB].length;aA++){T=M[aB][aA];P.push(T.empty);an+=T.value}V.push({type:"valueTotal",cls:"pivot-value-total",value:an,htmlValue:Ext.Array.contains(P,false)?y(an):"",empty:!Ext.Array.contains(P,false)});if(w()){var aa="total_"+E.ids[aB],ae=!Ext.Array.contains(P,false);o.idValueMap[aa]=ae?null:an}P=[];an=0}}if(L&&E){if(F.hideEmptyRows){for(var aB=0,ar,S,ag;aB<M.length;aB++){ar=M[aB];S=!Ext.Array.contains(Ext.Array.pluck(ar,"empty"),false);if(S){for(var aA=0;aA<ar.length;aA++){ar[aA].collapsed=true}if(r()){V[aB].collapsed=true}ag=ab[aB][E.dims-1];aj(ag)}}}}aq=M;if(doRowSubTotals()){var al=[];for(var aB=0,ad,Z,ac;aB<aq.length;aB++){ad=[];Z=0;ac=0;for(var aA=0,am,aE=[],P=[];aA<aq[aB].length;aA++){am=aq[aB][aA];Z+=am.value;P.push(!!am.empty);aE.push(!!am.collapsed);ac++;ad.push(am);if(ac===K){var ae=!Ext.Array.contains(P,false);ad.push({type:"valueSubtotal",cls:"pivot-value-subtotal"+(ae?" cursor-default":""),value:Z,htmlValue:ae?"&nbsp;":y(Z),empty:ae,collapsed:!Ext.Array.contains(aE,false)});ac=0;Z=0;P=[];aE=[]}}al.push(ad)}aq=al}if(doColSubTotals()){var ao=[],al=[],aC=[],az;az=function(aJ){var aI=[];for(var aG=0,aH;aG<E.dims;aG++){aH={};aH.type="dimensionSubtotal";aH.cls="pivot-dim-subtotal cursor-default";aH.collapsed=Ext.Array.contains(aJ,true);if(aG===0){aH.htmlValue="&nbsp;";aH.colSpan=E.dims}else{aH.hidden=true}aI.push(aH)}return aI};for(var aB=0,ad,aE=[];aB<ab.length;aB++){ao.push(ab[aB]);aE.push(!!ab[aB][0].collapsed);if(!Ext.isArray(ab[aB+1])||!!ab[aB+1][0].root){ao.push(az(aE));aE=[]}}for(var aB=0;aB<ao.length;aB++){al.push([])}for(var aB=0;aB<aq[0].length;aB++){for(var aA=0,X=0,au=0,Y=0,P=[],aE,am;aA<aq.length;aA++){am=aq[aA][aB];al[au++].push(am);Y+=am.value;P.push(!!am.empty);X++;if(ab[aA][0].root){aE=!!ab[aA][0].collapsed}if(!Ext.isArray(ab[aA+1])||ab[aA+1][0].root){var ae=!Ext.Array.contains(P,false);al[au++].push({type:am.type==="value"?"valueSubtotal":"valueSubtotalTotal",value:Y,htmlValue:ae?"&nbsp;":y(Y),collapsed:aE,cls:(am.type==="value"?"pivot-value-subtotal":"pivot-value-subtotal-total")+(ae?" cursor-default":"")});X=0;Y=0;P=[]}}}for(var aB=0,T,aE=[],P=[],Y=0,ax=0;aB<V.length;aB++){T=V[aB];aC.push(T);aE.push(!!T.collapsed);P.push(!!T.empty);Y+=T.value;ax++;if(ax===E.span[0]){var ae=!Ext.Array.contains(P,false);aC.push({type:"valueTotalSubgrandtotal",cls:"pivot-value-total-subgrandtotal"+(ae?" cursor-default":""),value:Y,htmlValue:ae?"&nbsp;":y(Y),empty:ae,collapsed:!Ext.Array.contains(aE,false)});aE=[];P=[];Y=0;ax=0}}ab=ao;aq=al;V=aC}for(var aB=0,ad;aB<aq.length;aB++){ad=[];if(E){ad=ad.concat(ab[aB])}ad=ad.concat(aq[aB]);if(L){ad=ad.concat(V[aB])}ak.push(ad)}for(var aB=0,ad;aB<ak.length;aB++){ad=[];for(var aA=0;aA<ak[aB].length;aA++){ad.push(G(ak[aB][aA]))}aF.push(ad)}return aF};x=function(){var V=[];if(E&&s()){var Y;for(var Q=0,U=0,T=[];Q<M[0].length;Q++){for(var O=0,P;O<M.length;O++){P=M[O][Q];U+=P.value;T.push(!!P.empty)}t.push({type:"valueTotal",value:U,htmlValue:Ext.Array.contains(T,false)?y(U):"",empty:!Ext.Array.contains(T,false),cls:"pivot-value-total"});U=0;T=[]}Y=t;if(L&&doRowSubTotals()){var R=[];for(var Q=0,X,S=0,T=[],W=0;Q<Y.length;Q++){X=Y[Q];R.push(X);S+=X.value;T.push(!!X.empty);W++;if(W===K){R.push({type:"valueTotalSubgrandtotal",value:S,htmlValue:Ext.Array.contains(T,false)?y(S):"",empty:!Ext.Array.contains(T,false),cls:"pivot-value-total-subgrandtotal"});S=0;W=0}}Y=R}for(var Q=0;Q<Y.length;Q++){V.push(G(Y[Q]))}}return V};C=function(){var Q=0,R=[],O=[];if(r()&&s()){for(var P=0,S;P<t.length;P++){S=t[P];Q+=S.value;R.push(S.empty)}if(L&&E){O.push(G({type:"valueGrandTotal",cls:"pivot-value-grandtotal",value:Q,htmlValue:Ext.Array.contains(R,false)?y(Q):"",empty:!Ext.Array.contains(R,false)}))}}return O};H=function(){var Q,P=x(),R=C(),S,O=[];if(s()){if(E){Q=[G({type:"dimensionSubtotal",cls:"pivot-dim-total",colSpan:E.dims,htmlValue:"Total"})]}S=[].concat(Q||[],P||[],R||[]);O.push(S)}return O};N=function(){var P='<table id="'+F.tableUuid+'" class="pivot">';for(var O=0;O<J.length;O++){P+="<tr>"+J[O].join("")+"</tr>"}return P+="</table>"};return function(){J=Ext.Array.clean([].concat(I()||[],u()||[],H()||[]));return{html:N(J),uuidDimUuidsMap:A,xColAxis:L,xRowAxis:E,tdCount:p}}()};h.report.query={};h.report.query.sort=function(o,r){var s=o.sorting.id,q=o.sorting?o.sorting.direction:"DESC",n=r.nameHeaderMap[s].index,p=r.rows;j.prototype.array.sort(p,q,n);return r};h.report.query.format=function(o){var p=parseFloat(o);if(!Ext.isNumber(p)||p!=o||new Date(o).toString()!=="Invalid Date"){return o}return p};h.report.query.getHtml=function(u,A){var p=A.dimensionHeaders,B=A.rows,y=A.metaData.names,w=A.metaData.optionNames,q=A.metaData.pager,v=q.page*q.pageSize-q.pageSize;tableCls="pivot",html="";A.sortableIdObjects=[];tableCls+=u.displayDensity?" "+u.displayDensity:"";tableCls+=u.fontSize?" "+u.fontSize:"";html+='<table class="'+tableCls+'"><tr>';html+='<td class="pivot-dim pivot-dim-subtotal">#</td>';for(var s=0,t,n;s<p.length;s++){t=p[s];n=Ext.data.IdGenerator.get("uuid").generate();html+='<td id="'+n+'" class="pivot-dim td-sortable">'+t.column+"</td>";A.sortableIdObjects.push({id:t.name,uuid:n})}html+="</tr>";for(var s=0,z;s<B.length;s++){z=B[s];html+="<tr>";html+='<td class="pivot-value align-right">'+(v+(s+1))+"</td>";for(var r=0,x,t,o;r<p.length;r++){t=p[r];x=z[t.index];x=w[t.name+x]||w[x]||y[x]||x;o=h.report.query.format(x);html+='<td class="pivot-value align-left">'+o+"</td>"}html+="</tr>"}html+="</table>";return{html:html}}}());(function(){if(Ext.isArray(m.dimensions)){j.prototype.array.sort(m.dimensions);for(var n=0,o;n<m.dimensions.length;n++){o=m.dimensions[n];o.dimensionName=o.id;o.objectName=i.finals.dimension.dimension.objectName;i.finals.dimension.objectNameMap[o.id]=o}}if(m.user&&m.user.ouc){j.prototype.array.sort(m.user.ouc)}}());return{conf:i,api:k,support:j,service:g,web:h,init:m}};css="table.pivot { \n font-family: arial,sans-serif,ubuntu,consolas; \n } \n";css+=".td-nobreak { \n white-space: nowrap; \n } \n";css+=".td-hidden { \n display: none; \n } \n";css+=".td-collapsed { \n display: none; \n } \n";css+="table.pivot { \n border-collapse: collapse; \n border-spacing: 0px; \n border: 0 none; \n } \n";css+=".pivot td { \n padding: 5px; \n border: \n 1px solid #b2b2b2; \n } \n";css+=".pivot-dim { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-dim.highlighted { \n	background-color: #c5d8f6; \n } \n";css+=".pivot-dim-subtotal { \n background-color: #cad6e8; \n text-align: center; \n } \n";css+=".pivot-dim-total { \n background-color: #bac6d8; \n text-align: center; \n } \n";css+=".pivot-dim-total.highlighted { \n background-color: #adb8c9; \n } \n";css+=".pivot-dim-empty { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-value { \n background-color: #fff; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal { \n background-color: #f4f4f4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal-total { \n background-color: #e7e7e7; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total { \n background-color: #e4e4e4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total-subgrandtotal { \n background-color: #d8d8d8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-grandtotal { \n background-color: #c8c8c8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-dim-label { \n background-color: #cddaed; \n white-space: nowrap; \n text-align: center; \n } \n";css+=".pivot-empty { \n background-color: #cddaed; \n } \n";css+=".pivot-transparent-column { \n background-color: #fff; \n border-top-color: #fff !important; \n border-right-color: #fff !important; \n } \n";css+=".pivot-transparent-row { \n background-color: #fff; \n border-bottom-color: #fff !important; \n border-left-color: #fff !important; \n } \n";css+=".x-mask-msg { \n padding: 0; \n	border: 0 none; \n background-image: none; \n background-color: transparent; \n } \n";css+=".x-mask-msg div { \n background-position: 11px center; \n } \n";css+=".x-mask-msg .x-mask-loading { \n border: 0 none; \n	background-color: #000; \n color: #fff; \n border-radius: 2px; \n padding: 12px 14px 12px 30px; \n opacity: 0.65; \n } \n";css+=".x-mask { opacity: 0 } \n";css+=".pivot td.legend { \n padding: 0; \n } \n";css+=".pivot div.legendCt { \n display: table; \n float: right; \n width: 100%; \n } \n";css+=".pivot div.arrowCt { \n display: table-cell; \n vertical-align: top; \n width: 8px; \n } \n";css+=".pivot div.arrow { \n width: 0; \n height: 0; \n } \n";css+=".pivot div.number { \n display: table-cell; \n } \n",css+=".pivot div.legendColor { \n display: table-cell; \n width: 2px; \n } \n";css+=".pointer { \n cursor: pointer; \n } \n";css+='.td-sortable { \n background-image: url("http://dhis2-cdn.org/v217/plugin/images/arrowupdown.png"); \n background-repeat: no-repeat; \n background-position: right center; \n padding-right: 15px !important; \n } \n';Ext.util.CSS.createStyleSheet(css);ER.plugin={};var e={user:{},systemInfo:{}},d=[],f=false,b=false,a,c;a=function(h){var m=false,l=[],g=0,k;e.contextPath=h;k=function(){if(++g===l.length){b=true;for(var n=0;n<d.length;n++){c(d[n])}d=[]}};l.push({url:h+"/api/systemSettings.jsonp?key=keyCalendar&key=keyDateFormat",success:function(n){var i=n;e.systemInfo.dateFormat=Ext.isString(i.keyDateFormat)?i.keyDateFormat.toLowerCase():"yyyy-mm-dd";e.systemInfo.calendar=i.keyCalendar;Ext.data.JsonP.request({url:h+"/api/me/user-account.jsonp",success:function(o){e.userAccount=o;Ext.Loader.injectScriptElement(h+"/dhis-web-commons/javascripts/jQuery/jquery.min.js",function(){Ext.Loader.injectScriptElement(h+"/dhis-web-commons/javascripts/dhis2/dhis2.util.js",function(){Ext.Loader.injectScriptElement(h+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.js",function(){Ext.Loader.injectScriptElement(h+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.idb.js",function(){Ext.Loader.injectScriptElement(h+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.ss.js",function(){Ext.Loader.injectScriptElement(h+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.memory.js",function(){var u="en",s="name",r,t,q,p;e.userAccount.settings.keyUiLocale=e.userAccount.settings.keyUiLocale||u;e.userAccount.settings.keyAnalysisDisplayProperty=e.userAccount.settings.keyAnalysisDisplayProperty||s;t=e.contextPath;q=e.userAccount.settings.keyUiLocale;keyAnalysisDisplayProperty=e.userAccount.settings.keyAnalysisDisplayProperty;r=keyAnalysisDisplayProperty===s?keyAnalysisDisplayProperty:keyAnalysisDisplayProperty+"|rename("+s+")";p=e.systemInfo.dateFormat;e.namePropertyUrl=r;dhis2.util.namespace("dhis2.er");dhis2.er.store=dhis2.er.store||new dhis2.storage.Store({name:"dhis2",adapters:[dhis2.storage.IndexedDBAdapter,dhis2.storage.DomSessionStorageAdapter,dhis2.storage.InMemoryAdapter],objectStores:["optionSets"]});Ext.data.JsonP.request({url:t+"/api/optionSets.jsonp?fields=id,version&paging=false",success:function(A){var z=A.optionSets||[],v=dhis2.er.store,x=[],w="",y=0,C,B;B=function(){if(++y===z.length){if(!x.length){k();return}for(var D=0;D<x.length;D++){w+="&filter=id:eq:"+x[D]}Ext.data.JsonP.request({url:t+"/api/optionSets.jsonp?fields=id,name,version,options[code,name]&paging=false"+w,success:function(F){var E=F.optionSets;v.setAll("optionSets",E).done(k)}})}};registerOptionSet=function(D){v.get("optionSets",D.id).done(function(E){if(!Ext.isObject(E)||E.version!==D.version){x.push(D.id)}B()})};v.open().done(function(){for(var D=0;D<z.length;D++){registerOptionSet(z[D])}})}})})})})})})})}})}});l.push({url:h+"/api/organisationUnits.jsonp?userOnly=true&fields=id,name,children[id,name]&paging=false",success:function(q){var p=q.organisationUnits||[],o=[],s=[];if(p.length){for(var n=0,t;n<p.length;n++){t=p[n];o.push(t.id);if(t.children){s=Ext.Array.clean(s.concat(Ext.Array.pluck(t.children,"id")||[]))}}e.user=e.user||{};e.user.ou=o;e.user.ouc=s}else{alert("User is not assigned to any organisation units")}k()}});e.legendSets=[];l.push({url:h+"/api/dimensions.jsonp?links=false&paging=false",success:function(i){e.dimensions=i.dimensions;k()}});l.push();for(var j=0;j<l.length;j++){Ext.data.JsonP.request(l[j])}};c=function(j){var l,i,h,g,k={core:{},app:{}};l=function(m){if(!Ext.isObject(m)){console.log("Event report configuration is not an object");return}if(!Ext.isString(m.el)){console.log("No valid element id provided");return}m.id=m.id||m.uid;return true};i=function(s){var t=k.core.init,o=k.core.conf,q=k.core.api,p=k.core.support,m=k.core.service,n=k.core.web,r=o.finals.dimension;n.events=n.events||{};n.events.setColumnHeaderMouseHandlers=function(x,u,z){if(Ext.isArray(z.sortableIdObjects)){for(var v=0,y,w;v<z.sortableIdObjects.length;v++){y=z.sortableIdObjects[v];w=Ext.get(y.uuid);w.dom.layout=x;w.dom.response=u;w.dom.xResponse=z;w.dom.metaDataId=y.id;w.dom.onColumnHeaderMouseClick=n.events.onColumnHeaderMouseClick;w.dom.onColumnHeaderMouseOver=n.events.onColumnHeaderMouseOver;w.dom.onColumnHeaderMouseOut=n.events.onColumnHeaderMouseOut;w.dom.setAttribute("onclick","this.onColumnHeaderMouseClick(this.layout, this.response, this.metaDataId)");w.dom.setAttribute("onmouseover","this.onColumnHeaderMouseOver(this)");w.dom.setAttribute("onmouseout","this.onColumnHeaderMouseOut(this)")}}};n.events.onColumnHeaderMouseClick=function(v,u,w){if(v.sorting&&v.sorting.id===w){v.sorting.direction=p.prototype.str.toggleDirection(v.sorting.direction)}else{v.sorting={id:w,direction:"ASC"}}if(v.dataType==="aggregated_values"){n.report.createReport(v,u)}else{if(v.dataType==="individual_cases"){n.report.getData(v)}}};n.events.onColumnHeaderMouseOver=function(u){Ext.get(u).addCls("pointer highlighted")};n.events.onColumnHeaderMouseOut=function(u){Ext.get(u).removeCls("pointer highlighted")};n.report=n.report||{};n.report.loadReport=function(u){if(!Ext.isString(u)){alert("Invalid event report id");return}Ext.data.JsonP.request({url:t.contextPath+"/api/eventReports/"+u+".jsonp?fields="+o.url.analysisFields.join(","),failure:function(v){window.open(t.contextPath+"/api/eventReports/"+u+".json?fields="+o.url.analysisFields.join(","),"_blank")},success:function(w){var v=q.layout.Layout(w);if(v){n.report.getData(v,true)}}})};n.report.getData=function(u,v){var w=n.analytics.getParamString(u,"jsonp");n.mask.show(k.app.centerRegion);Ext.data.JsonP.request({url:k.core.init.contextPath+w,disableCaching:false,scope:this,failure:function(x){n.mask.hide(k.app.centerRegion);console.log(x.status+"\n"+x.statusText+"\n"+x.responseText)},success:function(z){var x=q.response.Response(z);if(!x){n.mask.hide(k.app.centerRegion);return}for(var y=0,A=r.objectNameMap,B;y<x.headers.length;y++){B=x.headers[y];A[B.name]=A[B.name]||{id:B.name,dimensionName:B.name,name:B.column}}k.app.paramString=w;n.report.createReport(u,x,v)}})};n.report.createReport=function(w,v,y){var x={},u;u=function(J,E){var I=[];for(var B=0;B<J.headers.length;B++){if(Ext.isString(J.headers[B].optionSet)){I.push(J.headers[B])}}if(I.length){var D=0,G={},F,H;H=function(){if(++D===I.length){J.metaData.optionNames=G;E()}};F=function(L,K){dhis2.er.store.get("optionSets",L).done(function(M){Ext.apply(G,p.prototype.array.getObjectMap(M.options,"code","name",K));H()})};for(var B=0,C,z,A;B<I.length;B++){C=I[B];z=C.optionSet;A=C.name;F(z,A)}}else{E()}};x.aggregated_values=function(){var A,F,B,z,E,D,C,G;G=function(){var H=function(I,J){B=m.layout.getExtendedAxis(I,"col");z=m.layout.getExtendedAxis(I,"row");return n.report.aggregate.getHtml(I,J,B,z)};E=H(A,F);if(E.tdCount>20000||(w.hideEmptyRows&&E.tdCount>10000)){alert("Table has too many cells. Please reduce the table and try again.");n.mask.hide(k.app.centerRegion);return}if(w.sorting){F=n.report.aggregate.sort(A,F,B);A=m.layout.getSyncronizedXLayout(w,A,F);E=H(A,F)}k.app.centerRegion.update(E.html);Ext.defer(function(){Ext.get(k.core.init.el).fadeIn({duration:400})},300);k.app.layout=w;k.app.xLayout=A;k.app.response=v;k.app.xResponse=F;k.app.xColAxis=B;k.app.xRowAxis=z;k.app.uuidDimUuidsMap=E.uuidDimUuidsMap;k.app.uuidObjectMap=Ext.applyIf((B?B.uuidObjectMap:{}),(z?z.uuidObjectMap:{}));if(ER.isSessionStorage){n.events.setColumnHeaderMouseHandlers(w,v,F)}n.mask.hide(k.app.centerRegion);if(ER.isDebug){console.log("Number of cells",E.tdCount);console.log("layout",w);console.log("response",v);console.log("xResponse",F);console.log("xLayout",A);console.log("core",k.core);console.log("app",k.app)}};D=function(){A=m.layout.getSyncronizedXLayout(w,A,F);G()};C=function(){A=m.layout.getExtendedLayout(w);F=m.response.aggregate.getExtendedResponse(A,v);u(F,D)};v=v||k.app.response;C()};x.individual_cases=function(){var z,A;A=function(){table=n.report.query.getHtml(w,z);k.app.centerRegion.removeAll(true);k.app.centerRegion.update(table.html);Ext.defer(function(){Ext.get(k.core.init.el).fadeIn({duration:400})},300);k.app.layout=w;k.app.response=v;k.app.xResponse=z;if(ER.isSessionStorage){n.events.setColumnHeaderMouseHandlers(w,v,z)}n.mask.hide(k.app.centerRegion)};z=m.response.query.getExtendedResponse(w,v);u(z,A)};x[w.dataType]()};n.report.sort=function(A,w,u){var A=Ext.clone(A),w=Ext.clone(w),y=A.rows[0],v=w.idValueMap,B=A.sorting?A.sorting.direction:"DESC",z;y.ids=[];for(var x=0,E,D,C;x<y.items.length;x++){E=y.items[x];D=u+E.id;C=parseFloat(v[D]);E.value=Ext.isNumber(C)?C:(Number.MAX_VALUE*-1)}p.prototype.array.sort(y.items,B,"value");for(var x=0;x<y.items.length;x++){y.ids.push(y.items[x].id)}z=q.layout.Layout(A);n.report.createReport(z,null,w,false)}};h=function(){return{centerRegion:Ext.get(j.el)}};g=function(){if(!l(j)){return}k.core=ER.getCore(Ext.clone(e));k.core.init.el=j.el;Ext.get(k.core.init.el).setStyle("opacity",0);i(k);k.app.viewport=h();k.app.centerRegion=k.app.viewport.centerRegion;if(j.id){k.core.web.report.loadReport(j.id)}else{layout=k.core.api.layout.Layout(j);if(!layout){return}k.core.web.report.getData(layout)}}()};ER.plugin.getEventReport=function(g){if(Ext.isString(g.url)&&g.url.split("").pop()==="/"){g.url=g.url.substr(0,g.url.length-1)}if(b){c(g)}else{d.push(g);if(!f){f=true;a(g.url)}}};DHIS=Ext.isObject(window.DHIS)?DHIS:{};DHIS.getEventReport=ER.plugin.getEventReport});
