
<script>
    $(document).bind('pagechange',function(){
        $.mobile.loading( 'show' );

        $.ajax({
            url: '$contextPath/api/currentUser/inbox',
            dataType: 'json'
        }).success(function(data) {
            if( data['messageConversations'] !== undefined ) {
                $.each(data.messageConversations, function(i, item) {
                    if(item.read) {
                        $('#messageList').append('<li><a href="messages/' + item.id + '">' + item.name + '</a></li>');
                    } else {
                        $('#messageList').append('<li class="ui-btn-active"><a href="messages/' + item.id + '">' + item.name + '</a></li>');
                    }
                });
            } else {
                $('#messageList').append('<li>No messages</li>');
            }
        }).error(function() {
            $.mobile.loading( 'show', {
                html: '<h1>Unable to get inbox, please try again later</h1>',
                textVisible: true
            });

            setTimeout( function() {
                $.mobile.loading( 'hide' );
            }, 1500);
        }).complete(function() {
            $('section[data-role="content"] ul').listview('refresh');
            $.mobile.loading( 'hide' );
        });
    });
</script>

<section data-role="page" id="messages-page" data-theme="c">

	<header data-role="header" data-theme="b">
        <h1 align="center"><img src="$contextPath/dhis-web-commons/css/light_blue/logo_banner.png" /></h1>
        <a href="index" data-icon="back">Back</a>
        <a href="messages/new-message" data-icon="plus">New</a>
    </header>

	<section data-role="content">
        <ul id="messageList" data-role="listview" data-inset="true" data-count-theme="b">
            <li data-role="list-divider">Messages</li>
        </ul>
	</section>

    <footer data-role="footer" data-theme="b">
        <h1></h1>
   	</footer>

</section>
