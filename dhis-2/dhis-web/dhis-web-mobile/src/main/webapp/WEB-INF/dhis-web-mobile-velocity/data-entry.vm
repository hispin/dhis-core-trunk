
<script>
    function selectOrganisationUnit(e, data) {
        var $this = $(this);
        console.log($this.data('id'));
    }

    function loadOrganisationUnitsPage() {
        jQuery.ajax({
            url   : '$baseUrl/../api/currentUser/organisationUnits',
            data: {
              'withChildren': true
            },
            dataType: 'json'
        }).success(function ( data ) {
            var tmpl = jQuery('#organisation-units-template').html();

            jQuery('#organisation-units-page section[data-role="content"]').html(
                _.template( tmpl, { 'organisationUnits': data } )
            );

            console.log(data);
            jQuery('#organisation-unit-list').listview()
        }).error(function () {
            console.log('error fetching orgUnits')
        });

    }

    function loadDataEntryPage() {

    }

    function loadDataSetsPage() {

    }

    jQuery(document).bind('pagechange', function (event, data) {
        var pageId = data.toPage.attr('id');
        console.log(pageId);

        if( pageId == 'organisation-units-page' ) {
            loadOrganisationUnitsPage();
        } else if( pageId == 'data-sets-page' ) {
            loadDataSetsPage();
        } else if( pageId == 'data-entry-page' ) {
            loadDataEntryPage();
        }
    });

    jQuery(document).bind('pageinit', function() {
        $('#organisation-unit-list li a').bind('click', selectOrganisationUnit);
    });
</script>

<script id="organisation-units-template" type="text/template">
    <ul id="organisation-unit-list" data-role="listview" data-inset="true">
        <% _( organisationUnits ).each( function(organisationUnit, idx) { %>
        <li><a href="#data-sets-page" data-id="<%= organisationUnit.id %>"><%= organisationUnit.name %></a></li>
        <% }); %>
    </ul>
</script>

<script id="data-sets-template" type="text/template">
    <ul id="data-set-list" data-role="listview" data-inset="true">
        <% _( dataSets ).each( function(dataSet, idx) { %>
        <li><a href="#data-entry-page" data-id="<%= dataSet.id %>"><%= dataSet.name %></a></li>
        <% }); %>
    </ul>
</script>

<section data-role="page" id="organisation-units-page" data-theme="c">

	<header data-role="header" data-theme="b">
        <h1 align="center"><img src="$baseUrl/../dhis-web-commons/css/light_blue/logo_banner.png" /></h1>
        <a href="index" data-icon="back">Back</a>
	</header>

	<section data-role="content">
	</section>

    <footer data-role="footer" data-theme="b">
        <h1></h1>
   	</footer>

</section>

<section data-role="page" id="data-sets-page" data-theme="c">

	<header data-role="header" data-theme="b">
        <h1 align="center"><img src="$baseUrl/../dhis-web-commons/css/light_blue/logo_banner.png" /></h1>
        <a href="#organisation-units-page" data-icon="back">Back</a>
	</header>

	<section data-role="content">
	</section>

    <footer data-role="footer" data-theme="b">
        <h1></h1>
   	</footer>

</section>

<section data-role="page" id="data-entry-page" data-theme="c">

	<header data-role="header" data-theme="b">
        <h1 align="center"><img src="$baseUrl/../dhis-web-commons/css/light_blue/logo_banner.png" /></h1>
        <a href="#data-sets-page" data-icon="back">Back</a>
	</header>

	<section data-role="content">
	</section>

    <footer data-role="footer" data-theme="b">
        <h1></h1>
   	</footer>

</section>
