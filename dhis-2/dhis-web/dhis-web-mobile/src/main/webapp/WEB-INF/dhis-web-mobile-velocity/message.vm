
<script>
    jQuery(document).bind('pagebeforecreate',function(){
        jQuery.ajax({
            url: '$baseUrl/../api/messageConversations/${messageId}.json',
            async: false
        }).success(function(data) {
            var tmpl = jQuery('#message-template').html();

            jQuery('section[data-role="content"]').html(
                _.template( tmpl, data )
            );

            console.log(data);
        }).error(function() {
            console.log('error fetching message')
        });
    });
</script>

<script id="message-template" type="text/template">
    <ul data-role="listview" data-inset="true">
        <li data-role="list-divider"><%= subject %></li>
        <% _( _( messages ).reverse() ).each( function(message, idx) { %>
        <% var d = new Date( message.lastUpdated ).toDateString(); %>
        <li>
            <h3><%= message.sender.name %></h3>
            <p style="white-space: normal !important"><%= message.name %></p>
            <p class="ui-li-aside"><strong><%= d %></strong></p>
        </li>
        <% }); %>
    </ul>
</script>

<section data-role="page" id="messagePage" data-theme="c">

	<header data-role="header" data-theme="b">
		<div align="center"><img src="$baseUrl/../dhis-web-commons/css/light_blue/logo_banner.png" /></div>
        <a href="../messages" data-icon="back">Back</a>
	</header>

	<section data-role="content">
	</section>

    <footer data-role="footer" data-theme="b">
        <h1></h1>
   	</footer>

</section>
