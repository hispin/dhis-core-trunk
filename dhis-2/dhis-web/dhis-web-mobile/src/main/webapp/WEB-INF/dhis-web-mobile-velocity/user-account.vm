
<script>
    $(document).bind('pagechange',function(){
        $.mobile.loading( 'show' );

        $.ajax({
            url: '$contextPath/api/currentUser/user-account',
            dataType: 'json'
        }).success(function(data) {
            // user account
            $('#firstNameInput').val(data.firstName);
            $('#surnameInput').val(data.surname);
            $('#emailInput').val(data.email);
            $('#phoneNumberInput').val(data.phoneNumber);

            // profile
            $('#introductionInput').val(data.introduction);
            $('#jobTitleInput').val(data.jobTitle);

            $('#genderInput').children().each(function ( idx, item ) {
                item.selected = item.value == data.gender;
            });

            $('#genderInput').selectmenu('refresh');

            $('#birthdayInput').val(data.birthday);
            $('#nationalityInput').val(data.nationality);
            $('#employerInput').val(data.employer);
            $('#educationInput').val(data.education);
            $('#interestsInput').val(data.interests);
            $('#languagesInput').val(data.languages);
        }).complete(function() {
            $.mobile.loading( 'hide' );
        });

        $('input:submit').bind('click', function(e) {
            var settings = $('#settings-form').serializeArray();

            settings = _(settings).reduce(function(acc, field) {
               acc[field.name] = field.value;
               return acc;
            }, {});

            $.mobile.loading( 'show' );

            $.ajax({
                url: '$contextPath/api/currentUser/user-account',
                contentType: 'application/json',
                data: JSON.stringify( settings ),
                type: 'POST'
            }).complete(function() {
                $.mobile.loading( 'hide' );
                window.location.href = '../mobile';
            });

            e.preventDefault();
        })
    });
</script>

<section data-role="page" id="settings-page" data-theme="c">

	<header data-role="header" data-theme="b">
        <h1 align="center"><img src="$contextPath/dhis-web-commons/css/light_blue/logo_banner.png" /></h1>
        <a href="index" data-icon="back">Back</a>
	</header>

    <section data-role="content">
        <form id="settings-form" method="POST">
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider">User Account</li>
            <li>
                   <label for="firstNameInput">First Name:</label>
                   <input id="firstNameInput" name="firstName" type="text" placeholder="First name.." />

                   <label for="surnameInput">Surname:</label>
                   <input id="surnameInput" name="surname" type="text" placeholder="Surname.." />

                   <label for="emailInput">E-mail:</label>
                   <input id="emailInput" name="email" type="text" placeholder="E-mail.." />

                   <label for="phoneNumberInput">Phone Number:</label>
                   <input id="phoneNumberInput" name="phoneNumber" type="text" placeholder="Phone number.." />
            </li>
            <li data-role="list-divider">Profile</li>
            <li>
                <label for="introductionInput">Introduction</label>
                <textarea id="introductionInput" name="introduction"></textarea>

                <label for="jobTitleInput">Job Title:</label>
                <input id="jobTitleInput" name="jobTitle" type="text" placeholder="Job Title.." />

                <label for="genderInput">Gender:</label>
                <select id="genderInput" name="gender">
                    <option value="gender_male">Male</option>
                    <option value="gender_female">Female</option>
                    <option value="gender_other">Other</option>
                </select>

                <label for="birthdayInput">Birthday:</label>
                <input id="birthdayInput" name="birthday" type="text" placeholder="yyyy-mm-dd (e.g. 1980-04-02)" />

                <label for="nationalityInput">Nationality:</label>
                <input id="nationalityInput" name="nationality" type="text" placeholder="Nationality.." />

                <label for="employerInput">Employer:</label>
                <input id="employerInput" name="employer" type="text" placeholder="Employer.." />

                <label for="educationInput">Education:</label>
                <textarea id="educationInput" name="education"></textarea>

                <label for="interestsInput">Interests:</label>
                <textarea id="interestsInput" name="interests"></textarea>

                <label for="languagesInput">Languages:</label>
                <textarea id="languagesInput" name="languages"></textarea>

                <input type="submit" value="Save" />
            </li>
        </ul>
        </form>
   	</section>

    <footer data-role="footer" data-theme="b">
        <h1></h1>
   	</footer>

</section>
