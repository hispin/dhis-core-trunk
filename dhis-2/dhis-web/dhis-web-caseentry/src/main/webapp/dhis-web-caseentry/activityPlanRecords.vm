<script src="javascript/tooltip.js" type="text/javascript"></script>
<table>
	<tr>
		<td class='text-column' >$i18n.getString( "search_result_matching_the_search_criteria" ):</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>
		#if($!listAll)
			$i18n.getString( "list_all_patients" )
		#else
			$i18n.getString( "advanced_search_patients" )
		#end
		</td>
	</tr>	
	
	<tr>
		<td class='text-column' >$i18n.getString( "total_result" ):</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>$!total</td>
	</tr>
</table>

#if( $patients && $patients.size()>0 )
	<p>#parse( "/dhis-web-caseentry/colorHelp.vm" )</p>
	
	<table class="listTable" id="patientList">
		#set( $mark = false )                 
		#foreach( $patient in $patients )
			#set( $programInstance = '')
			#set( $programInstance = $programInstanceMap.get( $patient ) )
				<tr #alternate( $mark )>
					<td width="10px">
						#set( $value="")
						#foreach( $identifierType in $programInstance.program.patientIdentifierTypes )
							#foreach( $pIdentifier in $patient.identifiers )
								#if($identifierType.personDisplayName=="true" && $identifierType.id==$pIdentifier.identifierType.id)
									#set($value=$value + $pIdentifier.identifier + "&#13;&#10;" )
								#end
							#end
						#end
						#if($value=="")
							#set($value=$patient.getFullName())
						#end
						<input type='button' class='patient-object' value='$value' onclick='javascript:showPatientHistory( "$programInstance.id" );' title='$i18n.getString( "patient_dashboard" )'>
					</td>
					<td class='bold' name="toggleFlowBtn" style='cursor:pointer;font-size:25px' onclick="eventFlowToggle($programInstance.id)">
						<a>&raquo;</a>
					</td>
					#if($!programStageInstanceMap.get($programInstance))
						#set($programStageInstances = $programStageInstanceMap.get($programInstance) )
					<td>
						<table id='tb_$programInstance.id'>	
							<tr>
								<td>
									<div #if($programInstance.programStageInstances.size()<4) class="arrow-left hidden"  #else class="arrow-left" #end onclick="moveLeft('flow_$programInstance.id')">&nbsp;</div>
								</td>
								<td>
									<div id='flow_$programInstance.id' class='stage-flow'>
										<table class="table-flow">
										<tr>
										#set( $flag = "false" )
										#foreach( $programStageInstance in $programStageInstances )
											<td id="arrow_$programStageInstance.id" name="arrow" width="5px" style='font-size:25px;'>&rarr;</td>
											<td id="td_$programStageInstance.id" name="td">
												#set($title="")
												#set($index = 0)
												#foreach( $comment in $programStageInstance.patientComments)
													#if( $index < 5)
														#set( $title= $title + "$format.formatDate( $comment.createdDate ) - $comment.creator - $comment.commentText &#13;&#10;" )
														#set( $index = $index + 1 )
													#end
												#end
												#foreach( $sms in $programStageInstance.outboundSms)
													#if( $index < 5)
														#set( $title= $title + "$format.formatDate( $sms.date ) - $sms.message &#13;&#10;")
														#set( $index = $index + 1)
													#end
												#end
												
												<input type="button" name="programStageBtn"
													id="ps_$!programStageInstance.id"
													psid="$programStageInstance.programStage.id"
													psname="$programStageInstance.programStage.name"
													orgunit="$!programStageInstance.organisationUnit.name"
													programType='$programInstance.program.type'
													reportDate="$!format.formatDate( $!programStageInstance.executionDate )"
													reportDateDes="$programStageInstance.programStage.reportDateDescription"
													dueDate="$format.formatDate( $programStageInstance.dueDate )"
													class="stage-object" 
													title="$title"
													value="$programStageInstance.programStage.name&#13;&#10;$format.formatDate( $programStageInstance.dueDate )" 
													onclick="javascript:loadDataEntry( $programStageInstance.id );">
												<script>	
													var status = $statusMap.get( $programStageInstance.id ); 
													setEventColorStatus( 'ps_' + $programStageInstance.id ,status);
												</script>
											</td>
										#end
										</tr>
									</table></div>
								</td>
								
								<td>
									<div #if($programInstance.programStageInstances.size()<4) class="arrow-right hidden"  #else class="arrow-right" #end onclick="moveRight('flow_$programInstance.id')">&nbsp;</div>
								</td>
							</tr>
						</table>
					</td>
					#end
				</tr>
			#if( $mark )
				#set( $mark = false )
			#else
				#set( $mark = true )
			#end 
		#end
	</table>
	
	<div class="paging-container">
		#parse( "/dhis-web-commons/paging/paging.vm" )
	</div>
	
	<div id="detailsInfo"></div>
#end

<script>
	if(getFieldValue('statusEvent')!="0" ){
		#if( $programStageInstanceIds 
			&& $programStageInstanceIds.size() > 0 )
			
			jQuery("#patientList .stage-object").each( function(){
				var programStageInstance = this.id.split('_')[1];
				hideById('arrow_' + programStageInstance );
				hideById('td_' + programStageInstance );
			});
			
			jQuery(".arrow-left").css("display", "none");
			jQuery(".arrow-right").css("display", "none");
			#foreach( $id in $programStageInstanceIds )
				showById('arrow_$id');
				showById('td_$id');
				jQuery("#ps_$id").addClass("stage-object-selected searched");
			#end
		#end
	}
	
	resize();
	
	$(window).bind('resize', function(e){ 
		resize();
	});
	
</script>