<fieldset>
	<legend>$i18n.getString("program")</legend>
	<table>
		<tr>
			<td class='text-column'><label for="enrollmentDate">$programInstance.program.dateOfEnrollmentDescription<em title="$i18n.getString( "required" )" class="required"> * </em></label></td>
			<td><input type="text" id="enrollmentDate" name="enrollmentDate" class="{validate:{required:true}}" value="$!format.formatDate( $programInstance.enrollmentDate )"></td>
		</tr>
		<tr>
			<td class='text-column'><label for="dateOfIncident">$programInstance.program.dateOfIncidentDescription<em title="$i18n.getString( "required" )" class="required"> * </em></label></td>
			<td><input type="text" id="dateOfIncident" name="dateOfIncident"  class="{validate:{required:true}}" value="$!format.formatDate( $programInstance.dateOfIncident )"></td>
		</tr>
		<tr>
			<td></td>
			<td>
				<input type="button" class='button' value="$i18n.getString( 'update' )" onclick='updateEnrollment($programInstance.patient.id, $programInstance.program.id, $programInstance.id, "$programInstance.program.name")'/>
				<input type="button" class='button' value="$i18n.getString( 'unenroll' )" onclick='unenrollmentForm($programInstance.id)'/>
			</td>
		<tr>
	</table>
</fieldset>
<br>
#set($programStageInstances = $programInstance.programStageInstances)
#if( $programStageInstances.size() > 0 )
	<table class='mainPageTable' id='progarmStageListDiv' name='progarmStageListDiv' >
		<col id="noCol"/>
		<col id="stageCol"/>    
		<col id="entryCol"/>    
		<tr>
			<th>$i18n.getString( "nr" )</th>
			<th>$i18n.getString( "program_stage" )</th>                   
			<th>$i18n.getString( "reschedule" )</th> 
			<th>$i18n.getString( "status" )</th>
			<th>$i18n.getString( "delete" )</th>
		</tr>
		
	#set( $rowCount = 0 )
	#set( $mark = false )
	#foreach( $programStageInstance in $programStageInstances )
		#set( $rowCount = $rowCount + 1 )   
		<tr id="tr${programStageInstance.id}" #alternate( $mark ) >
			##rowCount
			<td>$rowCount</td>        
			##stage name
			<td class='textColumn'>
				<span id="value[$programStageInstance.id].name" title="$!encoder.htmlEncode( $programStageInstance.programStage.description )">
					$encoder.htmlEncode( $programStageInstance.programStage.name )            
				</span>
			</td>        
				   
			##entry
			#set($status = $programStageInstance.getEventStatus())
			<td class='input-column '>    
				#set( $duedateId = "value_" + $programStageInstance.id + "_date" )        
				#if($programStageInstance.executionDate)
					<input type="text" id="$duedateId" name="entryfield" value="$!format.formatDate( $programStageInstance.executionDate )" onchange="saveExecutionDate( $programInstance.program.id, $programStageInstance.id, this );" />
					<script type="text/javascript">
						#if( $status==1 || $status==5 )
							disable('$duedateId');
						#else
							datePickerValid( '$duedateId');
						#end
					</script> 

				#else
					<input type="text" id="$duedateId" name="entryfield" value="$!format.formatDate( $programStageInstance.dueDate )" onchange="saveDueDate( $programInstance.id, $programStageInstance.id, '$encoder.jsEncode( $programStageInstance.programStage.name )' )" />
					<script type="text/javascript">
						#if( $status==1 || $status==5 )
							disable('$duedateId');
						#else
							datePickerFuture( '$duedateId');
						#end
					</script> 
				#end
			</td> 
			
			<td>
				<select id="stat_$programStageInstance.id" name="status_$programStageInstance.id" style='width:150px;' onchange="setEventStatus(this, $programStageInstance.id)">
					#if($status==4)
						<option value='4'>$i18n.getString("overdue")</option>
						<option value='5'>$i18n.getString("skipped")</option>
					#elseif($status==3)
						<option value='3'>$i18n.getString("scheduled_in_future")</option>
						<option value='5'>$i18n.getString("skipped")</option>
					#elseif($status==5)
						<option value='4'>$i18n.getString("overdue")</option>
						<option value='3'>$i18n.getString("scheduled_in_future")</option>
						<option value='5'>$i18n.getString("skipped")</option>
					#else
						<option value='1'>$i18n.getString("completed")</option>
						<option value='2'>$i18n.getString("incompleted")</option>
					#end
				</select>
				<script>
					setFieldValue("stat_$programStageInstance.id", "$status");
				</script>
			</td>
			
			<td>
				#if($programStageInstance.programStage.irregular=='true' && ($status==3 || $status==4 || $status==5 ))
					<a href="javascript:removeEvent($programStageInstance.id, false)" title='$i18n.getString( "remove" )'><img src="../images/delete.png" alt='$i18n.getString( "remove" )'></a>
				#end
			</td>
		</tr>
		#set( $mark = !$mark  )
	#end
	</table>
#end

<script>
	#if( $!programInstance )
		showById('unenrollBtn');
	#end
	#if( $programInstance.completed=='false')
		datePickerInRangeValid( 'dateOfIncident' , 'enrollmentDate' );
	#end
</script>