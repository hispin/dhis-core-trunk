#if( $programInstance || $hasDataEntry=='true')
<input type='hidden' id='programInstanceId' name='programInstanceId' value='$programInstance.id' />
<div id="tabs">
	<ul>
		<li><a href="#tab-1">$i18n.getString("identifier_and_attribute")</a></li>
		<li><a href="#tab-2">$i18n.getString("modify_due_date_or_visit_date")</a></li>
		<li><a href="#tab-3">$i18n.getString("data_entry_screen")</a></li>
		<li><a href="#tab-4">$i18n.getString("unenrollment")</a></li>
	</ul>
	
	
	
	<!-- Enroll program TAB -->
	<div id="tab-1">
		<form id='programEnrollmentInforForm' name='programEnrollmentInforForm' action='#' method="POST" >
			<!-- IDENTIFIERS -->
			#if( $identifierTypes || $noGroupAttributes || $attributeGroups )
				<table class='mainPageTable' id='enrollmentInforDiv' name='enrollmentInforDiv' >
					<col id="stageCol">    
					<col id="entryCol">    
					#if( $identifierTypes.size() > 0 )
					<tr>
						<th colspan='2'>$i18n.getString( "identifier" )</th> 
					</tr>
					#end
					
					#set( $mark = false )
					#foreach ($identifierType in $identifierTypes)
						#set( $identifier = $identiferMap.get( $identifierType.id ) )
						<tr #alternate( $mark )>
							<td class='text-column'><label>$identifierType.name #if($identifierType.mandatory == true )<em title="$i18n.getString( 'required' )" class="required">*</em> #end</label></td>       
							<td class="input-column">
								<input type="text" id="iden$identifierType.id" name="iden$identifierType.id" value='$!identifier' class="{validate:{required:$identifierType.mandatory, #if($!identifierType.noChars) maxlength:$identifierType.noChars, #end #if($identifierType.type=='number') number:true #elseif($!identifierType.type=='letter') lettersonly:true #end }}" onchange='savePatientIdentifier( $identifierType.id, this);' />
							</td>
						</tr>
						#set( $mark = !$mark  )
					#end

				<!-- ATTRIBUTES IN GROUPS -->
				<tr><td>&nbsp;</td></tr>	
				#foreach ($attributeGroup in $attributeGroups )
					<tr><th colspan="2" class="heading-column">$attributeGroup.name</th></tr>
					#set( $mark = false )
					#foreach($attribute in $attributeGroup.attributes)
						#if( $!attribute.program )
							#set( $attributeValue = $!patientAttributeValueMap.get( $attribute.id ) )
							<tr #alternate( $mark )>
								<td class='text-column'><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
								<td class="input-column" >
									#if( $attribute.valueType == "YES/NO" )
										<select id="attr$attribute.id" name="attr$attribute.id" onchange='savePatientAttrValue( $attribute.id, this);' >              
											<option value="">[$i18n.getString( "please_select" )]</option>
											<option value="true" #if( $attributeValue=='true') selected="selected" #end>$i18n.getString( "yes" )</option>
											<option value="false" #if( $attributeValue=='false') selected="selected" #end>$i18n.getString( "no" )</option>
										</select>                
									#elseif( $attribute.valueType == "DATE" )
										<input type="text" id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class=' #validate( "default"  $attribute.mandatory )'  onchange='savePatientAttrValue( $attribute.id, this);' >
										<script type="text/javascript">
											datePickerValid( 'attr$attribute.id' );
										</script>                 
									#elseif( $attribute.valueType == "COMBO" )
										<select  id="attr$attribute.id" name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )' onchange='savePatientAttrValue( $attribute.id, this);' >
											 <option value="">[$i18n.getString( "please_select" )]</option>
										#foreach ($option in $attribute.attributeOptions )
											<option value="$option.id" #if($attributeValue == $option.name) selected="selected" #end>$option.name</option>
										#end
										</select>
									#else 
										<input type="text"  id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class="{validate:{required:$attribute.mandatory #if($!attribute.noChars),maxlength:$attribute.noChars #end #if($attribute.valueType=='NUMBER'),number:true #end }}"  onchange='savePatientAttrValue( $attribute.id, this);' > 
									#end
								</td>		
							</tr>
							#set( $mark = !$mark  )
						#end
					#end
				#end
				<tr><td>&nbsp;</td></tr>

				<!-- ATTRIBUTES NOT IN GROUPS -->

				#if ( $noGroupAttributes && $noGroupAttributes.size() > 0) 	
					<tr><th colspan="2" class="heading-column">$i18n.getString( "Other details" )</th></tr>
					#set( $mark = false )
					#foreach($attribute in $noGroupAttributes )
						#if( $attribute.program )
							#set( $attributeValue = $!patientAttributeValueMap.get( $attribute.id ) )
							<tr #alternate( $mark )>
								<td class='text-column'><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
								<td class="input-column" >
									#if( $attribute.valueType == "YES/NO" )
										<select id="attr$attribute.id"  name="attr$attribute.id" onchange='savePatientAttrValue( $attribute.id, this);' >              
											<option value="">[$i18n.getString( "please_select" )]</option>
											<option value="true" #if( $attributeValue ) selected="selected" #end>$i18n.getString( "yes" )</option>
											<option value="false" #if( !$attributeValue ) selected="selected" #end>$i18n.getString( "no" )</option>
										</select>                
									#elseif( $attribute.valueType == "DATE" )
										<input type="text" id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class=' #validate( "default"  $attribute.mandatory )' onchange='savePatientAttrValue( $attribute.id, this);' >
										<script type="text/javascript">
											datePickerValid( 'attr$attribute.id' );
										</script>                    
									#elseif( $attribute.valueType == "COMBO" )
										<select  id="attr$attribute.id"  name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )' onchange='savePatientAttrValue( $attribute.id, this);' >
											 <option value="">[$i18n.getString( "please_select" )]</option>
										#foreach ($option in $attribute.attributeOptions )
											<option value="$option.id" #if($attributeValue == $option.name) selected="selected" #end>$option.name</option>
										#end
										</select>
									#else
										<input type="text"  id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class="{validate:{required:$attribute.mandatory #if($!attribute.noChars),maxlength:$attribute.noChars #end #if($attribute.valueType=='NUMBER'),number:true #end }}" onchange='savePatientAttrValue( $attribute.id, this);' >
									#end
								</td>		
							</tr>
							#set( $mark = !$mark  )
						#end
					#end
				#end
			</table>
			#end
			<input type='submit' class='hidden'> 
		</form>
	</div>

	<!-- Program-stage-instance TAB -->
	<div id="tab-2">
		#if( $programStageInstances.size() > 0 )
			<table class='mainPageTable' id='progarmStageListDiv' name='progarmStageListDiv' >
				<col id="noCol">
				<col id="stageCol">    
				<col id="entryCol">    
				<tr>
					<th>$i18n.getString( "nr" )</th>
					<th>$i18n.getString( "program_stage" )</th>                   
					<th>$i18n.getString( "due_date" )</th>        
				</tr>
				
			#set( $rowCount = 0 )
			#set( $mark = false )
			#foreach( $programStageInstance in $programStageInstances )
				#set( $rowCount = $rowCount + 1 )   
				<tr #alternate( $mark ) >
					##rowCount
					<td>$rowCount</td>        
					##stage name
					<td class='textColumn'>
						<span id="value[$programStageInstance.id].name" title="$!encoder.htmlEncode( $programStageInstance.programStage.description )">
							$encoder.htmlEncode( $programStageInstance.programStage.name )            
						</span>
					</td>        
						   
					##entry
					#set( $duedateId = "value_"+$programStageInstance.id+"_date" )        
					<td class='input-column '>        
						<input type="text" id="$duedateId" name="entryfield" value="$!format.formatDate( $programStageInstance.dueDate )" onchange="saveDueDate( $programStageInstance.id, '$encoder.jsEncode( $programStageInstance.programStage.name )' )" />
						<script type="text/javascript">
							datePicker( '$duedateId' );
						</script> 
					</td>      
				</tr>
				#set( $mark = !$mark  )
			#end
			</table>
		#end
	</div>

	<div id="tab-3">
		<div id='dataRecordingSelectDiv' class='hidden'></div>
		<div id='dataEntryFormDiv' class='hidden'></div>
	</div>

	<div id="tab-4">
		<table>
			#foreach($attribute in $programAttributes)
			<tr>
				<td class='text-column'>$attribute.name</td>
				<td class="input-column">
					#if( $attribute.valueType == "YES/NO" )
						<select id="attr$attribute.id" name="attr$attribute.id" > 
							<option value="">[$i18n.getString( "please_select" )]</option>
							<option value="true">$i18n.getString( "yes" )</option>
							<option value="false">$i18n.getString( "no" )</option>
						</select>                     
					#elseif( $attribute.valueType == "DATE" )
						<input type="text" id="attr$attribute.id" name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )'>
						<script type="text/javascript">
							var attributeId = 'attr' + '$attribute.id'
							datePickerValid( attributeId );
						</script>                       
					#elseif( $attribute.valueType == "COMBO" )
						<select id="attr$attribute.id" name="attr$attribute.id" >
							<option value="">[$i18n.getString( "please_select" )]</option>
							#foreach ($option in $attribute.attributeOptions )
								<option value="$option.id" >$option.name</option>
							#end
						</select>
					#else 
						<input type="text" id="attr$attribute.id" name="attr$attribute.id" >
					#end
					
					#if($!programAttribute.description) <i>($!programAttribute.description)</i> #end
				</td>		
			</tr>
			#end
			
			<tr>
				<td></td>
				<td></td>                            
			</tr>
		
			<tr>
				<td>
					<input type="button" class='button' value='$i18n.getString( "unenroll" )' onclick="javascript:unenrollmentForm( getFieldValue('programInstanceId') );" >
				</td>                                        
			</tr>
		</table>
	</div>
	
</div>	

#end

<script type="text/javascript">
	
	jQuery("#programEnrollmentInforForm").ready(	function(){
		validation( 'programEnrollmentInforForm', function(form){
			return false;
		});	
	});
		
	#if( $programInstance || $hasDataEntry == 'true')
		$('#tabs').tabs();
			
		#if( $identifierTypes || $noGroupAttributes || $attributeGroups )
			$( "#tabs" ).tabs( "option", "selected", 1 );
			$( "#tabs" ).tabs( "option", "disabled", [0] );
		#end
		
		#if( $programInstance )
		#else
			$( "#tabs" ).tabs( "option", "selected", 2 );
			$( "#tabs" ).tabs( "option", "disabled", [0,1,3] );
		#end
		
		#if( $hasDataEntry == 'true' )
			showSelectedDataRecoding( getFieldValue('patientId') );
		#else
			$( "#tabs" ).tabs( "option", "disabled", [2] );
		#end
	#end
	
	byId('enrollBtn').value = i18n_update;
	setInnerHTML('enrollmentDateDescription', "$!program.dateOfEnrollmentDescription" );
	setInnerHTML('dateOfIncidentDescription', "$!program.dateOfIncidentDescription" );
	setFieldValue('enrollmentDate', "$!format.formatDate( $programInstance.enrollmentDate )" );
	setFieldValue('dateOfIncident', "$!format.formatDate( $programInstance.dateOfIncident )");
	
	if ( getFieldValue('enrollmentDate' ) == ''){	
		jQuery('#enrollBtn').attr( 'value',i18n_enroll_to_program );
	}else{
		jQuery('#enrollBtn').attr( 'value',i18n_update );
	}	
</script>
