<hr>
<form id='programEnrollmentInforForm' name='programEnrollmentInforForm' action='#' method="POST" >
<!-- IDENTIFIERS -->
#if( $identifierTypes.size() > 0 || $noGroupAttributes.size() > 0 || $attributeGroups.size() > 0 )
	<h3>$i18n.getString('patient_identifier_and_attributes') <img src='../images/down.png' onclick='toogleDiv( "enrollmentInforDiv" );'></h3>
	
	<table class='mainPageTable' id='enrollmentInforDiv' name='enrollmentInforDiv' >
		<col id="stageCol">    
		<col id="entryCol">    
		#if( $identifierTypes.size() > 0 )
		<tr>
			<th colspan='2'>$i18n.getString( "patient_identifier" )</th> 
		</tr>
		#end
		
		#set( $tabIndex = 1 )
		#set( $mark = false )
		#foreach ($identifierType in $identifierTypes)
			#set( $identifier = $identiferMap.get( $identifierType.id ) )
			<tr #alternate( $mark )>
				<td class='text-column'><label>$identifierType.name #if($identifierType.mandatory == true )<em title="$i18n.getString( 'required' )" class="required">*</em> #end</label></td>       
					<td class="input-column">
					<input type="text" id="iden$identifierType.id" name="iden$identifierType.id" value='$identifier' class="{validate:{required:$identifierType.mandatory, #if($!identifierType.noChars) maxlength:$identifierType.noChars, #end #if($identifierType.type=='number') number:true #elseif($!identifierType.type=='letter') lettersonly:true #end }}" onchange='savePatientIdentifier( $identifierType.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex" /></td>
			</tr>
			#set( $tabIndex = $tabIndex + 1 )
			#set( $mark = !$mark  )
		#end

	<!-- ATTRIBUTES IN GROUPS -->
	#set( $mark = false )
	#foreach ($attributeGroup in $attributeGroups )
		<tr><td>&nbsp;</td></tr>	
		<tr><th colspan="2" class="heading-column">$attributeGroup.name</th></tr>
		#foreach($attribute in $attributeGroup.attributes)
			#if( $!attribute.program )
				#set( $attributeValue = $!patientAttributeValueMap.get( $attribute.id ) )
				<tr #alternate( $mark )>
					<td class='text-column'><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
					<td class="input-column" >
						#if( $attribute.valueType == "YES/NO" )
							<select id="attr$attribute.id" name="attr$attribute.id" onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >              
								<option value="">[$i18n.getString( "please_select" )]</option>
								<option value="true" #if( $attributeValue=='true') selected="selected" #end>$i18n.getString( "yes" )</option>
								<option value="false" #if( $attributeValue=='false') selected="selected" #end>$i18n.getString( "no" )</option>
							</select>                
						#elseif( $attribute.valueType == "DATE" )
							<input type="text" id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class=' #validate( "default"  $attribute.mandatory )'  onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
							<script type="text/javascript">
								datePickerValid( 'attr$attribute.id' );
							</script>                 
						#elseif( $attribute.valueType == "COMBO" )
							<select  id="attr$attribute.id" name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )' onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
								 <option value="">[$i18n.getString( "please_select" )]</option>
							#foreach ($option in $attribute.attributeOptions )
								<option value="$option.id" #if($attributeValue == $option.name) selected="selected" #end>$option.name</option>
							#end
							</select>
						#else 
							<input type="text"  id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class="{validate:{required:$attribute.mandatory #if($!attribute.noChars),maxlength:$attribute.noChars #end #if($attribute.valueType=='NUMBER'),number:true #end }}"  onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex" > 
						#end
					</td>		
				</tr>
			#end
			#set( $tabIndex = $tabIndex + 1 )
			#set( $mark = !$mark  )
		#end
	#end
	<tr><td>&nbsp;</td></tr>

	<!-- ATTRIBUTES NOT IN GROUPS -->

	#if ( $noGroupAttributes && $noGroupAttributes.size() > 0) 	
		<tr><th colspan="2" class="heading-column">$i18n.getString( "Other details" )</th></tr>
		#set( $mark = false )
		#foreach($attribute in $noGroupAttributes )
			#if( $attribute.program )
				#set( $attributeValue = $!patientAttributeValueMap.get( $attribute.id ) )
				<tr #alternate( $mark )>
					<td class='text-column'><label>$attribute.name #if($attribute.mandatory)<em title="$i18n.getString( "required" )" class="required">*</em> #end</label></td>
					<td class="input-column" >
						#if( $attribute.valueType == "YES/NO" )
							<select id="attr$attribute.id"  name="attr$attribute.id" onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex">              
								<option value="">[$i18n.getString( "please_select" )]</option>
								<option value="true" #if( $attributeValue ) selected="selected" #end>$i18n.getString( "yes" )</option>
								<option value="false" #if( !$attributeValue ) selected="selected" #end>$i18n.getString( "no" )</option>
							</select>                
						#elseif( $attribute.valueType == "DATE" )
							<input type="text" id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class=' #validate( "default"  $attribute.mandatory )' onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex">
							<script type="text/javascript">
								datePickerValid( 'attr$attribute.id' );
							</script>                    
						#elseif( $attribute.valueType == "COMBO" )
							<select  id="attr$attribute.id"  name="attr$attribute.id" class=' #validate( "default"  $attribute.mandatory )' onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex">
								 <option value="">[$i18n.getString( "please_select" )]</option>
							#foreach ($option in $attribute.attributeOptions )
								<option value="$option.id" #if($attributeValue == $option.name) selected="selected" #end>$option.name</option>
							#end
							</select>
						#else
							<input type="text"  id="attr$attribute.id" name="attr$attribute.id" value="$!attributeValue" class="{validate:{required:$attribute.mandatory #if($!attribute.noChars),maxlength:$attribute.noChars #end #if($attribute.valueType=='NUMBER'),number:true #end }}" onchange='savePatientAttrValue( $attribute.id, this);' onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
						#end
					</td>		
				</tr>
			#end
			#set( $tabIndex = $tabIndex + 1 )
			#set( $mark = !$mark  )
		#end
	#end
</table>
#end

<!-- Program-stage-instance list -->

#if( $programStageInstances.size() > 0 )
<h3>$i18n.getString('program_stage') <img src='../images/down.png' onclick='toogleDiv( "progarmStageListDiv" );'></h3>
	<table class='mainPageTable hidden' id='progarmStageListDiv' name='progarmStageListDiv' >
		<col id="noCol">
		<col id="stageCol">    
		<col id="entryCol">    
		<tr>
			<th>$i18n.getString( "nr" )</th>
			<th>$i18n.getString( "program_stage" )</th>                   
			<th>$i18n.getString( "due_date" )</th>        
		</tr>
		
	#set( $rowCount = 0 )
	#set( $mark = false )
	#set( $tabIndex = 1 )
	#foreach( $programStageInstance in $programStageInstances )
		#set( $rowCount = $rowCount + 1 )   
		<tr #alternate( $mark ) >
			##rowCount
			<td>$rowCount</td>        
			##stage name
			<td class='textColumn'>
				<span id="value[$programStageInstance.id].name" title="$!encoder.htmlEncode( $programStageInstance.programStage.description )">
					$encoder.htmlEncode( $programStageInstance.programStage.name )            
				</span>
			</td>        
				   
			##entry
			#set( $duedateId = "value_"+$programStageInstance.id+"_date" )        
			<td class='input-column '>        
				<input type="text" id="$duedateId" name="entryfield" value="$!format.formatDate( $programStageInstance.dueDate )" onchange="saveDueDate( $programStageInstance.id, '$encoder.jsEncode( $programStageInstance.programStage.name )' )" tabindex="$tabIndex" >
				<script type="text/javascript">
					datePicker( '$duedateId' );
				</script> 
			</td>      
		</tr>
		#set( $tabIndex = $tabIndex + 1 )
		#set( $mark = !$mark  )
	#end
	</table>
#end
<input type='submit' value='sfda' class='hidden'>
</form>

<script type="text/javascript">
	
	jQuery(document).ready(	function(){
		validation( 'programEnrollmentInforForm', function(form){
			return false;
		});	
	});
		
	byId('enrollBtn').value = i18n_update;
	setInnerHTML('enrollmentDateDescription', "$!program.dateOfEnrollmentDescription" );
	setInnerHTML('dateOfIncidentDescription', "$!program.dateOfIncidentDescription" );
	setFieldValue('enrollmentDate', "$!format.formatDate( $programInstance.enrollmentDate )" );
	setFieldValue('dateOfIncident', "$!format.formatDate( $programInstance.dateOfIncident )");
	
	if ( getFieldValue('enrollmentDate' ) == ''){	
		jQuery('#enrollBtn').attr( 'value',i18n_enroll_to_program );
	}else{
		jQuery('#enrollBtn').attr( 'value',i18n_update );
	}	
</script>

