<script>
	jQuery("#entryFormContainer").ready(function(){
		#if($!programStageInstance.programStage.program.type!='1')
			hideById('newEncounterBtn');
		#end
		#if($!programStageInstance.programStage.id)
			setFieldValue('programStageId', "$!programStageInstance.programStage.id");
		#end
		#if( $programStageInstance )
			setFieldValue( 'dueDate', "$!format.formatDate( $programStageInstance.dueDate )" );
			setFieldValue( 'executionDate', "$!format.formatDate( $programStageInstance.executionDate )" );
		#end
		
		$('#executionDate').change(function() {
				saveExecutionDate( getFieldValue('programId'), getFieldValue('executionDate') );
			});
		
		entryFormContainerOnReady();
	});
</script>

<div id='entryFormContainer'>

<input type='hidden' id='incidentDate' value='$!format.formatDate($programStageInstance.programInstance.dateOfIncident)'>
<input type='hidden' name='programStageInstanceId' id='programStageInstanceId' value='$!programStageInstance.id'>
<input type='hidden' name='programInstanceId' id='programInstanceId' value='$!programStageInstance.programInstance.id'>
<input type='hidden' name='irregular' id='irregular' value='$!programStageInstance.programStage.irregular'>
<input type='hidden' name='completed' id='completed' value='$!programStageInstance.completed'>
<input type='hidden' name='programStageId' id='programStageId' value='$!programStageInstance.programStage.id'>


<table class="mainPageTable" id='patientInfoDiv' class='hidden'> 
	<tr>
		<td valign="top">
	<table>
		<tr>            
			<td class="bold">$i18n.getString( "full_name" ):</td>
			<td>$encoder.htmlEncode( $programStageInstance.programInstance.patient.getFullName() )<td>
		</tr>
		<tr>
			<td class="bold">$i18n.getString( "gender" ):</td>
			<td>$i18n.getString("$programStageInstance.programInstance.patient.gender")</td>
		</tr>
		<tr>
			<td class="bold">$i18n.getString( "date_of_birth" ):</td>
			<td>$format.formatDate( $programStageInstance.programInstance.patient.birthDate ) $programStageInstance.programInstance.patient.getAge()<td>
		</tr>
		</table>
	</tr>
</table>

<table id='executionDateTB' class='hidden'>
	<tr>
		<th class='text-column'><label for="executionDate">$i18n.getString( "report_date" ) </label></th>
		<th><input type="text" id="executionDate" name="executionDate" class='criteria' value="$!format.formatDate( $programStageInstance.executionDate )" >
			<script type="text/javascript">
			   datePickerValid( 'executionDate', false );
			</script>
		</th>
		<th class='text-column'><label for="dueDate">$i18n.getString( "due_date" ) </label></th>
		<th><input type="text" id="dueDate" name="dueDate" class='criteria' value="$!format.formatDate( $programStageInstance.dueDate )" readonly > </th>
	</tr>
</table>

<div id='entryForm' #if($!programStageInstance.executionDate) class='visible' #else class='hidden' #end>					
	#if( $customDataEntryFormCode )
		#parse( "/dhis-web-caseentry/customDataEntryForm.vm" )
	#elseif( $sections )
		#parse( "/dhis-web-caseentry/sectionDataEntryForm.vm" )
	#else
		#parse( "/dhis-web-caseentry/defaultDataEntryForm.vm" )
	#end
</div>

<div id='inputCriteriaDiv' class="page inputCriteria" style="display:none;width:490px;height:29px;">	
	<input type="button" class='button' id="completeBtn" value="$i18n.getString('complete')" onClick="doComplete()" disabled="disabled">
	<input type="button" id="uncompleteBtn" value="$i18n.getString('incomplete')" onclick="doUnComplete()" disabled="disabled">
	<input type="button" class='button' id="validationBtn" value="$i18n.getString('run_validation')" onClick="javascript: runValidation();" disabled="disabled">
</div>

</div>

<div id='validateProgramDiv'></div>

<script>
	var i18n_create_new_event = '$encoder.jsEscape( $i18n.getString( "create_new_event" ) , "'" )';
</script>

