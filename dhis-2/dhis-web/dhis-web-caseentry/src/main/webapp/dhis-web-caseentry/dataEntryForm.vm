<script>
	jQuery("#entryFormContainer").ready(function(){
		setFieldValue('programStageId', "$!programStageInstance.programStage.id");
		setFieldValue('programId', "$!programStageInstance.programStage.program.id");
		#if( $!programStageInstance.programStage.program.type=="3" && $!programStageInstance.completed=='true')
			hideById('entryFormContainer');
		#elseif( $programStageInstance )
			setFieldValue( 'dueDate', "$!format.formatDate( $programStageInstance.dueDate )" );
			setFieldValue( 'executionDate', "$!format.formatDate( $programStageInstance.executionDate )" );
		#end
		
		$('#executionDate').change(function() {
				saveExecutionDate( getFieldValue('programId'), getFieldValue('executionDate') );
			});
		
		entryFormContainerOnReady();
	});
</script>

<div id='entryFormContainer'>

<input type='hidden' id='incidentDate' value='$!format.formatDate($programStageInstance.programInstance.dateOfIncident)'>
<input type='hidden' name='programStageInstanceId' id='programStageInstanceId' value='$!programStageInstance.id'>
<input type='hidden' name='programInstanceId' id='programInstanceId' value='$!programStageInstance.programInstance.id'>
<input type='hidden' name='irregular' id='irregular' value='$!programStageInstance.programStage.irregular'>
<input type='hidden' name='completed' id='completed' value='$!programStageInstance.completed'>

<div id='entryForm' #if($!programStageInstance.executionDate) class='visible' #else class='hidden' #end>
	#if( $customDataEntryFormCode )
		<div id="customEntryScreenContainer">
		   $customDataEntryFormCode

			<script type="text/javascript"> 
				#if( $!programStageInstance.programStage.program.displayProvidedOtherFacility == 'true' )
					initCustomCheckboxes();
				#end
			</script>
		</div>
	#else
		<table id="defaultEntryScreenContainer" class='entryScreen formSection'>
			<col id="deCol">    
			<col id="entryCol">
			<tr>
				<th>$i18n.getString( "data_element" )</th>                   
				<th>$i18n.getString( "entry" )</th>
				<th>$i18n.getString( "provided_elsewhere" )</th>
			</tr>
		#set( $dataElementRowCount = 0 )
		#set( $mark = true )
		#set( $tabIndex = 1 )
		#foreach( $programStageDataElement in $programStageDataElements )
			#set( $dataElementRowCount = $dataElementRowCount + 1 )    
			#set( $mark = !$mark )
			#set( $patientDataValue = false )
			#set( $key = $programStageDataElement.dataElement.id )
			#set( $patientDataValue = $patientDataValueMap.get( $key ) )    
			<tr #alternate( $mark )>
				##data element name
				<td class='text-column'>
					<span id="value[$programStageDataElement.dataElement.id].name" title="$!encoder.htmlEncode( $programStageDataElement.dataElement.description )">
						$encoder.htmlEncode( $programStageDataElement.dataElement.formNameFallback )						
						#if ( $programStageDataElement.compulsory )
							<em title="$i18n.getString( "required" )" class="required">*</em>
						#end        
					</span>
					##type        
					<span id="value[$programStageDataElement.dataElement.id].type" class="hidden">$encoder.htmlEncode( $programStageDataElement.dataElement.type )</span></td>       
				</td>        
				##entry        
				<td class='input-column'>   
					#set( $id = $programStageDataElement.programStage.id + '-' + $programStageDataElement.dataElement.id + '-val' )
					#if( $!programStageDataElement.dataElement.optionSet )
						#set( $optionId = $id + '-options')
						<input style='width: 250px;' type='text' class='optionset' name="entryselect" options='$programStageDataElement.dataElement.optionSet.options' id='$id' value='$!patientDataValue.value' data="{compulsory: $programStageDataElement.compulsory, deName:'$programStageDataElement.dataElement.name', deType:'$programStageDataElement.dataElement.getDetailedNumberType()' }" id="$id-options" dataElementId="$programStageDataElement.dataElement.id" onkeypress="return keyPress(event, this)" tabindex="$tabIndex" />
					#elseif( $programStageDataElement.dataElement.type == "bool" )
						<select style='width: 256px;' name="entryselect" data="{compulsory: $programStageDataElement.compulsory }" id="$id" onchange="saveOpt( $programStageDataElement.dataElement.id )" tabindex="$tabIndex">
							<option value="">[$i18n.getString( "select_value" )]</option>
							<option value="true" #if( $patientDataValue.value == "true" ) selected="selected" #end>$i18n.getString( "yes" )</option>
							<option value="false" #if( $patientDataValue.value == "false" ) selected="selected" #end>$i18n.getString( "no" )</option>
						</select> 
					#elseif( $programStageDataElement.dataElement.type == "date" )
						<input style='width: 250px;' type="text" data="{compulsory: $programStageDataElement.compulsory }" id="$id" name="entryfield" value="$!encoder.htmlEncode( $patientDataValue.value )" onchange="saveVal( $programStageDataElement.dataElement.id )" onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
						<script type="text/javascript">
							datePicker($programStageDataElement.programStage.id + '-' + $programStageDataElement.dataElement.id + '-val', false);
						</script> 
					#else
						<input name="entryfield" data="{compulsory: $programStageDataElement.compulsory, deName:'$programStageDataElement.dataElement.name', deType:'$programStageDataElement.dataElement.getDetailedNumberType()' }" id="$id" type="text" value="$!encoder.htmlEncode( $patientDataValue.value )" onchange="saveVal( $programStageDataElement.dataElement.id )" onkeypress="return keyPress(event, this)" tabindex="$tabIndex">
					#end
				</td> 

				<td style='width: 50px;' align='center'>
					#set( $id = $programStageDataElement.programStage.id + '_' + $programStageDataElement.dataElement.id + '_facility' )
					#if( $programStageDataElement.allowProvidedElsewhere == 'true')
						<input style='width: 250px;' name="$id" id="$id" type="checkbox"
							onclick="updateProvidingFacility( $programStageDataElement.dataElement.id, this )" 
							#if($patientDataValue.providedElsewhere == 'true') checked #end />
					#end
				</td>
			</tr>
		#end				
		#set( $tabIndex = $tabIndex + 1 )
		</table>
	#end
</div>

<div id='inputCriteriaDiv' class="page inputCriteria" style="display:none;width:480px;height:29px;">	
	<input type="button" class='button' id="completeInBelowBtn" value="$i18n.getString('complete')" onClick="doComplete()" disabled="disabled">
	<input type="button" class='button' id="validationInBelowBtn" value="$i18n.getString('run_validation')" onClick="javascript: runValidation();" >
</div>

</div>

<div id='validateProgramDiv'></div>
