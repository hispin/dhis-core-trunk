<script>
jQuery("#entryFormContainer").ready(function(){
    entryFormContainerOnReady();
});
</script>

<div id='entryFormContainer'>
<p align='right'>
	<label for="label2">$i18n.getString( "due_date" ) </label>
	<input type="text" id="dueDate" name="dueDate" value="$!format.formatDate( $programStageInstance.dueDate )" disabled="disabled"/>
	&nbsp;&nbsp;&nbsp;
	<label for="label">$i18n.getString( "report_date" ) </label>
	<input type="text" id="executionDate" name="executionDate" value="$!format.formatDate( $programStageInstance.executionDate )" onChange="saveExecutionDate( getFieldValue('programStageInstanceId'), getFieldValue('programStageInstanceName') );" />
		<script type="text/javascript">
			datePickerValid('executionDate', false);
		</script>
</p>

<input type='hidden' id='programStageInstanceId' value='$programStageInstance.id'>
<input type='hidden' id='programStageInstanceName' value='$programStageInstance.name'>
<input type='hidden' id='incidentDate' value='$!format.formatDate($programStageInstance.programInstance.dateOfIncident)'>
<input type='hidden' id='orgunitId' value='$organisationUnit.id'>
	
<hr style="clear:both">

<span id="startMsg" style="font-style:italic; color:blue; display: #if($programStageInstance.executionDate) none #else block #end">$i18n.getString( "report_date_warning" )</span>

<div id='entryForm' style="display: #if($programStageInstance.executionDate) block #else none #end">
	
	<div id="customEntryScreenContainer">
		#if( $customDataEntryFormCode ) 
			<div id="dragDiv">
				<table id="listInfo">
					<tr><td style="text-align:left"><strong>$i18n.getString("org_unit_name") :</strong></td> <td id="orgUnitNameField" style="text-align:right"></td></tr>
					<tr><td style="text-align:left"><strong>$i18n.getString("program_stage_name") :</strong></td> <td  id="programStageName" style="text-align:right">$programStageInstance.programStage.name</td></tr>
					<tr><td style="text-align:left"><strong>$i18n.getString("datae_element_name") :</strong></td> <td id="dataelementName" style="text-align:right"></td></tr>
				</table>
			</div>
		   $customDataEntryFormCode
		#else 
			<span style="font-style:italic; color:blue"> $i18n.getString( "no_custom_data_entry_exist" )</span>
		#end
	</div>

	<div id="defaultEntryScreenContainer" style='display:none;'>
		<table class="mainPageTable">
			<col id="noCol">
			<col id="deCol">    
			<col id="entryCol">
			<col id="facilityCol">       
			<tr>
				<th>$i18n.getString( "nr" )</th>
				<th>$i18n.getString( "data_element" )</th>                   
				<th>$i18n.getString( "entry" )</th>
				<th>$i18n.getString( "facility_provided_data" )</th>             
			</tr>
			#set( $dataElementRowCount = 0 )
			#set( $mark = 0 )
			#set( $tabIndex = 1 )
			#foreach( $programStageDataElement in $programStageDataElements )
				#set( $dataElementRowCount = $dataElementRowCount + 1 )    
				#if( $mark == 1 )
					#set( $mark = 0 )
				#else
					#set( $mark = 1 )
				#end    
				#set( $patientDataValue = false )
				#set( $patientDataValue = $patientDataValueMap.get( $programStageDataElement.dataElement.id ) )    
				<tr #if( $mark == 0 ) style="background-color:#dddddd" #end>
					##dataElementRowCount
					<td style="text-align:right">$dataElementRowCount</td>        
					##data element name
					<td>
						<span id="value[$programStageDataElement.dataElement.id].name" title="$!encoder.htmlEncode( $programStageDataElement.dataElement.description )">
							$encoder.htmlEncode( $programStageDataElement.dataElement.name ) 
							#if ( $programStageDataElement.compulsory )
								<em title="$i18n.getString( "required" )" class="required">*</em>
							#end        
						</span>
					</td>        
					##type        
					<td style="display:none"><span id="value[$programStageDataElement.dataElement.id].type" style="display:none">$encoder.htmlEncode( $programStageDataElement.dataElement.getDetailedNumberType() )</span></td>       
					##entry        
					<td>        
						#if( $programStageDataElement.dataElement.type == "bool" )
							<select name="entryselect" #if($programStageInstance.completed) disabled="disabled" #end data="{compulsory: $programStageDataElement.compulsory }" id="value[$programStageDataElement.dataElement.id].boolean" onchange="saveChoice( $programStageDataElement.dataElement.id, this )"  tabindex="$tabIndex">              
								<option value="">[$i18n.getString( "select_value" )]</option>
								<option value="true" #if( $patientDataValue.value == "true" ) selected="selected" #end>$i18n.getString( "yes" )</option>
								<option value="false" #if( $patientDataValue.value == "false" ) selected="selected" #end>$i18n.getString( "no" )</option>
							</select>                              
						#elseif( $programStageDataElement.dataElement.type == "string" && $programStageDataElement.dataElement.isMultiDimensional() )
							#set( $optionValues = $optionMap.get( $programStageDataElement.dataElement.id ) )
							<select name="entryselect" data="{compulsory: $programStageDataElement.compulsory }" #if($programStageInstance.completed) disabled="disabled" #end id="value[$programStageDataElement.dataElement.id].value" onchange="saveChoice( $programStageDataElement.dataElement.id, this )" tabindex="$tabIndex">              
								<option value="">[$i18n.getString( "no_value" )]</option>
								#foreach( $optionValue in $optionValues )
									<option value="$optionValue.id" #if( $patientDataValue.value == $optionValue.id ) selected="selected" #end>$encoder.htmlEncode( $optionValue.name )</option>
								#end
							</select>
						#elseif( $programStageDataElement.dataElement.type == "date" ) 
							<input type="text" data="{compulsory: $programStageDataElement.compulsory }" #if($programStageInstance.completed) disabled="disabled" #end id="value[$programStageDataElement.dataElement.id].date" name="entryfield" value="$!encoder.htmlEncode($patientDataValue.value)" onchange="saveDateValue( $programStageDataElement.dataElement.id, '$encoder.jsEncode( $programStageDataElement.dataElement.name )' )" tabindex="$tabIndex" >
								<script type="text/javascript">
									datePicker('value\\[$programStageDataElement.dataElement.id\\]\\.date', false);
								</script>  					
						#else
							<input name="entryfield" data="{compulsory: $programStageDataElement.compulsory }" #if($programStageInstance.completed) disabled="disabled" #end id="value[$programStageDataElement.dataElement.id].value" type="text" value="$!encoder.htmlEncode( $patientDataValue.value )" onchange="saveValue( $programStageDataElement.dataElement.id, '$encoder.jsEncode( $programStageDataElement.dataElement.name )' )" onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
						#end
					</td>   
					##providedByAnotherFacility                
					<td>     
						#if ( $patientDataValue.value )        
							#if( !$patientDataValue.providedByAnotherFacility )
								$patientDataValue.organisationUnit.name
								<input name="providedByAnotherFacility" id="value[$programStageDataElement.dataElement.id].providedByAnotherFacility" type="hidden" onclick="updateProvidingFacility( $programStageDataElement.dataElement.id, this )">
							#else
								$i18n.getString("other_facility")
								<input name="providedByAnotherFacility" id="value[$programStageDataElement.dataElement.id].providedByAnotherFacility" type="hidden" onclick="updateProvidingFacility( $programStageDataElement.dataElement.id, this )">
							#end
						 #else
							<input name="providedByAnotherFacility" id="value[$programStageDataElement.dataElement.id].providedByAnotherFacility" type="checkbox" onclick="updateProvidingFacility( $programStageDataElement.dataElement.id, this )">
						 #end                         
					</td>    
				</tr>
				#set( $tabIndex = $tabIndex + 1 )
			#end
		</table>

	</div>
</div>

</div>
<script type="text/javascript"> 
	initCustomCheckboxes();
	DRAG_DIV.init();
</script>