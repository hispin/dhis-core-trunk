<script>
	jQuery("#entryFormContainer").ready(function(){
	
		#if( $programStageInstance )
			setFieldValue( 'dueDate', "$!format.formatDate( $programStageInstance.dueDate )" );
			setFieldValue( 'executionDate', "$!format.formatDate( $programStageInstance.executionDate )" );
		#elseif( $program.singleEvent == "true" )
		{
			disable("dueDate");
		}
		#end
		
		$('#executionDate').change(function() {
			saveExecutionDate( getFieldValue('programStageId'), getFieldValue('executionDate') );
		});
			
		entryFormContainerOnReady();
	});
</script>

<div id='entryFormContainer'>
<input type='hidden' id='incidentDate' value='$!format.formatDate($programStageInstance.programInstance.dateOfIncident)'>
<input type='hidden' name='programStageInstanceId' id='programStageInstanceId' value='$!programStageInstance.id'>
<hr style="clear:both">

<span id="startMsg" style="font-style:italic; color:blue; display: #if($!programStageInstance.executionDate!='') none #else block #end;">$i18n.getString( "report_date_warning" )</span>

<div id='entryForm' style="display: #if($!programStageInstance.executionDate) block #else none #end;">
	#if( $customDataEntryFormCode )
		<div id="customEntryScreenContainer">
			<div id="dragDiv">
				<table id="listInfo">
					<tr><td style="text-align:left" class="bold">$i18n.getString("org_unit_name") :</td> <td id="orgUnitNameField" style="text-align:right"></td></tr>
					<tr><td style="text-align:left" class="bold">$i18n.getString("program_stage_name") :</td> <td  id="programStageName" style="text-align:right">$programStageInstance.programStage.name</td></tr>
					<tr><td style="text-align:left" class="bold">$i18n.getString("datae_element_name") :</td> <td id="dataelementName" style="text-align:right"></td></tr>
				</table>
			</div>
		   $customDataEntryFormCode

			<script type="text/javascript"> 
				initCustomCheckboxes();
				DRAG_DIV.init();
			</script>
		</div>
	#else
		<div id="defaultEntryScreenContainer" >

			<table class="mainPageTable">
				<col id="noCol">
				<col id="deCol">    
				<col id="entryCol">
				<col id="facilityCol">       
				<tr>
					<th>$i18n.getString( "nr" )</th>
					<th>$i18n.getString( "data_element" )</th>                   
					<th>$i18n.getString( "entry" )</th>
					<th>$i18n.getString( "facility_provided_data" )</th>             
				</tr>
			#set( $dataElementRowCount = 0 )
			#set( $mark = 0 )
			#set( $tabIndex = 1 )
			#foreach( $programStageDataElement in $programStageDataElements )
				#set( $dataElementRowCount = $dataElementRowCount + 1 )    
				#if( $mark == 1 )
					#set( $mark = 0 )
				#else
					#set( $mark = 1 )
				#end    
				#set( $patientDataValue = false )
				#set( $patientDataValue = $patientDataValueMap.get( $programStageDataElement.dataElement.id ) )    
				<tr #if( $mark == 0 ) style="background-color:#dddddd" #end>
					##dataElementRowCount
					<td style="text-align:right">$dataElementRowCount</td>        
					##data element name
					<td>
						<span id="value[$programStageDataElement.dataElement.id].name" title="$!encoder.htmlEncode( $programStageDataElement.dataElement.description )">
							$encoder.htmlEncode( $programStageDataElement.dataElement.name ) 
							#if ( $programStageDataElement.compulsory )
								<em title="$i18n.getString( "required" )" class="required">*</em>
							#end        
						</span>
					</td>        
					##type        
					<td style="display:none"><span id="value[$programStageDataElement.dataElement.id].type" style="display:none">$encoder.htmlEncode( $programStageDataElement.dataElement.type )</span></td>       
					##entry        
					<td>   
						#set( $id = $programStageDataElement.programStage.id + '-' + $programStageDataElement.dataElement.id + '-val' )
						#if( $programStageDataElement.dataElement.type == "bool" )
							<select name="entryselect" #if($programStageInstance.completed) disabled="disabled" #end data="{compulsory: $programStageDataElement.compulsory }" id="$id" onchange="saveOpt( $programStageDataElement.dataElement.id )"  tabindex="$tabIndex">              
								<option value="">[$i18n.getString( "select_value" )]</option>
								<option value="true" #if( $patientDataValue.value == "true" ) selected="selected" #end>$i18n.getString( "yes" )</option>
								<option value="false" #if( $patientDataValue.value == "false" ) selected="selected" #end>$i18n.getString( "no" )</option>
							</select>                              
						#elseif( $programStageDataElement.dataElement.type == "string" && $programStageDataElement.dataElement.isMultiDimensional() )
							#set( $optionValues = $optionMap.get( $programStageDataElement.dataElement.id ) )
							<select name="entryselect" data="{compulsory: $programStageDataElement.compulsory }" #if($programStageInstance.completed) disabled="disabled" #end id="$id" onchange="saveOpt( $programStageDataElement.dataElement.id )" tabindex="$tabIndex">              
								<option value="">[$i18n.getString( "no_value" )]</option>
								#foreach( $optionValue in $optionValues )
									<option value="$optionValue.id" #if( $patientDataValue.value == $optionValue.id ) selected="selected" #end>$encoder.htmlEncode( $optionValue.name )</option>
								#end
							</select>
						#elseif( $programStageDataElement.dataElement.type == "date" )
							<input type="text" data="{compulsory: $programStageDataElement.compulsory }" #if($programStageInstance.completed) disabled="disabled" #end id="$id" name="entryfield" value="$!encoder.htmlEncode( $patientDataValue.value )" onchange="saveDate( $programStageDataElement.dataElement.id )" onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
							<script type="text/javascript">
								datePicker($programStageDataElement.programStage.id + '-' + $programStageDataElement.dataElement.id + '-val', false);
							</script>                     
						#else
							#foreach( $optionCombo in $programStageDataElement.dataElement.categoryCombo.optionCombos )
								#set( $id = $programStageDataElement.programStage.id + '-' + $programStageDataElement.dataElement.id + '-' + $optionCombo.id + '-val' )
								<input name="entryfield" data="{compulsory: $programStageDataElement.compulsory, deName:'$programStageDataElement.dataElement.name', deType:'$programStageDataElement.dataElement.getDetailedNumberType()' }" #if($programStageInstance.completed) disabled="disabled" #end id="$id" type="text" value="$!encoder.htmlEncode( $patientDataValue.value )" onchange="saveVal( $programStageDataElement.dataElement.id, $optionCombo.id )" onkeypress="return keyPress(event, this)" tabindex="$tabIndex" >
							#end
						#end
					</td>   
					##providedByAnotherFacility                
					<td>   
						#set( $id = $programStageDataElement.programStage.id + '_' + $programStageDataElement.dataElement.id + '_facility' )
						#if ( $patientDataValue.value )        
							#if( !$patientDataValue.providedByAnotherFacility )
								$patientDataValue.organisationUnit.name
								<input  name="providedByAnotherFacility" id="$id" type="hidden" onclick="updateProvidingFacility( $programStageDataElement.dataElement.id, this )">
							#else
								$i18n.getString("other_facility")
								<input  name="providedByAnotherFacility" id="$id" type="hidden" onclick="updateProvidingFacility( $programStageDataElement.dataElement.id, this )">
							#end
						 #else
							<input name="providedByAnotherFacility" id="$id" type="checkbox" onclick="updateProvidingFacility( $programStageDataElement.dataElement.id, this )">
						 #end                         
					</td>    
				</tr>
				#set( $tabIndex = $tabIndex + 1 )
			#end
			</table>
		</div>
	#end
</div>

</div>

<div id='validateProgramDiv'></div>
