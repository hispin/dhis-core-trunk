<br/>
<table id='programStageIdTB_$!programInstance.id' style="width:850px;height:125px;">
	<tr>
		<td>
			<div class="arrow-left" onclick="moveLeft('flow_$!programInstance.id')">&nbsp;</div>
		</td>
		<td>
			<div id='flow_$!programInstance.id' class="stage-flow">
				<table class="stage-flow">											
					<tr id='programStageIdTR_$!programInstance.id'>
						#foreach( $programStageInstance in $programInstance.programStageInstances )
						<td width="5px">
							<img src='images/rightarrow.png'>
						</td>
						<td>
							<input type="button" name="programStageBtn"
								id="ps_$!programStageInstance.id"
								psid="$programStageInstance.programStage.id"
								psname="$programStageName.programStage.name"
								programType='$programInstance.program.type'
								dueDate="$format.formatDate( $programStageInstance.dueDate )"
								class="stage-object" 
								value="$programStageInstance.programStage.name $format.formatDate( $programStageInstance.dueDate )" 
								onclick="javascript:loadDataEntry( $programStageInstance.id );">
							<script>	
								var status = $statusMap.get( $programStageInstance.id ); 
								setEventColorStatus( 'ps_' + $programStageInstance.id ,status);
							</script>
						</td>
						#end
					</tr>
				</table>
			</div>
		</td>
		<td>
			<div class="arrow-right" onclick="moveRight('flow_$!programInstance.id')">&nbsp;</div>
		</td>
		<td>&nbsp;</td>
		<td>
			<input type="button" class='stage-object' id="newEncounterBtn_$!programInstance.id" name="newEncounterBtn" value="$i18n.getString('create_new_event')" onClick="javascript:showCreateNewEvent('$!programInstance.id');" >
		</td>
	</tr>			
</table>

<div id='createNewEncounterDiv_$!programInstance.id' class='hidden'>
	<table>
		<tr>
			<td>$i18n.getString( 'program_stage' )</td>
			<td>
				<select id='repeatableProgramStageId' name='repeatableProgramStageId' onchange="setSuggestedDueDate('$programInstance.id')">
					#foreach( $programStage in $programInstance.program.programStages )
						#if( $programStage.irregular=='true')
							<option value="$programStage.id" standardInterval='$programStage.standardInterval'>$!programStage.name</option>
						#end
					#end
				</select>
			</td>
		</tr>
		<tr>
			<td>$i18n.getString( 'due_date' )</td>
			<td><input id='dueDateNewEncounter_$programInstance.id' name='dueDateNewEncounter_$!programInstance.id' style='width:260px;'></td>
			<script type="text/javascript">
			   datePicker( 'dueDateNewEncounter_$programInstance.id', false );
			</script>
		</tr>
		<tr>
			<td></td>
			<td>
				<input type='button' value='$i18n.getString("create")' onclick='registerIrregularEncounter( "$!programInstance.id",getFieldValue("repeatableProgramStageId"), jQuery("#repeatableProgramStageId option:selected").text(),getFieldValue("dueDateNewEncounter_$programInstance.id" ) );' />
				<input type='button' value='$i18n.getString("cancel")' onclick="closeDueDateDiv('$!programInstance.id');" />
			</td>
		</tr>
		</tr>
		<tr>
			<td></td>
			<td id='createEventMessage_$!programInstance.id' style='color:green'></td>
		</tr>
	</table>
</div>

<script>
	var i18n_create_event_success = '$encoder.jsEscape( $i18n.getString( "create_event_success" ) , "'" )';
	var options = jQuery("#createNewEncounterDiv_$!programInstance.id [id=repeatableProgramStageId] option").length;
	if( options==0 )
		jQuery("[name=newEncounterBtn]").addClass("hidden");
</script>


