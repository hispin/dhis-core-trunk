<div>
    <input type="button" value="$i18n.getString( "back_to_search" )" onclick="onClickBackBtn();" style="width:10em">
</div>

<h3>$i18n.getString( "relationship_management" )</h3>

<input type="hidden" id="id" name="id" value="$patient.id">
<div id="selectedPatientContainer" style="border:1px solid #808080; padding:10px;">
    <table class="mainPageTable">                           
        <tr>              
            <td>
                <span class="bold">$i18n.getString( "full_name" ):</span>$encoder.htmlEncode( $patient.getFullName() )<br>
                <span class="bold">$i18n.getString( "gender" ):</span>$i18n.getString( $patient.gender )<br>
                <span class="bold">$i18n.getString( "date_of_birth" ):</span>$format.formatDate( $patient.birthDate )<br>
                <span class="bold">$i18n.getString( "age" ):</span>$encoder.htmlEncode( $patient.getAge() )
            </td>               
            <td style="vertical-align:top">
                <div style="float:right">
                    #foreach( $patientAttributeValue in $patientAttributeValues )
                        <span class="bold">$encoder.htmlEncode( $patientAttributeValue.patientAttribute.name ):</span>$encoder.htmlEncode( $patientAttributeValue.value )<br>
                    #end                         
                </div>
            </td>   
        </tr>                              
    </table>
</div>

<table class="mainPageTable">
    <tr>
        <td style="vertical-align:top">
            <table class="listTable">
                <col>
                <col>
                <col width="20">           
                  
                <tr>
                    <td></td> 
                    <td style="text-align:right">
                        <input type="button" value="$i18n.getString( 'add_new' )" onclick="javascript:showAddRelationship('$patient.id')">                                                              
                    </td>
                    <td style="text-align:right">
                        <input type="button" value="$i18n.getString( 'add_new_patient' )" onclick="javascript:showAddRelationshipPatient( '$patient.id',false )">                                                              
                    </td>
                </tr>
          
                <tr>            
                    <th>$i18n.getString( "relationship" )</th>
                    <th>$i18n.getString( "full_name" )</th>
                    <th style="text-align:center">$i18n.getString( "operations" )</th>
                </tr>
                <tbody id="list"> 
					#set( $mark = false )
                    #foreach( $relationship in $relationships )
                        <tr id="tr${relationship.id}" #alternate( $mark ) >
                            #set( $partnerId = false )    
                            #if( $relationship.patientA.id == $patient.id )
                                #set( $partnerId = $relationship.patientB.id )
                                <td>                                
                                    $encoder.htmlEncode( $relationship.relationshipType.BIsToA )
                                </td>
                                            
                                <td>
                                    $encoder.htmlEncode( $relationship.patientB.getFullName() )
                                </td>
                            #elseif($relationship.patientB.id == $patient.id )
                                #set( $partnerId = $relationship.patientA.id )
                                <td>                                
                                    $encoder.htmlEncode( $relationship.relationshipType.AIsToB )
                                </td>
                                            
                                <td>
                                    $encoder.htmlEncode( $relationship.patientA.getFullName() )
                                </td>
                            #end                  
                            
                            <td style="text-align:center">
                                <a href="javascript:manageRepresentative( '$patient.id', $partnerId )" title="$i18n.getString( 'manage_representative' )"><img src="../images/assign.png" alt="$i18n.getString( 'manage_representative' )"></a>
                                <a href="javascript:removeRelationship( '$relationship.id', '$encoder.jsEncode( $relationship.patientA.getFullName() )', '$encoder.jsEncode( $relationship.relationshipType.aIsToB )', '$encoder.jsEncode( $relationship.patientB.getFullName() )' )" title="$i18n.getString( 'remove' )"><img src="../images/delete.png" alt="$i18n.getString( 'remove' )"></a>
                            </td>   						
                        </tr>
						#set( $mark = !$mark)
                    #end
                </tbody>
            </table>
        </td> 
    </tr>         
</table>

<div id="detailsArea" style="display:none; width:100%; padding-left:2em; vertical-align:top">
	<table>
		<tr>
			<td>
				<div style="float:right">
					<a href="javascript:hideDetails()" title="$i18n.getString( 'hide_details' )"><img src="../images/close.png" alt="$i18n.getString( 'hide_details' )"></a>
				</div>	                     
			</td>
			<td>
                <span class="bold">$i18n.getString( "full_name" ):</span><span id="fullNameField"></span><br>
                <span class="bold">$i18n.getString( "gender" ):</span><span id="genderField"></span><br>
                <span class="bold">$i18n.getString( "date_of_birth" ):</span><span id="dateOfBirthField"></span><br>
                <span class="bold">$i18n.getString( "age" ):</span><span id="ageField"></span>
            </td>   
            <td style="vertical-align:top">
                <div style="float:right">                              
                    <p><span class="bold">$i18n.getString( "attributes" ):</span><br><span id="attributeField"></span></p>                                         
                </div>
            </td>    
        </tr>
        <tr>
            <td style="text-align:left">
                <span id="buttonFirstField"></span>
            </td>
            <td style="text-align:right">
                <span id="buttonSecondField"></span>
            </td>    
        </tr>                      
    </table>

</div>

<script type="text/javascript">
    var i18n_confirm_delete_relationship = '$encoder.jsEscape( $i18n.getString( "confirm_delete_relationship" ) , "'" )';
    var i18n_please_select_a_representative = '$encoder.jsEscape( $i18n.getString( "please_select_a_representative" ) , "'" )';
    var i18n_saving_representative_failed = '$encoder.jsEscape( $i18n.getString( "saving_representative_failed" ) , "'" )';
    var i18n_removing_representative_failed = '$encoder.jsEscape( $i18n.getString( "removing_representative_failed" ) , "'" )';
    var i18n_removing_relationship_failed = '$encoder.jsEscape( $i18n.getString( "removing_relationship_failed" ) , "'" )';        
    var i18n_adding_relationship_failed = '$encoder.jsEscape( $i18n.getString( "adding_relationship_failed" ) , "'" )';
	var i18n_relationship_management = '$encoder.jsEscape( $i18n.getString( "relationship_management" ) , "'" )';
</script>

