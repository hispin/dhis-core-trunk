
#if ( $!reportParams.isSet() )
    <h3>$i18n.getString( "report_table_parameters" )</h3>
#end

<input type="hidden" id="id" name="id" value="$!id">
<input type="hidden" id="mode" name="mode" value="$!mode">

#if ( $mode == "status" ) <!-- Keep the process running and show status -->
	<script type="text/javascript">
	   getTableStatus();
	</script>
#end

#if ( $mode == "table" && $!reportParams.isSet() == false ) <!-- Create table, nothing to ask -->
	<script type="text/javascript">
		createTable( '$id' );
	</script>
#end

<table>
	
	<!-- Data source -->
	
	#if ( $mode == "report" )
	
    <tr>
        <th>$i18n.getString( "data_source" )</th>
    </tr>
    <tr>
    	<td>
			<select id="doDataMart" name="doDataMart" style="width:325px">
				<option value="true">$i18n.getString( "aggregate_data" )</a>
				<option value="false">$i18n.getString( "use_existing_data" )</a>
			</select>
		</td>
	</tr>
    <tr>
        <td colspan="4" style="height:10px"></td>
    </tr>
	
	#end
	
    <!-- Reporting month -->
    
    #if ( $!reportParams.isParamReportingMonth() )
    
    <tr>
        <th>$i18n.getString( "reporting_month" )</th>
    </tr>
    <tr>
        <td>
            <select id="reportingPeriod" name="reportingPeriod" style="width:325px">               
                #foreach ( $key in $reportingPeriods.keySet() )
                    <option value="$key">$reportingPeriods.get( $key )</option>
                #end
            </select>
        </td>
    </tr>
    <tr>
        <td colspan="4" style="height:10px"></td>
    </tr>
    
    #end
    
    <!-- Parent OrganisationUnit -->
    
    #if ( $!reportParams.isParamParentOrganisationUnit() )
    
    <tr>
        <th>$i18n.getString( "parent_organisationunit" )</th>
    </tr>
    <td>
		<div id="selectionTree" style="width:325px; height:270px"></div>	            
		<script type="text/javascript">
			selectionTreeSelection.setMultipleSelectionAllowed( false );
			selectionTreeSelection.setListenerFunction( paramParentOrganisationUnitSet );
			selectionTree.clearSelectedOrganisationUnits();
		    selectionTree.buildSelectionTree();
		</script>
    </td>
    <tr>
        <td colspan="4" style="height:10px"></td>
    </tr>
    
    #end
    
    <!-- OrganisationUnit -->
    
    #if ( $!reportParams.isParamOrganisationUnit() )
    
	<tr>
        <th>$i18n.getString( "organisation_unit" )</th>
    </tr>
    <td>
		<div id="selectionTree" style="width:325px; height:270px"></div>	            
		<script type="text/javascript">
			selectionTreeSelection.setMultipleSelectionAllowed( false );
			selectionTreeSelection.setListenerFunction( paramOrganisationUnitSet );
			selectionTree.clearSelectedOrganisationUnits();
		    selectionTree.buildSelectionTree();
		</script>
    </td>
    <tr>
        <td colspan="4" style="height:10px"></td>
    </tr>
    
    #end
    
    <!-- Submit -->    
    
    <tr>        
        <td>
        #if ( $mode == "table" || $mode == "status" )
            <input type="button" value="$i18n.getString( 'ok' )" onclick="createTable( '$id' )" style="width:120px">        
            <input type="button" value="$i18n.getString( 'back' )" onclick="javascript:window.location.href='displayManageTableForm.action'" style="width:120px">
        #end
        #if ( $mode == "report" )
            <input type="button" value="$i18n.getString( 'ok' )" style="width:120px" onclick="runAndViewReport( '$id', '$url' )">
            <input type="button" value="$i18n.getString( 'back' )" onclick="javascript:window.location.href='displayViewReportForm.action'" style="width:120px">
        #end
        </td>
    </tr>
    
</table>

<span id="message"></span>

<script type="text/javascript">
    var i18n_process_completed = '$encoder.jsEscape( $i18n.getString( "process_completed" ), "'")';
    var i18n_please_wait = '$encoder.jsEscape( $i18n.getString( "please_wait" ), "'")';
	var i18n_please_select_unit = '$encoder.jsEscape( $i18n.getString( "select_organisation_unit" ), "'")';
</script>
