<script type="text/javascript">
$( document ).ready( function() {
	jQuery( '#text' ).autogrow();
	
	if ( scrollIsRelevant() == false ) {
	   jQuery( '.scrollButton' ).hide();
	}
} );
	
var i18n_sender = '$encoder.jsEscape( $i18n.getString( "sender" ), "'")';
var i18n_enter_text = '$encoder.jsEscape( $i18n.getString( "enter_text" ), "'")';
var i18n_sending_message = '$encoder.jsEscape( $i18n.getString( "sending_message" ), "'")';
</script>

<div id="senderInfo" style="display:none" class="page">
<h3><span id="senderName"></span></h3>
<table>
<tr>
<td><label>$i18n.getString( "email" ):</label></td>
<td><span id="senderEmail"></span></td>
</tr>
<tr>
<td><label>$i18n.getString( "username" ):</label></td>
<td><span id="senderUsername"></span></td>
</tr>
<tr>
<td><label>$i18n.getString( "phone_number" ):</label></td>
<td><span id="senderPhoneNumber"></span></td>
</tr>
<tr>
<td><label>$i18n.getString( "organisation_units" ):</label></td>
<td><span id="senderOrganisationUnits"></span></td>
</tr>
<tr>
<td><label>$i18n.getString( "user_roles" ):</label></td>
<td><span id="senderUserRoles"></span></td>
</tr>
<tr>
<td colspan="2" style="height:15px"></td>
</tr>
#if( $auth.hasAccess( "dhis-web-dashboard-integration", "sendMessage" ) )
<tr>
<td><label>$i18n.getString( "meta_data" ):</label></td>
<td><span id="messageMetaData"></span></td>
</tr>
#end
</table>
</div>

<input type="hidden" id="conversationId" value="${conversation.id}"/>

<div class="messageDiv horizontalMenu" style="padding:10px 0 40px 0">
<ul>
<li><a class="greyButtonLink" href="unreadMessage.action?id=${conversation.id}">$i18n.getString( 'mark_unread' )</a></li>
<li><a class="greyButtonLink" href="removeMessageRedirect.action?id=${conversation.id}">$i18n.getString( 'remove' )</a></li>
<li><a class="greyButtonLink" href="message.action?currentPage=${keyCurrentPage}">$i18n.getString( 'back' )</a></li>
<li class="scrollButton"><a class="greyButtonLink" href="javascript:scrollToBottom()">$i18n.getString( 'scroll_down' )</a></li>
</ul>
</div>

<div>
<h3>$encoder.htmlEncode( $conversation.subject )</h3>
</div>

#foreach( $message in $conversation.messages )
<div class="messageDiv">
<a class="bold userLink" href="profile.action?id=${message.sender.uid}">$encoder.htmlEncode( $message.sender.name )</a>&nbsp;&nbsp;
<span class="grey">$format.formatDate( $message.lastUpdated )</span>

<p>$!dhisTextUtils.htmlify( $encoder.htmlEncode( $message.text ) )</p>
<span id="metaData${message.id}" style="display:none">$!encoder.htmlEncode( $message.metaData )</span>
</div>
#end

<textarea id="text" name="text" class="replyArea"></textarea>
<div style="margin-top:10px"><a class="blueButtonLink" href="javascript:sendReply()">$i18n.getString( 'reply' )</a></div>

<div class="messageBottomDiv horizontalMenu">
<ul>
<li><a class="greyButtonLink" href="unreadMessage.action?id=${conversation.id}">$i18n.getString( 'mark_unread' )</a></li>
<li><a class="greyButtonLink" href="removeMessageRedirect.action?id=${conversation.id}">$i18n.getString( 'remove' )</a></li>
<li><a class="greyButtonLink" href="message.action?currentPage=${keyCurrentPage}">$i18n.getString( 'back' )</a></li>
<li class="scrollButton"><a class="greyButtonLink" href="javascript:scrollToTop()">$i18n.getString( 'scroll_up' )</a></li>
</ul>
</div>
