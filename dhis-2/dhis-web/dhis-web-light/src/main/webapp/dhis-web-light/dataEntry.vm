
#set( $Integer = 0 )

<h2>$encoder.htmlEncode( $dataSet.name )</h2>

#if( $validationRuleViolations.size() > 0 )
<div class="header-box" align="center">
	<h3 style="text-align: left; background-color: #990000; color: white;">Validation Rule Violations</h3>
	<p style="text-align: left;">
	#foreach( $validationRuleViolation in $validationRuleViolations )
		$validationRuleViolation <br />
	#end
	</p>
</div>
#end

<form action="saveSectionForm.action" method="POST">

<input type="hidden" id="organisationUnitId" name="organisationUnitId" value="$organisationUnitId" />
<input type="hidden" id="dataSetId" name="dataSetId" value="$dataSetId" />
<input type="hidden" id="periodId" name="periodId" value="$periodId" />
<input type="hidden" id="validated" name="validated" value="#if($validated)true#{else}false#end" />

#macro( createSection $sectionName $dataElements )
<div class="header-box" align="center">
	<h3 style="text-align: left;">$sectionName</h3>
	<p style="text-align: left;">
		#foreach( $dataElement in $dataElements)
			#foreach( $optionCombo in $dataElement.categoryCombo.optionCombos )
				#set( $key = "DE${dataElement.id}OC${optionCombo.id}" )
				<label>$dataElement.name #if($dataElement.categoryCombo.optionCombos.size > 1)$optionCombo.name#end</label>

				#if( $validationViolations.get( $key ) )
				#set( $validationViolation = $validationViolations.get( $key ) )

                #if( $sectionFormUtils.valueHigher( $validationViolation.value, $validationViolation.max ) )
                    <br /><span style="color: #990000;">Too high (max $validationViolation.max)</span>
                #elseif( $sectionFormUtils.valueLower( $validationViolation.value, $validationViolation.min ) )
                    <br /><span style="color: red;">Too low (min $validationViolation.min)</span>
                #else
                    <br /><span style="color: red;">Not a number</span>
                #end

                #end

				<input type="number" size="24" name="$key" value="$!dataValues.get($key)" /> <br />
			#end
		#end
	</p>
</div>
#end

#if( $dataSet.sections.size() > 0 )
    #foreach( $section in $dataSet.sections )
        #createSection( $section.name $section.dataElements )
    #end
#else
    #createSection( "Default" $dataSet.dataElements )
#end

<div class="header-box" align="center">
	<p style="text-align: left;">
		<input type="checkbox" id="complete" name="complete" value="true" #if($complete)checked="true"#end style="width: 15px; height: 15px; vertical-align: middle;" />
        <label for="complete" style="vertical-align: middle; width: auto;">$i18n.getString("dataset_is_complete")</label>
	</p>
</div>

<div class="header-box" align="center">
	<p>
		<input type="submit" style="width: 100%;" value="$i18n.getString("save")" />
	</p>
</div>

</form>

<div id="footer">
<h2>$i18n.getString( "navigate_to" )</h2>
<ul>
	<li><a href="selectPeriod.action?organisationUnitId=$organisationUnitId&dataSetId=$dataSetId&periodId=$periodId">$i18n.getString("available_periods")</a></li>
	<li><a href="index.action">$i18n.getString("home")</a></li>
</ul>
</div>
