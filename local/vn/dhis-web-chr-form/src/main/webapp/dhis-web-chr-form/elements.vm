<input type="hidden" value="$form.id" id="formid" name="formid">
<h2>$!encoder.htmlEncode($!form.name)</h2>
<p align="left"><input type="button" onClick="openAddElementForm()" value="$i18n.getString('add')"/></p>
<table width="100%">
	<tr>
		<th>$i18n.getString('name')</th>
		<th>$i18n.getString('label')</th>
		<th>$i18n.getString('type')</th>		
		<th>$i18n.getString('sortOrder')</th>		
		<th>$i18n.getString('egroup')</th>		
		<th>$i18n.getString('controlType')</th>
		<th>$i18n.getString('required')</th>		
		<th width="5%">$i18n.getString('operations')</th>		
  </tr>
	#set( $mark = false )
	#foreach($element in $elements)
		<tr #alternate( $mark )>
			<td>$i18n.getString( $!element.name )</td>
			<td>$i18n.getString( $!element.label )</td>
			<td>$encoder.htmlEncode( $!element.type )</td>
			<td>$encoder.htmlEncode( $!element.sortOrder )</td>
			<td>$!encoder.htmlEncode( $!element.egroup.name )</td>
			<td>$encoder.htmlEncode( $!element.controlType )</td>
			<td>$encoder.htmlEncode( $!element.required )</td>
			<td>
				<a href="javascript: openAssociateDataElementsForElementForm(); " title="$i18n.getString('associate_elements_for_egroup')">
    				<img src="../images/assign.png" alt="$i18n.getString('associate_dataelement_for_element')"></a>
            	<a href="javascript: openUpdateElementForm($element.id);" title="$i18n.getString('edit')">
                	<img src="../images/edit.png" alt="$i18n.getString('edit')"></a>
    			<a href="javascript: deleteElement($element.id);" title="$i18n.getString('delete')">
                	<img src="../images/delete.png" alt="$i18n.getString('delete')"></a>
            
            </td>
		</tr>
		#if( $mark )
			#set( $mark = false )
		#else
			#set( $mark = true )
		#end
	#end
</table>

<script type="text/javascript">
	var i18n_confirm_delete = '$encoder.jsEscape($i18n.getString( "confirm_delete" ) , "'")';
	
	var mode = null;
	
	// --------------------------------------------------------------------------------------
	//  Add Element Form
	// --------------------------------------------------------------------------------------
	
	function openAddElementForm(){
			
		document.getElementById('name').value ="";
		document.getElementById('sortOrder').value ="";
		
		setPositionCenter( 'element' );
		showDivEffect();
		showById( 'element' );
		mode = "ADD";
		enable('name');
	}
	
	// --------------------------------------------------------------------------------------
	//  Update Element Form
	// --------------------------------------------------------------------------------------

	function openUpdateElementForm( id ){
		
		var request = new Request();
		request.setResponseTypeXML( 'element' );
		request.setCallbackSuccess( openUpdateElementReceived );
		
		request.send( "getElementById.action?id=" + id );
	}
	
	function openUpdateElementReceived( element ){		
		
		document.getElementById('id').value = getElementValue(element, 'id');
		
		document.getElementById('name').value = getElementValue(element, 'name');
		
		document.getElementById('label').value = getElementValue(element, 'label');
		
		document.getElementById('type').value = getElementValue(element, 'type');
		
		document.getElementById('controlType').value = getElementValue(element, 'controlType');
		
		document.getElementById('initialValue').value = getElementValue(element, 'initialValue');
		
		document.getElementById('formLink').value = getElementValue(element, 'formLink');
		
		if(getElementValue(element, 'required') == 'true'){
			document.getElementById('required').checked = true;
		}else{
			document.getElementById('required').checked = false;
		}
		
		document.getElementById('sortOrder').value = getElementValue(element, 'sortOrder');
		
		setPositionCenter( 'element' );
		
		showDivEffect();
		
		showById( 'element' );
		
		mode = "UPDATE";
		
		disable('name');
	}	
</script>

<form name="elementForm" method="post">
  <div id="element" style="position:fixed;display:none;width:320px;z-index:10001;background-color: white;border: medium solid silver;height:300px;padding:20px;">
	<div id="close" style="position:absolute;top:2px;right:2px;cursor: pointer;color:red;" onClick="hideById('element');deleteDivEffect();">[x]</div>
	<input type="hidden" id="id" name="id" value=""/>
	<table>
	<tr>
		<td width="180"><label>$i18n.getString('name')<em title="$i18n.getString( 'name' )" class="required">*</em></lable></td> 
		<td><input type="text" id="name" name="name" style="width:15em"/></td>
	  </tr>
	<tr>
		<td><lable>$i18n.getString('label')<em title="$i18n.getString( 'label' )" class="required">*</em></lable></td>
		<td><input type="text" id="label" name="label" style="width:15em"/></td>
	  </tr>
	</tr>	
		<tr><td><label>$i18n.getString('sortOrder')<em title="$i18n.getString( 'sortOrder' )" class="required">*</em></lable></td>
		  <td><input type="text" id="sortOrder" name="sortOrder" style="width:15em"/></td>
	  </tr>
	<tr>
		<td><label> $i18n.getString('controlType')</lable></td>
		<td> 
			<select id="controlType" name="controlType" style="width:8em; overflow:scroll" onChange="javascript: checkControlType(this);">
				<option value="textfield" selected>$i18n.getString('textfield')</option>
                <option value="checkbox">$i18n.getString('checkbox')</option>
                <option value="combobox">$i18n.getString('combobox')</option>
                <!-- <option value="autocompleted">$i18n.getString('autocompleted')</option> -->
                <option value="textarea">$i18n.getString('textarea')</option>
                <option value="date">$i18n.getString('date')</option>
		    	<!-- <option value="tree">$i18n.getString('tree')</option> -->
		    	<option value="break">$i18n.getString('break')</option>
		</select>
			<label> $i18n.getString('required') ?</lable>
			<input type="checkbox"  id="required" name="required"/>
            </td>
	  </tr>		
	<tr>
		<td><lable>$i18n.getString('type')</lable></td>
		<td width="359"><select id="type" name="type" style="width:15em ; overflow:scroll">
		  <option value="varchar" checked>$i18n.getString('varchar')</option>
          <option value="integer">$i18n.getString('integer')</option>		 
          <option value="date">$i18n.getString('date')</option>
		  <option value="numeric">$i18n.getString('numeric')</option>
		  <option value="boolean">$i18n.getString('boolean')</option>
        </select><br>
<font size="-2"> $i18n.getString('guide_type') </font></td>
	  </tr>
	<tr>
		<td><label> $i18n.getString('formLink')  </lable></td>
		<td>
			<select id="formLink" name="formLink" style="width:15em; overflow:scroll">
				<option value="" selected></option>
				#foreach($form in $forms)				
  					<option value="$form.id">$form.label</option>
				#end	
			</select>
			</td>
	  </tr>	
	  	<td></td>
	  	<td><font size="-2">$i18n.getString('guide_formLink')</font></td>
	  </tr>				
	<tr>
	  <td>$i18n.getString('initialvalue')</td>
	  <td><textarea id="initialValue" name="initialValue" style="width:15em"></textarea></td>
	  </tr>
	<tr>
		<td>&nbsp;</td>
		<td> <font size="-2">$i18n.getString('guide_initialvalue')</font> </td>
	  </tr>
	</table>
	<p align="center">
	<input type="button" value="$i18n.getString('save')" onClick="javascript: validateElement();"/>
	<input type="button" value="$i18n.getString('cancel')" onClick="hideById('element');deleteDivEffect();"/>
	</p>
</div>

<div id="associationDataelement" style="position:fixed;display:none;width:450px;z-index:10001;background-color: white;border: medium solid silver;height:180px;padding:20px;">
  <div id="close" style="position:absolute;top:2px;right:2px;cursor: pointer;color:red;" onClick="hideById('associationDataelement');deleteDivEffect();">[x]</div>
  <input type="hidden" id="egroupID" name="egroupID">
  <table>
	<colgroup>
  		<col width="325px">
  		<col width="80px">
 		<col width="325px">
  	</colgroup>
	<tr>
    <th>$i18n.getString( 'available_dataelements' )</th>
    <td colspan="2">
    	<select id="availableDataSet" name="availableDataSet" style="width:100%" onChange="javascript:getDataElements(this.value ); ">
		</select>
    </td></tr>
  	<tr>
  		<td>$i18n.getString( 'available_dataelements' )</td>
  		<td></td>
  		<td>$i18n.getString( 'selected_dataelements' )</td>
	</tr>
	
	<tr>
		<td><select multiple size="6" id="availabelDataelements" name="availabelDataelements" style="width:100%" ondblclick="moveSelectedById( 'availabelDataelements', 'selectedDataelements' )">
        </select>		</td>
		<td style="text-align:center">	
		  <input type="button" value="&gt;" title="$i18n.getString('move_selected')" style="width:50px" onclick="moveSelectedById( 'availabelDataelements', 'selectedDataelements' )"/><br>
		  <input type="button" value="&lt;" title="$i18n.getString('move_all')" style="width:50px" onclick="moveSelectedById( 'selectedDataelements', 'availabelDataelements' )"/><br>		
		  <input type="button" value="&gt;&gt;" title="$i18n.getString('remove_selected')" style="width:50px" onclick="moveAllById( 'availabelDataelements', 'selectedDataelements' )"/><br>


		  <input type="button" value="&lt;&lt;" title="$i18n.getString('remove_all')" style="width:50px" onclick="moveAllById( 'selectedDataelements', 'availabelDataelements' )"/>
		</td>
		<td>
		  <select multiple size="6" id="selectedDataelements" name="selectedDataelements" style="width:100%" ondblclick="moveSelectedById( 'selectedDataelements', 'availabelDataelements' )">
				
		  </select>
		</td>
	</tr>

</table>
<p>
<input type="button" value="$i18n.getString( 'save' )" onClick="javascript: updateElementsForEgroup();deleteDivEffect();hideById('associationDataelement');"/>
<input name="button" type="button" onClick="javascript:deleteDivEffect();hideById('associationDataelement');" value="$i18n.getString( 'cancel' )"/>		
</p>
  
</div>


</form>
<span id="message" style="top:100px;right:5px;position:fixed;width:200px;z-index:10004" onclick="hideById(this.id);"></span>
<span id="info" style="display:none;top:70px;right:5px;position:fixed;" onclick="hideById(this.id)"></span>

<script language="javascript">
	function checkControlType(object){
		var typeObject = document.getElementById('type')
		if(object.value=='checkbox' || object.value=='date'){
			typeObject.value=(object.value=='checkbox')?'boolean':'date';
			typeObject.disabled = true;
		}else{
			typeObject.disabled = false;
		}
	}
</script>